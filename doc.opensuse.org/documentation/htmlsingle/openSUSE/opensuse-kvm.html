<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="google-translate-customization" content="27857fe863746eba-c895b91dc5107366-g1ae5e65d33a28121-66"></meta><title>openSUSE 12.3: Virtualization with KVM</title><link rel="stylesheet" type="text/css" href="susebooks.css" /><meta name="generator" content="DocBook XSL Stylesheets V1.77.1" /></head><body><div id="google_translate_element"></div><script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
}
</script><script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script><div xml:lang="en" class="book" lang="en"><div class="titlepage"><div><div><h1 class="productname"><span class="phrase">openSUSE</span> <span class="productnumber"><span class="phrase">12.3</span></span></h1></div><div><h1 class="title"><a id="book.kvm"></a>Virtualization with KVM</h1></div><div class="buildtime"><p>Publication Date 08 Mar 2013</p></div><div><div class="legalnotice"><a id="id717115"></a><p>
  Copyright © 2006–2013

  SUSE LLC and contributors. All rights reserved.
 </p><p>
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.2 or (at
  your option) version 1.3; with the Invariant Section being this copyright
  notice and license. A copy of the license version 1.2 is included in the
  section entitled <span class="quote">“<span class="quote">GNU Free Documentation License</span>”</span>.
 </p><p>
  For SUSE or Novell trademarks, see the Novell Trademark and Service Mark list
  <a class="ulink" href="http://www.novell.com/company/legal/trademarks/tmlist.html" target="_top">http://www.novell.com/company/legal/trademarks/tmlist.html</a>.
  All other third party trademarks are the property of their respective
  owners. A trademark symbol (®, ™ etc.) denotes a SUSE or Novell
  trademark; an asterisk (*) denotes a third party trademark.
 </p><p>
  All information found in this book has been compiled with utmost attention
  to detail. However, this does not guarantee complete accuracy. Neither
  SUSE LLC, its affiliates, the authors nor the translators shall be held
  liable for possible errors or the consequences thereof.
 </p></div></div></div><div></div><hr /></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="preface"><a href="opensuse-kvm.html#cha.kvm.intro">About This Manual</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id715386">1. Available Documentation</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id714450">2. Feedback</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id715948">3. Documentation Conventions</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id713664">4. About the Making of This Manual</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id713586">5. Source Code</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id716572">6. Acknowledgments</a></span></dt></dl></dd><dt><span class="part"><a href="opensuse-kvm.html#id716538">I. 
   
   <span class="phrase">Requirements and Limitations</span>
  </a></span></dt><dd><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.requires">1. KVM Installation and Requirements</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.hardware">1.1. Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.guests">1.2. Supported Guest Operating Systems</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.package">1.3. The <code class="systemitem">kvm</code> package</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.install">1.4. Installing KVM</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.limits">2. KVM Limitations</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.general">2.1. General Limitations</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.hardware">2.2. Hardware Limitations</a></span></
dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.performance">2.3. Performance Limitations</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="opensuse-kvm.html#id433346">II. Managing Virtual Machines with <code class="systemitem">libvirt</code></a></span></dt><dd><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.overview">3. Overview</a></span></dt><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.inst">4. Guest Installation</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vmm">4.1. Guest Installation with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vm-install">4.2. Installing from the Command Line with <span class="command"><strong>vm-install</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.advanced">4.3. Advanced Guest Installation Scenarios</a></span></dt></dl></dd><dt><span class="
chapter"><a href="opensuse-kvm.html#cha.libvirt.managing">5. Basic VM Guest Management</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.list">5.1. Listing VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.vnc">5.2. Opening a Graphical Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.status">5.3. Changing a VM Guest's State: Start, Stop, Pause</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.manage.save">5.4. Saving and Restoring VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.delete">5.5. Deleting a VM Guest</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.connect">6. Connecting and Authorizing</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.auth">6.1. Authentication</a></span></dt><dt><span class="sect1"><a 
href="opensuse-kvm.html#sec.libvirt.connect.remote">6.2. Configuring Remote Connections</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.connecting">6.3. Connecting to a VM Host Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.storage">7. Managing Storage</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.vmm">7.1. Managing Storage with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.virsh">7.2. Managing Storage with <span class="command"><strong>virsh</strong></span></a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.config">8. Configuring Virtual Machines</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.tablet">8.1. Enabling Seamless and Synchronized Cursor Movement</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.
libvirt.config.cdrom">8.2. Adding a CD/DVD-ROM Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.floppy">8.3. Adding a Floppy Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change">8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.managing.clock">8.5. Clock Settings</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.admin">9. Administrating VM Guests</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.admin.migrate">9.1. Migrating VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.libvirt.admin.monitor">9.2. Monitoring</a></span></dt></dl></dd></dl></dd><dt><span class="part"><a href="opensuse-kvm.html#id723395">III. Managing Virtual Machines with 
QEMU</a></span></dt><dd><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.overview">10. QEMU Overview</a></span></dt><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.guest_inst">11. Guest Installation</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm">11.1. Basic Installation with <span class="command"><strong>qemu-kvm</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img">11.2. Managing Disk Images with <span class="command"><strong>qemu-img</strong></span></a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.running">12. Running Virtual Machines with qemu-kvm</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.basic">12.1. Basic <span class="command"><strong>qemu-kvm</strong></span> Invocation</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.gen_opts">12.2. General 
<span class="command"><strong>qemu-kvm</strong></span> Options</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.devices">12.3. Using Devices in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.networking">12.4. Networking in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.vnc">12.5. Viewing a VM Guest with VNC</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.virtfs">12.6. VirtFS: Sharing Folders between Host and Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.ksm">12.7. KSM: Sharing Memory Pages between Guests</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.monitor">13. Administrating Virtual Machines with QEMU Monitor</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id729276">13.1. Accessing Monitor Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#
id729327">13.2. Getting Information about the Guest System</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729948">13.3. Changing VNC Password</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729967">13.4. Managing Devices</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730008">13.5. Controlling Keyboard and Mouse</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730136">13.6. Changing Available Memory</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730185">13.7. Dumping Virtual Machine Memory</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730504">13.8. Managing Virtual Machine Snapshots</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730727">13.9. Suspending and Resuming Virtual Machine Execution</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730818">13.10. Live Migration</a></span></dt></dl></dd></dl></dd><dt><span class="appendix"><a href="opensuse-
kvm.html#app.kvm">A. Appendix</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#app.kvm.virtio_install">A.1. Installing Para-Virtualized Drivers</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#app.kvm.certificates">A.2. Generating x509 Client/Server Certificates</a></span></dt></dl></dd><dt><span class="appendix"><a href="opensuse-kvm.html#id732108">B. GNU Licenses</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id732130">B.1. GNU General Public License</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id732722">B.2. GNU Free Documentation License</a></span></dt></dl></dd></dl></div><div class="list-of-figures"><p><strong>List of Figures</strong></p><dl><dt>8.1. <a href="opensuse-kvm.html#id721960"><span class="guimenu">Details</span> View of a VM Guest</a></dt><dt>11.1. <a href="opensuse-kvm.html#id724485">New 2GB Partition in Guest YaST Partitioner</a></dt><dt>12.1. <a href="opensuse-kvm.html#id725720">QEMU Window with SLES 
11 SP1 as VM Guest</a></dt><dt>12.2. <a href="opensuse-kvm.html#id728040">Configuring Network Bridge with YaST</a></dt><dt>12.3. <a href="opensuse-kvm.html#id728589">QEMU VNC Session</a></dt><dt>12.4. <a href="opensuse-kvm.html#id728756">Authentication Dialog in Vinagre</a></dt></dl></div><div class="list-of-tables"><p><strong>List of Tables</strong></p><dl><dt>1.1. <a href="opensuse-kvm.html#id462104">Supported KVM Guest Operating Systems on <span class="phrase">openSUSE</span></a></dt></dl></div><div class="list-of-examples"><p><strong>List of Examples</strong></p><dl><dt>4.1. <a href="opensuse-kvm.html#ex.libvirt.inst.vm-install.interactive">Interactive Setup on the Command Line Using <span class="command">vm-install</span></a></dt><dt>4.2. <a href="opensuse-kvm.html#ex.libvirt.inst.vm-install.noninteractive"><span class="command">vm-install</span> command line switches</a></dt><dt>9.1. <a href="opensuse-kvm.html#id723360">Typical Output of <span class="command">kvm_stat</span></a></dt><dt>12.1. <a href="
opensuse-kvm.html#ex.qemu.net.usermode.resctrict">Restricted User-mode Networking</a></dt><dt>12.2. <a href="opensuse-kvm.html#ex.qemu.net.usermode.iprange">User-mode Networking with Custom IP Range</a></dt><dt>12.3. <a href="opensuse-kvm.html#ex.qemu.net.usermode.netboot_tftp">User-mode Networking with Network-boot and TFTP</a></dt><dt>12.4. <a href="opensuse-kvm.html#ex.qemu.net.usermode.hostfwd">User-mode Networking with Host Port Forwarding</a></dt><dt>12.5. <a href="opensuse-kvm.html#ex.running.vnc.secure.pwd">Password Authentication</a></dt><dt>12.6. <a href="opensuse-kvm.html#ex.running.vnc.secure.x509">x509 Certificate Authentication</a></dt><dt>12.7. <a href="opensuse-kvm.html#ex.running.vnc.secure.pwd_x509">x509 Certificate and Password Authentication</a></dt><dt>12.8. <a href="opensuse-kvm.html#ex.running.vnc.secure.sasl">SASL Authentication</a></dt><dt>12.9. <a href="opensuse-kvm.html#ex.qemu.virtfs.host">Exporting Host's Filesystem with VirtFS</a></dt></dl></div><div class="preface"><div class="
titlepage"><div><div><h2 class="title"><a id="cha.kvm.intro"></a>About This Manual<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.intro">¶</a></span></h2></div></div></div><p>
  This manual offers an introduction to setting up and managing
  virtualization with KVM (Kernel-based Virtual Machine) on <span class="phrase">openSUSE</span>.
  The first part introduces KVM by describing it's requirements and
  SUSE's support status. The second part deals with managing KVM with
  <code class="systemitem">libvirt</code>, while the last part covers management with QEMU.
 </p><p>
  Many chapters in this manual contain links to additional documentation
  resources. This includes additional documentation that is available on the
  system as well as documentation available on the Internet.
 </p><p>
  For an overview of the documentation available for your product and the
  latest documentation updates, refer to
  <a class="ulink" href="http://www.suse.com/documentation" target="_top">http://www.suse.com/documentation</a>.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id715386"></a>1. Available Documentation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id715386">¶</a></span></h2></div></div></div><a id="id715382" class="indexterm"></a><a id="id715371" class="indexterm"></a><p>
  We provide HTML and PDF versions of our books in different languages.
  <span class="phrase">The following manuals for users and
  administrators are available on this product:</span>
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Start-Up (↑Start-Up)
   </span></dt><dd><p>
     Guides you step-by-step through the installation of <span class="phrase">openSUSE</span> from
     DVD, or from an ISO image, gives short introductions to the GNOME and
     KDE desktops including some key applications running on it. Also gives
     an overview of LibreOffice and its modules for writing texts, working with
     spreadsheets, or creating graphics and presentations.
    </p></dd><dt><span class="term">Reference (↑Reference)
   </span></dt><dd><p>
     Gives you a general understanding of <span class="phrase">openSUSE</span> and covers advanced
     system administration tasks. It is intended mainly for system
     administrators and home users with basic system administration
     knowledge. It provides detailed information about advanced deployment
     scenarios, administration of your system, the interaction of key system
     components and the set-up of various network and file services
     <span class="phrase">openSUSE</span> offers.
    </p></dd><dt><span class="term">Security Guide (↑Security Guide)
   </span></dt><dd><p>
     Introduces basic concepts of system security, covering both local and
     network security aspects. Shows how to make use of the product inherent
     security software like AppArmor (which lets you specify per program which
     files the program may read, write, and execute) or the auditing system
     that reliably collects information about any security-relevant events.
    </p></dd><dt><span class="term">System Analysis and Tuning Guide (↑System Analysis and Tuning Guide)
   </span></dt><dd><p>
     An administrator's guide for problem detection, resolution and
     optimization. Find how to inspect and optimize your system by means of
     monitoring tools and how to efficiently manage resources. Also contains
     an overview of common problems and solutions and of additional help and
     documentation resources.
    </p></dd><dt><span class="term"><a class="xref" href="opensuse-kvm.html#book.kvm" title="Virtualization with KVM">Virtualization with KVM</a>
   </span></dt><dd><p>
     This manual offers an introduction to setting up and managing
     virtualization with KVM (Kernel-based Virtual Machine) on
     <span class="phrase">openSUSE</span>. Also shows how to manage VM Guests with <code class="systemitem">libvirt</code> and
     QEMU.
    </p></dd></dl></div><p>
  Find HTML versions of most product manuals in your installed system under
  <code class="filename">/usr/share/doc/manual</code> or in the help centers of your
  desktop. Find the latest documentation updates at
  <a class="ulink" href="http://www.suse.com/documentation" target="_top">http://www.suse.com/documentation</a> where you can download
  PDF or HTML versions of the manuals for your product.
 </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id714450"></a>2. Feedback<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id714450">¶</a></span></h2></div></div></div><p>
  Several feedback channels are available:
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Bugs and Enhancement Requests</span></dt><dd><p>
     To report bugs for a product component, or to submit enhancement
     requests, please use <a class="ulink" href="https://bugzilla.novell.com/" target="_top">https://bugzilla.novell.com/</a>. For
     documentation bugs, submit a bug report for the component
     <span class="guimenu">Documentation</span> of the respective product.
    </p><p>
     If you are new to Bugzilla, you might find the following articles
     helpful:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
       <a class="ulink" href="http://en.opensuse.org/openSUSE:Submitting_bug_reports" target="_top">http://en.opensuse.org/openSUSE:Submitting_bug_reports</a>
      </p></li><li class="listitem" style="list-style-type: disc"><p>
       <a class="ulink" href="http://en.opensuse.org/openSUSE:Bug_reporting_FAQ" target="_top">http://en.opensuse.org/openSUSE:Bug_reporting_FAQ</a>
      </p></li></ul></div></dd><dt><span class="term">User Comments</span></dt><dd><p>
     We want to hear your comments about and suggestions for this manual and the
     other documentation included with this product. Use the User Comments
     feature at the bottom of each page in the online documentation or go to
     <a class="ulink" href="http://www.suse.com/documentation/feedback.html" target="_top">http://www.suse.com/documentation/feedback.html</a> and
     enter your comments there.
     
    </p></dd><dt><span class="term">Mail</span></dt><dd><p>For feedback on the documentation of this product, you can
    also send a mail to <code class="literal">doc-team@suse.de</code>. Make
    sure to include the document title, the product version and the publication 
    date of the documentation. To report errors or suggest enhancements, 
    provide a concise description of the problem and refer to the respective 
    section number and page (or URL). 
   </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id715948"></a>3. Documentation Conventions<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id715948">¶</a></span></h2></div></div></div><p>
  The following typographical conventions are used in this manual:
 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
    <code class="filename">/etc/passwd</code>: directory names and filenames
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <em class="replaceable"><code>placeholder</code></em>: replace
    <em class="replaceable"><code>placeholder</code></em> with the actual value
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <code class="envar">PATH</code>: the environment variable PATH
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <span class="command"><strong>ls</strong></span>, <code class="option">--help</code>: commands, options, and
    parameters
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <code class="systemitem">user</code>: users or groups
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <span class="keycap">Alt</span>, <span class="keycap">Alt</span>+<span class="keycap">F1</span>: a
    key to press or a key combination; keys are shown in uppercase as on a
    keyboard
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <span class="guimenu">File</span>, <span class="guimenu">File</span>+<span class="guimenu">Save As</span>: menu items, buttons
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    <span class="emphasis"><em>Dancing Penguins</em></span> (Chapter
    <span class="emphasis"><em>Penguins</em></span>, ↑Another Manual): This is a
    reference to a chapter in another manual.
   </p></li></ul></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id713664"></a>4. About the Making of This Manual<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id713664">¶</a></span></h2></div></div></div><p>
  This book is written in Novdoc, a subset of DocBook (see
  <a class="ulink" href="http://www.docbook.org" target="_top">http://www.docbook.org</a>). The XML source files were
  validated by <span class="command"><strong>xmllint</strong></span>, processed by
  <span class="command"><strong>xsltproc</strong></span>, and converted into XSL-FO using a customized
  version of Norman Walsh's stylesheets. The final PDF is formatted through
  XEP from RenderX. <span class="phrase">The open source tools and the
  environment used to build this manual are available in the package
  <code class="systemitem">daps</code> that is shipped with
  <span class="phrase">openSUSE</span>. The project's home page can be found at
  <a class="ulink" href="http://daps.sf.net/" target="_top">http://daps.sf.net/</a>.</span>
 </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id713586"></a>5. Source Code<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id713586">¶</a></span></h2></div></div></div><p>
  The source code of <span class="phrase">openSUSE</span> is publicly available. Refer to <a class="ulink" href="http://en.opensuse.org/Source_code" target="_top">http://en.opensuse.org/Source_code</a> for download links and more
  information.
 </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id716572"></a>6. Acknowledgments<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id716572">¶</a></span></h2></div></div></div><p>
  With a lot of voluntary commitment, the developers of Linux cooperate on a
  global scale to promote the development of Linux. We thank them for their
  efforts—this distribution would not exist without them. Furthermore,
  we thank Frank Zappa and Pawar. Special thanks, of course, goes to Linus
  Torvalds.
 </p><p>
  Have a lot of fun!
 </p><p>
  Your SUSE Team
 </p></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="id716538"></a>Part I. 
   
   <span class="phrase">Requirements and Limitations</span>
  </h1></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.requires">1. KVM Installation and Requirements</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.hardware">1.1. Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.guests">1.2. Supported Guest Operating Systems</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.package">1.3. The <code class="systemitem">kvm</code> package</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.install">1.4. Installing KVM</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.limits">2. KVM Limitations</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.general">2.1. General Limitations</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.
hardware">2.2. Hardware Limitations</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.performance">2.3. Performance Limitations</a></span></dt></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.kvm.requires"></a>Chapter 1. KVM Installation and Requirements<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.requires">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.hardware">1.1. Hardware Requirements</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.guests">1.2. Supported Guest Operating Systems</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.package">1.3. The <code class="systemitem">kvm</code> package</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.requires.install">1.4. Installing KVM</a></span></
dt></dl></div><div class="abstract"><div class="titlepage"></div><p>
   KVM is a full virtualization solution for x86 processors supporting
   hardware virtualization (Intel VT or AMD-V). It consists of two main
   components: A set of Kernel modules (<code class="systemitem">kvm.ko</code>,
   <code class="systemitem">kvm-intel.ko</code>, and
   <code class="systemitem">kvm-amd.ko</code>) providing the core virtualization
   infrastructure and processor specific drivers and a userspace program
   (<code class="systemitem">qemu-kvm</code>) that provides
   emulation for virtual devices and control mechanisms to manage VM Guests
   (virtual machines). The term KVM more properly refers to the Kernel
   level virtualization functionality, but is in practice more commonly used
   to reference the userspace component.
  </p><p>
   VM Guests (virtual machines), virtual storage and networks can be
   managed with <code class="systemitem">libvirt</code>-based and QEMU tools. <code class="systemitem">libvirt</code> is a library
   that provides an API to manage VM Guests based on different
   virtualization solutions, among them KVM and Xen. It offers a
   graphical user interface as well as a command line program. The QEMU
   tools are KVM/QEMU specific and are only available for the command
   line.
  </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.requires.hardware"></a>1.1. Hardware Requirements<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.requires.hardware">¶</a></span></h2></div></div></div><p>
   Currently, SUSE only supports KVM full virtualization on x86_64
   hosts. KVM is designed around hardware virtualization features included
   in AMD (AMD-V) and Intel (VT-x) CPUs. It supports virtualization features
   of chipsets, and PCI devices, such as an I/O Memory Mapping Unit (IOMMU)
   and Single Root I/O Virtualization (SR-IOV)).
  </p><p>
   You can test whether your CPU supports hardware virtualization with the
   following command:
  </p><pre class="screen">egrep '(vmx|svm)' /proc/cpuinfo</pre><p>
   If this command returns no output, your processor either does not support
   hardware virtualization, or this feature has been disabled in the BIOS.
  </p><p>
   The following Web site identifies processors which support hardware
   virtualization:
   <a class="ulink" href="http://wiki.xensource.com/xenwiki/HVM_Compatible_Processors" target="_top">http://wiki.xensource.com/xenwiki/HVM_Compatible_Processors</a>
  </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    The KVM Kernel modules will not load if the CPU does not support
    hardware virtualization or if this feature is not enabled in the BIOS.
   </p></td></tr></table></div><p>
   The general minimum hardware requirements for the VM Host Server are the same as
   for <span class="phrase">openSUSE</span>. However, additional RAM for each
   virtualized guest is needed. It should at least be the same amount that is
   needed for a physical installation. It is also strongly recommended to have
   at least one processor core or hyper-thread for each running guest.
  </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.requires.guests"></a>1.2. Supported Guest Operating Systems<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.requires.guests">¶</a></span></h2></div></div></div><p>
   The following table lists guest operating systems tested and their support
   status offered by SUSE. All operating systems listed are supported in
   both 32 and 64-bit x86 versions. <span class="phrase">A list of other
   supported operating systems (not tested by SUSE) is available at <a class="ulink" href="http://www.linux-kvm.org/page/Guest_Support_Status" target="_top">http://www.linux-kvm.org/page/Guest_Support_Status</a>.</span>
  </p><p>
   Para-virtualized drivers (PV drivers) are listed where available.
  </p><div class="itemizedlist"><p class="title"><strong>Para-virtualized drivers for KVM</strong></p><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">virtio-net</code>: Virtual network driver.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">virtio-blk</code>: Virtual block device driver for
     para-virtualized block devices.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">virtio-balloon</code>: Memory driver for dynamic
     memory allocation. Allows to dynamically change the amount of memory
     allocated to a guest.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">kvm-clock</code>: Clock synchronization driver.
    </p></li></ul></div><div class="table"><a id="id462104"></a><p class="title"><strong>Table 1.1. Supported KVM Guest Operating Systems on <span class="phrase">openSUSE</span></strong></p><div class="table-contents"><table summary="Supported KVM Guest Operating Systems on openSUSE" border="1"><colgroup><col class="c1" /><col class="c2" /><col class="c3" /></colgroup><tbody><tr><td colspan="3">
       <p>
        <span class="strong"><strong>openSUSE 11.2 or newer</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        kvm-clock, virtio-net, virtio-blk, virtio-balloon
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Fully supported (fully virtualized)
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>SLES 11 SP2 / SLES 11 SP1 /
        SLES 10 SP4</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        kvm-clock, virtio-net, virtio-blk, virtio-balloon
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Fully supported (fully virtualized)
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>SLES 9 SP4</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Fully Supported (fully virtualized)
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Note:</em></span>
       </p>
      </td><td>
       <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
          32-bit Kernel: specify <code class="option">clock=pmtmr</code> on Linux boot
          line
         </p></li><li class="listitem" style="list-style-type: disc"><p>
          64-bit Kernel: specify <code class="option">ignore_lost_ticks</code> on Linux
          boot line
         </p></li></ul></div>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>SLED <span class="phrase">12.3</span> / SLED 11
        SP1</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        kvm-clock, virtio-net, virtio-blk, virtio-balloon
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Technology Preview (fully virtualized)
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>OES 2 SP3 / OES 11</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        kvm-clock, virtio-net, virtio-blk, virtio-balloon
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Fully supported (fully virtualized)
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>RedHat Enterprise Linux 4.8+ / 5.5+ /
        6.0+</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        See <a class="ulink" href="http://www.redhat.com/" target="_top">http://www.redhat.com/</a>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Best Effort (fully virtualized)
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Note:</em></span>
       </p>
      </td><td>
       <p>
        Refer to the RHEL Virtualization guide for more information.
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>Windows 2003 SP2+ / Windows 2008 SP2+ /
        Windows 2008 R2+</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        virtio-net, virtio-blk, virtio-balloon; drivers from the Virtual
        Machine Driver Pack
        (<a class="ulink" href="http://www.suse.com/products/vmdriverpack/" target="_top">http://www.suse.com/products/vmdriverpack/</a>)
        are preferred
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Fully supported with Server Virtualization Validation Program (SVVP)
        certification (fully virtualized)
       </p>
      </td></tr><tr><td colspan="3">
       <p>
        <span class="strong"><strong>Windows XP SP3+ / Windows Vista SP2+ /
        Windows 7 SP1+</strong></span>
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>PV drivers:</em></span>
       </p>
      </td><td>
       <p>
        virtio-net, virtio-blk, virtio-balloon; drivers from the Virtual
        Machine Driver Pack
        (<a class="ulink" href="http://www.suse.com/products/vmdriverpack/" target="_top">http://www.suse.com/products/vmdriverpack/</a>)
        are preferred
       </p>
      </td></tr><tr><td>
       <p></p>
      </td><td>
       <p>
        <span class="emphasis"><em>Support Status:</em></span>
       </p>
      </td><td>
       <p>
        Best effort (fully virtualized)
       </p>
      </td></tr></tbody></table></div></div><br class="table-break" /><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Guest images created under SUSE Linux Enterprise Server 11 SP1 are
    supported, but guest images created under a previous SUSE Linux Enterprise version are
    not supported.
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.kvm.requires.guests.virt_drivers"></a>1.2.1. Availability of Para-Virtualized Drivers<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.requires.guests.virt_drivers">¶</a></span></h3></div></div></div><p>
    To improve the performance of the guest operating system,
    para-virtualized drivers are provided when available. Although they are
    not required, it is strongly recommended to use them. The
    para-virtualized drivers are available as follows:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SUSE Linux Enterprise Server 11 SP1 / SP2</span></dt><dd><p>
       included in Kernel
      </p></dd><dt><span class="term">SUSE Linux Enterprise Server 10 SP4</span></dt><dd><p>
       included in Kernel
      </p></dd><dt><span class="term">SUSE Linux Enterprise Server 9 SP4</span></dt><dd><p>
       not available
      </p></dd><dt><span class="term">RedHat</span></dt><dd><p>
       available in RedHat Enterprise Linux 5.4 and newer
      </p></dd><dt><span class="term">Windows</span></dt><dd><p>
       SUSE has developed virtio based drivers for Windows, which are
       available in the Virtual Machine Driver Pack (VMDP). These drivers
       are preferred over the drivers provided in the
       <code class="filename">/usr/share/qemu-kvm/win-virtio-drivers.iso</code> image
       file (the latter being deprecated and will probably not be provided
       in future releases). See
       <a class="ulink" href="http://www.suse.com/products/vmdriverpack/" target="_top">http://www.suse.com/products/vmdriverpack/</a> for
       more information.
      </p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.requires.package"></a>1.3. The <code class="systemitem">kvm</code> package<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.requires.package">¶</a></span></h2></div></div></div><p>
   The <code class="systemitem">kvm</code> package provides
   <span class="command"><strong>qemu-kvm</strong></span>, the program that performs the actual
   emulation. In addition to the qemu-kvm program, the
   <code class="systemitem">kvm</code> package also comes with
   a debug level monitoring utility (<span class="command"><strong>kvm-stat</strong></span>),
   firmware components, key-mapping files, scripts, and deprecated
   para-virtualized Windows drivers
   (<code class="filename">/usr/share/qemu-kvm/win-virtio-drivers.iso</code>).
  </p><p>
   Originally, the <code class="systemitem">kvm</code> package
   also provided the KVM Kernel modules. Now, these modules are included
   with the Kernel and only userspace components are included in the current
   <code class="systemitem">kvm</code> package.
  </p><p>
   Using the <code class="systemitem">libvirt</code>-based tools is the recommended way of managing
   VM Guests. Interoperability with other virtualization tools has been
   tested and is an essential part of SUSE's support stance. All tools are
   provided by packages carrying the tool's name.
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">libvirt</code>: A toolkit that provides management of VM Guests, virtual
     networks, and storage. <code class="systemitem">libvirt</code> provides an API, a daemon, and a shell
     (<span class="command"><strong>virsh</strong></span>).
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <span class="command"><strong>virt-manager</strong></span> (Virtual Machine Manager): A graphical management tool
     for VM Guests.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <span class="command"><strong>vm-install</strong></span>: Define a VM Guest and install its
     operating system.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <span class="command"><strong>virt-viewer</strong></span>: An X viewer client for VM Guests which
     supports TLS/SSL encryption of x509 certificate authentication and SASL
     authentication.
    </p></li></ul></div><p>
   Support for creating and manipulating file-based virtual disk images is
   provided by <span class="command"><strong>qemu-img</strong></span>. <span class="command"><strong>qemu-img</strong></span> is
   provided by the package
   <code class="systemitem">virt-utils</code>.
  </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.requires.install"></a>1.4. Installing KVM<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.requires.install">¶</a></span></h2></div></div></div><p>
   KVM is not installed by default. To install KVM and all
   virtualization tools, proceed as follows:
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Start YaST and choose <span class="guimenu">Virtualization</span>+<span class="guimenu">Installing Hypervisor and Tools</span>.
    </p></li><li><p>
     Select <span class="guimenu">KVM</span> and confirm with
     <span class="guimenu">Accept</span>.
    </p></li><li><p>
     Confirm the list of packages that is to be installed with
     <span class="guimenu">Install</span>.
    </p></li><li><p>
     Agree to set up a network bridge by clicking <span class="guimenu">Yes</span>. It
     is recommended using a bridge on a VM Host Server (virtual machine host). If
     you prefer to manually configure a different network setup, you can
     safely skip this step by clicking <span class="guimenu">No</span>.
    </p></li><li><p>
     After the setup has been finished, reboot the machine as YaST
     suggests. Alternatively load the required kernel modules manually and
     start <code class="systemitem">libvirtd</code> to avoid a reboot:
    </p><pre class="screen">modprobe kvm-intel # on Intel machines only
modprobe kvm-amd   # on AMD machines only
modprobe vhost-net
rclibvirtd start</pre></li></ol></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: The vhost-net Kernel Module"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">The <code class="literal">vhost-net</code> Kernel Module</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    The vost-net kernel module allows for a more efficient network transport
    to the guest. It is automatically used by
    <code class="systemitem">libvirt </code> if loaded, or
    when using the <span class="command"><strong>qemu-kvm</strong></span> commandline, by adding
    <code class="option">,vhost=on</code> to the networking option.
   </p></td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.kvm.limits"></a>Chapter 2. KVM Limitations<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.limits">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.general">2.1. General Limitations</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.hardware">2.2. Hardware Limitations</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.limits.performance">2.3. Performance Limitations</a></span></dt></dl></div><p>
  Although virtualized machines behave almost like physical machines, some
  limitations apply. These affect both, the VM Guest as well as the
  VM Host Server system.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.limits.general"></a>2.1. General Limitations<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.limits.general">¶</a></span></h2></div></div></div><p>
   The following general restrictions apply when using KVM:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Overcommits</span></dt><dd><p>
      KVM allows for both memory and disk space overcommit. It is up to
      the user to understand the implications of doing so. However, hard
      errors resulting from exceeding available resources will result in
      guest failures. CPU overcommit is also supported but carries
      performance implications.
     </p></dd><dt><span class="term">Time Synchronization</span></dt><dd><p>
      Most guests require some additional support for accurate time keeping.
      Where available, <code class="systemitem">kvm-clock</code> is to be used. NTP
      or similar network based time keeping protocols are also highly
      recommended (for VM Host Server and VM Guest) to help maintain a stable
      time. Running NTP inside the guest is not recommended when using the
      <code class="systemitem">kvm-clock</code> . Refer to
      <a class="xref" href="opensuse-kvm.html#sec.kvm.managing.clock" title="8.5. Clock Settings">Section 8.5, “Clock Settings”</a> for details.
     </p></dd><dt><span class="term">MAC addresses</span></dt><dd><p>
      If no MAC address is specified for a NIC, a default MAC address will
      be assigned. This may result in network problems when more than one
      NIC receives the same MAC address. It is recommended to always assure
      a unique MAC address has been assigned for each NIC.
     </p></dd><dt><span class="term">Live Migration</span></dt><dd><p>
      Live Migration is only possible between VM Host Servers with the same CPU
      features and no physical devices passed from host to guest. Guest
      storage has to be accessible from both VM Host Servers and guest definitions
      need to be compatible. VM Host Server and VM Guests need to have proper
      timekeeping installed.
     </p></dd><dt><span class="term">User Permissions</span></dt><dd><p>
      The management tools (Virtual Machine Manager, <span class="command"><strong>virsh</strong></span>,
      <span class="command"><strong>vm-install</strong></span>) need to authenticate with
      <code class="systemitem">libvirt</code>—see <a class="xref" href="opensuse-kvm.html#cha.libvirt.connect" title="Chapter 6. Connecting and Authorizing">Chapter 6, <em>Connecting and Authorizing</em></a> for details.
      In order to invoke <span class="command"><strong>qemu-kvm</strong></span> from the command line,
      a user has to be a member of the group
      <code class="systemitem">kvm</code>.
     </p></dd><dt><span class="term">Suspending/Hibernating the VM Host Server</span></dt><dd><p>
      Suspending or hibernating the VM Host Server system while guests are running
      is not supported.
     </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.limits.hardware"></a>2.2. Hardware Limitations<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.limits.hardware">¶</a></span></h2></div></div></div><p>
   The following virtual hardware limits for guests have been tested. We
   ensure host and VMs install and work successfully, even when reaching the
   limits and there are no major performance regressions (CPU, memory, disk,
   network) since the last release (<span class="phrase">openSUSE</span> 11 SP1).
  </p><div class="informaltable"><table border="1"><colgroup><col class="c1" /><col class="c2" /></colgroup><tbody><tr><td>
       <p>
        <span class="emphasis"><em>Max. Guest RAM Size</em></span>
       </p>
      </td><td>
       <p>
        512 GB
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Max. Virtual CPUs per Guest</em></span>
       </p>
      </td><td>
       <p>
        64
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Max. Virtual Network Devices per Guest</em></span>
       </p>
      </td><td>
       <p>
        8
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Max. Block Devices per Guest</em></span>
       </p>
      </td><td>
       <p>
        4 emulated (IDE), 20 para-virtual (using
        <code class="systemitem">virtio-blk</code>)
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Max. Number of VM Guests per VM Host Server</em></span>
       </p>
      </td><td>
       <p>
        Limit is defined as the total number of virtual CPUs in all guests being no greater than 8 times the number of CPU cores in the host
       </p>
      </td></tr></tbody></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.limits.performance"></a>2.3. Performance Limitations<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.limits.performance">¶</a></span></h2></div></div></div><p>
   Basically, workloads designed for physical installations can be
   virtualized and therefore inherit the benefits of modern virtualization
   techniques. However, virtualization comes at the cost of a slight to
   moderate performance impact. You should always test your workload with
   the maximum anticipated CPU and I/O load to verify if it is suited for
   being virtualized. Although every reasonable effort is made to provide a
   broad virtualization solution to meet disparate needs, there will be
   cases where the workload itself is unsuited for KVM virtualization.
  </p><p>
   We therefore propose the following performance expectations for guests
   performance to be used as a guideline. The given percentage values are a
   comparison of performance achieved with the same workload under
   non-virtualized conditions. The values are rough approximations and
   cannot be guaranteed.
  </p><div class="informaltable"><table border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th>
       <p>
        Category
       </p>
      </th><th>
       <p>
        Fully Virtualized
       </p>
      </th><th>
       <p>
        Paravirtualized
       </p>
      </th><th>
       <p>
        Host Pass-through
       </p>
      </th></tr></thead><tbody><tr><td>
       <p>
        <span class="emphasis"><em>CPU, MMU</em></span>
       </p>
      </td><td>
       <p>
        7%
       </p>
      </td><td>
       <p>
        not applicable
       </p>
      </td><td>
       <table border="0" summary="Simple list" class="simplelist"><tr><td>
	 97% (Hardware Virtualization with Extended Page Tables(Intel)
	 or Nested Page Tables (AMD)
	</td></tr><tr><td>
	 85% (Hardware Virtualization with shadow page tables)
	</td></tr></table>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Network I/O (1GB LAN)</em></span>
       </p>
      </td><td>
       <p>
        60% (e1000 emulated NIC)
       </p>
      </td><td>
       <p>
        75% (<code class="systemitem">virtio-net</code>)
       </p>
      </td><td>
       <p>
        95%
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Disk I/O</em></span>
       </p>
      </td><td>
       <p>
        40% (IDE emulation)
       </p>
      </td><td>
       <p>
        85% (<code class="systemitem">virtio-blk</code>)
       </p>
      </td><td>
       <p>
        95%
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Graphics (non-accelerated)</em></span>
       </p>
      </td><td>
       <p>
        50% (VGA or Cirrus)
       </p>
      </td><td>
       <p>
        not applicable
       </p>
      </td><td>
       <p>
        not applicable
       </p>
      </td></tr><tr><td>
       <p>
        <span class="emphasis"><em>Time accuracy (worst case, using recommended settings
        without NTP)</em></span>
       </p>
      </td><td>
       <p>
        95% - 105% (where 100% = accurate)
       </p>
      </td><td>
       <p>
        100% (<code class="systemitem">kvm-clock</code>)
       </p>
      </td><td>
       <p>
        not applicable
       </p>
      </td></tr></tbody></table></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="id433346"></a>Part II. Managing Virtual Machines with <code class="systemitem">libvirt</code></h1></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.overview">3. Overview</a></span></dt><dt><span class="chapter"><a href="opensuse-kvm.html#cha.kvm.inst">4. Guest Installation</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vmm">4.1. Guest Installation with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vm-install">4.2. Installing from the Command Line with <span class="command"><strong>vm-install</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.advanced">4.3. Advanced Guest Installation Scenarios</a></span></dt></dl></dd><dt><span class="chapter"
><a href="opensuse-kvm.html#cha.libvirt.managing">5. Basic VM Guest Management</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.list">5.1. Listing VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.vnc">5.2. Opening a Graphical Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.status">5.3. Changing a VM Guest's State: Start, Stop, Pause</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.manage.save">5.4. Saving and Restoring VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.delete">5.5. Deleting a VM Guest</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.connect">6. Connecting and Authorizing</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.auth">6.1. Authentication</a></span></dt><dt><span class="sect1"><a href="
opensuse-kvm.html#sec.libvirt.connect.remote">6.2. Configuring Remote Connections</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.connecting">6.3. Connecting to a VM Host Server</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.storage">7. Managing Storage</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.vmm">7.1. Managing Storage with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.virsh">7.2. Managing Storage with <span class="command"><strong>virsh</strong></span></a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.config">8. Configuring Virtual Machines</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.tablet">8.1. Enabling Seamless and Synchronized Cursor Movement</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.
config.cdrom">8.2. Adding a CD/DVD-ROM Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.floppy">8.3. Adding a Floppy Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change">8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.kvm.managing.clock">8.5. Clock Settings</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.libvirt.admin">9. Administrating VM Guests</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.admin.migrate">9.1. Migrating VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.libvirt.admin.monitor">9.2. Monitoring</a></span></dt></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.overview"></
a>Chapter 3. Overview<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.overview">¶</a></span></h2></div></div></div><p>
  <code class="systemitem">libvirt</code> is a library that provides a common API for managing popular
  virtualization solutions, among them KVM and Xen. The library provides
  a normalized management API for these virtualization solutions, allowing a
  stable, cross-hypervisor interface for higher-level management tools. The
  library also provides APIs for management of virtual networks and storage
  on the VM Host Server. The configuration of each VM Guest is stored in an XML
  file.
 </p><p>
  With <code class="systemitem">libvirt</code> you can also manage your VM Guests remotely. It supports
  TLS encryption and x509 certificates as well as authentication with SASL.
 </p><p>
  The communication between the virtualization solutions and <code class="systemitem">libvirt</code> is
  managed by the daemon <code class="systemitem">libvirtd</code>. It is also used by the management tools.
  <code class="systemitem">libvirtd</code> needs to run on the VM Host Server and on any remote machine on which
  the <code class="systemitem">libvirt</code>-based tools are started. Use the following commands to
  start, stop it or check its status:
 </p><pre class="screen">~ # rclibvirtd start
Starting libvirtd                              done
~ # rclibvirtd status
Checking status of libvirtd                 running
~ # rclibvirtd stop
Shutting down libvirtd                         done
~ # rclibvirtd status
Checking status of libvirtd                  unused</pre><p>
  To automatically start <code class="systemitem">libvirtd</code> at boot time, either activate it using
  the YaST <span class="guimenu">System Services (Runlevel)</span> module or by
  entering the following command:
 </p><pre class="screen">insserv libvirtd</pre><p>
  The following <code class="systemitem">libvirt</code>-based tools are available on <span class="phrase">openSUSE</span>:
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Virtual Machine Manager (<span class="command"><strong>virt-manager</strong></span>)</span></dt><dd><p>
     The Virtual Machine Manager is a desktop tool for managing VM Guests. It provides the
     ability to control the life cycle of existing machines
     (bootup/shutdown, pause/resume, suspend/restore). It lets you create
     new VM Guests and various types of storage, and manage virtual
     networks. Access the graphical console of VM Guests with the built-in
     VNC viewer, and view performance statistics, all done locally or
     remotely.
    </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="60%"><tr><td><img src="images/virt_virt-manager.png" width="100%" /></td></tr></table></div></div><p>
     The Virtual Machine Manager does not need to run on the VM Host Server, it also lets you
     control VM Guests via remote connections. This enables you to manage
     VM Guests centrally from a single workstation without having to log in
     on the VM Host Server.
    </p><p>
     To start the Virtual Machine Manager, enter <span class="command"><strong>virt-manager</strong></span> at the
     command prompt.
    </p></dd><dt><span class="term"><span class="command"><strong>virt-viewer</strong></span>
   </span></dt><dd><p>
     A viewer for the graphical console of a VM Guest. It uses the VNC
     protocol and supports TLS and x509 certificates. VM Guests can be
     accessed by name, ID, or UUID. If the guest is not already running, the
     viewer can be told to wait until the guest starts, before attempting to
     connect to the console.
    </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="60%"><tr><td><img src="images/virt_virt-viewer.png" width="100%" /></td></tr></table></div></div></dd><dt><span class="term"><span class="command"><strong>vm-install</strong></span>
   </span></dt><dd><p>
     A tool to set up a VM Guest, configure its devices and start the
     operating system installation. Starts a GUI wizard when called from a
     graphical user interface. When invoked on a terminal, starts the wizard
     in command-line mode. <span class="command"><strong>vm-install</strong></span> is also started
     when creating a new virtual machine in the Virtual Machine Manager.
    </p></dd><dt><span class="term"><span class="command"><strong>virsh</strong></span>
   </span></dt><dd><p>
     A command line tool to manage VM Guests with similar functionality as
     the Virtual Machine Manager. Allows you to change a VM Guest's status (start, stop,
     pause, etc.) to set up new guests and devices and to edit existing
     configurations. <span class="command"><strong>virsh</strong></span> is also useful to script
     VM Guest management operations.
    </p><p>
     <span class="command"><strong>virsh</strong></span> basically works like Subversion's
     <span class="command"><strong>svn</strong></span> command or <span class="command"><strong>zypper</strong></span>: it takes
     the first arguments as a command and further arguments as options to
     this command:
    </p><pre class="screen">virsh [-c <em class="replaceable"><code>URI</code></em>] <em class="replaceable"><code>command</code></em> <em class="replaceable"><code>domain-id</code></em> [OPTIONS]</pre><p>
     Just like <span class="command"><strong>zypper</strong></span>, <span class="command"><strong>virsh</strong></span> can also
     be called without a command. In this case it starts a shell waiting for
     your commands. This mode is useful when having to run subsequent
     commands:
    </p><pre class="screen">~&gt; virsh -c qemu+ssh://root@mercury.example.com/system
Enter passphrase for key '/home/wilber/.ssh/id_rsa': 
Welcome to virsh, the virtualization interactive terminal.

Type:  'help' for help with commands
       'quit' to quit

virsh # hostname
mercury.example.com</pre></dd></dl></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.kvm.inst"></a>Chapter 4. Guest Installation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vmm">4.1. Guest Installation with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.vm-install">4.2. Installing from the Command Line with <span class="command"><strong>vm-install</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.inst.advanced">4.3. Advanced Guest Installation Scenarios</a></span></dt></dl></div><p>
  A VM Guest is comprised of an image containing an operating system and
  data files and a configuration file describing the VM Guest's virtual
  hardware resources. VM Guests are hosted on and controlled by the
  VM Host Server.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.inst.vmm"></a>4.1. Guest Installation with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.inst.vmm">¶</a></span></h2></div></div></div><p>
   Clicking <span class="guimenu">New</span> in the Virtual Machine Manager launches
   <span class="command"><strong>vm-install</strong></span>. It provides the graphical <span class="guimenu">Create
   Virtual Machine Wizard</span> that guides you through the guest
   installation. <span class="command"><strong>vm-install</strong></span> can also be run directly from
   the command-line or from YaST by choosing <span class="guimenu">Virtualization</span>+<span class="guimenu">Create Virtual
   Machine</span>.
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Start the <span class="guimenu">Create Virtual Machine Wizard</span> as described
     above and click <span class="guimenu">Forward</span>.
    </p></li><li><p>
     Choose whether to install an operation system or an already existing
     image or disk.
    </p></li><li><p>
     Select the operating system you want to install from the list. Each
     entry provides reasonable defaults for the chosen operating system.
    </p></li><li><p>
     The <span class="guimenu">Summary</span> page shows the default configuration for
     the chosen operating system. Edit the configuration by clicking on a
     headline. When having chosen to install a system, you at least have to
     specify either an image or a CD/DVD device from which to boot or choose
     PXE boot. When accepting the configuration with <span class="guimenu">OK</span>,
     the guest system boots to start the installation.
    </p></li></ol></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.kvm.inst.virtman.custom"></a>4.1.1. Customizing the Default Settings<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.virtman.custom">¶</a></span></h3></div></div></div><p>
    Change the proposed configuration by clicking on a headline in the
    Summary page of the Create Virtual Machine Wizard:
   </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="75%"><tr><td><img src="images/kvm_vminstall_step4.png" width="100%" /></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.name"></a>4.1.1.1. <span class="guimenu">Name of Virtual Machine</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.name">¶</a></span></h4></div></div></div><p>
     Specify a <span class="guimenu">Name</span> and an optional
     <span class="guimenu">Description</span> for the guest. The
     <span class="guimenu">Name</span> must contain only alphanumeric and
     <code class="literal">_-.:+</code> characters. It must be unique among all
     VM Guests on the VM Host Server. It is used to create and name the guest’s
     configuration file and you will be able to access the guest with this
     name from <span class="command"><strong>virsh</strong></span>.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.hardware"></a>4.1.1.2. <span class="guimenu">Hardware</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.hardware">¶</a></span></h4></div></div></div><p>
     Change memory and CPU assignments in this screen. It is recommended not
     to specify values larger than the resources the VM Host Server can provide
     (overcommit), since it may result in errors or performance penalties.
    </p><p>
     The <span class="guimenu">Advanced Settings</span> lets you activate or
     deactivate ACPI, APIC, and PAE. It is recommended not to change the
     default settings. You can also enable or disable para-virtualized I/O
     with <code class="systemitem">virtio</code> or choose to execute the kernel on
     boot (linux only) here.
    </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Para-Virtualized I/O"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Para-Virtualized I/O</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      If you enable para-virtualized I/O by activating
      <span class="guimenu">virtio</span>, all hard disks you create will be
      configured as <code class="systemitem">virtio</code> disks. If your operating
      system does not have appropriate drivers, the installation will fail.
      A Windows operating system installation even fails if providing a
      driver. By default, this feature is only activated for operating
      systems known to ship with <code class="systemitem">virtio</code> drivers.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.gfx"></a>4.1.1.3. <span class="guimenu">Peripheral Devices</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.gfx">¶</a></span></h4></div></div></div><p>
     Configure the type of virtualized graphics hardware, the keymap and
     sound device in this dialog. If you disable the graphics card support,
     the machine is only accessible via network services (ssh) or serial
     port. Sound in VM Guests is currently not supported by SUSE,
     therefore <span class="guimenu">Sound</span> should be set to
     <code class="literal">None</code>.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.disk"></a>4.1.1.4. <span class="guimenu">Disks</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.disk">¶</a></span></h4></div></div></div><p>
     <span class="guimenu">Disks</span>: Manage virtual hard disks and CD/DVD drives
     in this dialog. A VM Guest must have at least one virtual
     disk—either an existing one or a newly created disk. Virtual
     disks can be:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
       a single file with a fixed size
      </p></li><li class="listitem" style="list-style-type: disc"><p>
       a single file that grows on demand (<code class="literal">Sparse Image
       File)</code>
      </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Sufficient Space for Sparse Image Files"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Sufficient Space for Sparse Image Files</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        When creating sparse image files, the partition on which you create
        them always needs sufficient free space. The VM Guest has no means
        to check the VM Host Server disk space. Having no space left on the host
        partition causes write errors and loss of data on the guest system.
       </p></td></tr></table></div></li><li class="listitem" style="list-style-type: disc"><p>
       a block device, such as an entire disk, partition, or a network
       volume.
      </p></li></ul></div><p>
     For best performance, create each virtual disk from an entire disk or a
     partition. For the next best performance, create an image file but do
     not create it as a sparse image file. A virtual disk based on a sparse
     image file delivers the most disk space flexibility but slows
     installation and disk access speeds.
    </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: Live Migration"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">Live Migration</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      If you need to be able to migrate your VM Guest to another host
      without shutting it down (live migration), all disks must reside on a
      network resource (network file system or iSCSI volume) that is
      accessible from both hosts.
     </p></td></tr></table></div><p>
     By default, a single sparse raw disk image file is created in
     <code class="filename">/var/lib/kvm/images/<em class="replaceable"><code>VM_NAME</code></em>/</code>
     where <em class="replaceable"><code>VM_NAME</code></em> is the name of the virtual
     machine.
    </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Supported Disk format"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Supported Disk format</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Currently, only the disk formats <code class="literal">raw</code>,
      <code class="literal">qed</code> and <code class="literal">qcow2</code> are supported by
      SUSE.
     </p></td></tr></table></div><div class="procedure"><a id="id717105"></a><p class="title"><strong>Procedure 4.1. Creating a Virtual Disk</strong></p><ol class="procedure" type="1"><li><p>
       Click <span class="guimenu">Harddisk</span>.
      </p></li><li><p>
       Enter a <span class="guimenu">Source</span>. If creating a file-backed disk,
       either enter the path directly or click <span class="guimenu">New</span>. When
       creating a disk from a device, enter the device node, for example
       <code class="filename">/dev/disk/by-path/<em class="replaceable"><code>path</code></em></code>.
       It is strongly recommended not to use the simple device paths such as
       <code class="filename">/dev/sdb</code> or <code class="filename">/dev/sda5</code>,
       since they may change (by adding a disk or by changing the disk order
       in the BIOS).
      </p></li><li><p>
       Specify the <span class="guimenu">Protocol</span>. For creating
       <code class="literal">raw</code> disks, choose either <span class="guimenu">file</span>
       for file-backed virtual disks or <span class="guimenu">phy</span> for
       device-backed disks. <code class="literal">qcow2</code> or
       <code class="literal">qed</code> disks can be created by choosing the
       corresponding value.
      </p></li><li><p>
       Enter a <span class="guimenu">Size</span> in GB. This option is only available
       for file-backed disks.
      </p></li><li><p>
       Choose whether to create a <span class="guimenu">Sparse Image File</span>. This
       option is only available for file-backed disks. If you want to
       disable write-access to the disk, choose <span class="guimenu">Read-Only
       Access</span>.
      </p></li></ol></div><p>
     If you want to install from DVD or CD-ROM, add the drive to the list of
     available hard disks. To learn about device nodes of the available
     optical drives, run:
    </p><pre class="screen">hwinfo --cdrom | egrep "(Device File:|Model:)"</pre><p>
     Instead of the real DVD or CD-ROM drive, you can also add the ISO image
     of an installation medium. Note that each CD-Rom drive or ISO image can
     only be used by one guest at the same time.
    </p><p>
     To add a CD/DVD-ROM device or an ISO image, proceed as follows:
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Click <span class="guimenu">CD-ROM</span>.
      </p></li><li><p>
       Enter a <span class="guimenu">Source</span>. If adding a device, enter its
       node. If adding an ISO image, either enter the path directly or click
       <span class="guimenu">Browse</span> to open a file browser.
      </p></li><li><p>
       Specify the <span class="guimenu">Protocol</span>. Choose
       <span class="guimenu">file</span> for an ISO image and <span class="guimenu">phy</span>
       for a device.
      </p></li></ol></div><p>
     The disks are listed in the order in which they have been created. This
     order also represents the boot order. Use the <span class="guimenu">Up</span> and
     <span class="guimenu">Down</span> arrows to change the disk order.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.nic"></a>4.1.1.5. <span class="guimenu">Network Adapters</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.nic">¶</a></span></h4></div></div></div><p>
     By default, a single virtual network card is created for the virtual
     machine. It has a randomly generated MAC address that you can change to
     fit your desired configuration. If a bridge exists on the VM Host Server, the
     virtual network card will be attached to it, otherwise it will be
     attached to the <code class="systemitem">libvirt's</code>
     default virtual bridge
     (<code class="systemitem">virbr1</code>).

    </p><p>
     To add a new network adapter or edit an existing one, proceed as
     follows:
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Click <span class="guimenu">New</span> to add a card or <span class="guimenu">Edit</span>
       to change the configuration of the selected card.
      </p></li><li><p>
       Choose a <span class="guimenu">Type</span> from the drop-down list.
      </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Supported Virtual Network Adapter Types"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Supported Virtual Network Adapter Types</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Currently, only <span class="guimenu">Fully Virtualized Realtek 8139</span>,
        <span class="guimenu">Fully Virtualized Intel e1000</span> or
        the paravirtualized <span class="guimenu">QEMU Virtualized NIC Card</span>
        (<code class="systemitem">virtio</code>) are supported by SUSE.
       </p></td></tr></table></div></li><li><p>
       Choose a <span class="guimenu">Source</span> from the drop-down list.
      </p></li><li><p>
       Choose whether to assign a randomly generated MAC address or manually
       specify an address.
      </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: MAC addresses need to be unique"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">MAC addresses need to be unique</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        When choosing to manually specify a MAC address, make sure it is not
        already used in your network. If so, it may result in network
        problems, especially when using DHCP. Therefore avoid specifying
        obvious MAC addresses such as 52:54:00:12:34:56 or 52:54:00:11:22:33,
        because they may already be in use. It is
        strongly recommended to always use a randomly generated MAC address
        for each adapter.
       </p></td></tr></table></div></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.kvm.inst.vmm.custom.install"></a>4.1.1.6. <span class="guimenu">Operating System Installation</span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.vmm.custom.install">¶</a></span></h4></div></div></div><p>
     This dialog is only available when having chosen to install an
     operating system. The installation can be booted from a virtual disk,
     from a CD/DVD device, from an ISO image, a network resource or via PXE
     boot—use this dialog to configure the boot device.
    </p><p>
     Also use this dialog to configure the behavior of the VM Guest when
     the operating system is powered off, rebooted or if it crashes. The
     following options are available
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="guimenu">destroy</span>
      </span></dt><dd><p>
        normal cleanup
       </p></dd><dt><span class="term"><span class="guimenu">restart</span>
      </span></dt><dd><p>
        a new VM Guest is started in place of the old one
       </p></dd><dt><span class="term"><span class="guimenu">preserve</span>
      </span></dt><dd><p>
        no cleanup, do not delete temporary, configuration and image files
       </p></dd><dt><span class="term"><span class="guimenu">rename-restart</span>
      </span></dt><dd><p>
        the VM Guest is not cleaned up but is renamed and a new domain
        started in its place
       </p></dd><dt><span class="term"><span class="guimenu">coredump-destroy</span>
      </span></dt><dd><p>
        a crashed machine's core is dumped before a normal cleanup is
        performed
       </p></dd><dt><span class="term"><span class="guimenu">coredump-restart</span>
      </span></dt><dd><p>
        a crashed machine's core is dumped before a normal restart is
        performed
       </p></dd></dl></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.inst.vm-install"></a>4.2. Installing from the Command Line with <span class="command"><strong>vm-install</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.inst.vm-install">¶</a></span></h2></div></div></div><p>
   If <code class="envar">$DISPLAY</code> is not set (for example, when operating on a
   console or on an ssh shell with no X-forwarding),
   <span class="command"><strong>vm-install</strong></span> offers a command-line wizard to
   interactively set up a VM Guest for installation. Once the setup is
   completed, the newly created guest boots into the installation system
   which can be connected via VNC.
  </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Graphical User Interface needed for Installation"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Graphical User Interface needed for Installation</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Once the VM Guest boots into the installation, you need to connect to
    the graphical console via VNC to attend the installation. Therefore, you
    need to start the viewer from a graphical user interface.
   </p><p>
    If you are working from a console with no access to a graphical user
    interface, you can set up the VM Guest configuration and start the
    installation at a later time. Refer to
    <a class="xref" href="opensuse-kvm.html#sec.libvirt.inst.vm-install.prepare" title="4.2.1. Defining a VM Guest without Starting the Installation">Section 4.2.1, “Defining a VM Guest without Starting the Installation”</a> for
    instructions.
   </p></td></tr></table></div><p>
   To start the wizard, just type <span class="command"><strong>vm-install</strong></span> to start.
   For a lot of parameters, the installation wizard already provides
   reasonable defaults which you can confirm by just pressing
   <span class="keycap">Enter</span>. Here is a log of an interactive setup for
   a SUSE Linux Enterprise Server 11 installation:
  </p><div class="example"><a id="ex.libvirt.inst.vm-install.interactive"></a><p class="title"><strong>Example 4.1. Interactive Setup on the Command Line Using <span class="command">vm-install</span></strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.libvirt.inst.vm-install.interactive">¶</a></span></p><div class="example-contents"><pre class="screen">~ # vm-install 
Gathering settings...

Please specify the type of operating system that will run within the virtual
machine.  This defines many defaults, and helps decide how to start
paravirtualized operating systems.
Press 'q' or the Escape key to exit.
  1: Novell Open Enterprise Server 2 (Linux)
  2: Novell Open Enterprise Server 2 (NetWare)
  3: Other operating system
  4: PXE
  5: RedHat (other)
  6: RedHat Enterprise Linux 3
  7: RedHat Enterprise Linux 4
  8: RedHat Enterprise Linux 5
  9: SUSE (other)
 10: SUSE Linux Enterprise Desktop 10
 11: SUSE Linux Enterprise Desktop 11
 12: SUSE Linux Enterprise Server 8
 13: SUSE Linux Enterprise Server 9
 14: SUSE Linux Enterprise Server 10
 15: SUSE Linux Enterprise Server 11
 16: Solaris 9 and older
 17: Solaris 10
 18: Windows (other)
 19: Windows (other, x64)
 20: Windows NT
 21: Windows Server 2008
 22: Windows Server 2008 (x64)
 23: Windows Vista, Windows 7
 24: Windows Vista, Windows 7 (x64)
 25: Windows XP, 2000, 2003
 26: Windows XP, 2003 (x64)
 27: openSUSE
 28: openSUSE 11
[15] &gt;

PXE Boot
(Y / N) [N] &gt;  
Please choose a name for the virtual machine.
[sles11] &gt; 

Description &gt; SLES 11 SP1

Specify the amount of memory and number of processors to allocate for the VM.
Initial Memory [512] &gt; 
Maximum Memory [512] &gt; 768
Warning: Setting the maximum memory greater than the initial memory requires
the VM operating system to have a memory balloon driver.
Virtual Processors [2] &gt;

Please specify the type of virtualized graphics hardware.
  1: Cirrus Logic GD5446 VGA
  2: No Graphics Support
  3: VESA VGA
[1] &gt; 

Virtual Disks:
  (None)
Do you want to add another virtual disk?
(Y / N) [Y] &gt; 

Create a virtual disk based on a device (CD or other block device), an existing
image file (ISO), or a new file.  Specify a device by its device node, such as
/dev/cdrom, not its mount point.
What type of virtual disk do you want to add?
  1: CD-ROM or DVD
  2: Floppy
  3: Hard Disk
[3] &gt; 3
Where will the virtual disk physically reside?
[/var/lib/kvm/images/sles11/hda] &gt; 
Size (GB) [4.0] &gt; 8.0
Create a sparse image file for the virtual disk?
(Y / N) [Y] &gt; 

Virtual Disks:
  8.0 GB Hard Disk (file:/var/lib/kvm/images/sles11/hda)
Do you want to add another virtual disk?
(Y / N) [N] &gt; y

Create a virtual disk based on a device (CD or other block device), an existing
image file (ISO), or a new file.  Specify a device by its device node, such as
/dev/cdrom, not its mount point.
What type of virtual disk do you want to add?
  1: CD-ROM or DVD
  2: Floppy
  3: Hard Disk
[3] &gt; 1
Where will the virtual disk physically reside?
[/var/lib/kvm/images/sles11/hdb] &gt; /isos/SLES-11-SP1-CD-i386-GM-CD1.iso

Virtual Disks:
  8.0 GB Hard Disk (file:/var/lib/kvm/images/sles11/hda)
  2.9 GB CD-ROM or DVD (file:/isos/SLES-11-SP1-DVD-x86_64-GM-DVD1.iso)
Do you want to add another virtual disk?
(Y / N) [N] &gt; 

Network Adapters
  (None)
Do you want to add another virtual network adapter?
(Y / N) [Y] &gt; 
What type of virtual network adapter do you want to add?
  1: Fully Virtualized AMD PCnet 32
  2: Fully Virtualized Intel e100
  3: Fully Virtualized Intel e1000
  4: Fully Virtualized NE2000 (ISA Bus)
  5: Fully Virtualized NE2000 (PCI Bus)
  6: Fully Virtualized Realtek 8139
  7: Paravirtualized
[6] &gt; 7

Network Adapters
  Paravirtualized; Randomly generated MAC address
Do you want to add another virtual network adapter?
(Y / N) [N] &gt; 

Preparing to start the installation...

Installing...</pre></div></div><br class="example-break" /><p>
   You may also provide parameters on the command line. The wizard will then
   prompt you for any missing parameters. In the following all parameters
   from <a class="xref" href="opensuse-kvm.html#ex.libvirt.inst.vm-install.interactive" title="Example 4.1. Interactive Setup on the Command Line Using vm-install">Example 4.1, “Interactive Setup on the Command Line Using <span class="command">vm-install</span>”</a> for which a
   command line switch exists, are specified. See <span class="command"><strong>man 8
   vm-install</strong></span> for a full list of parameters.
  </p><div class="example"><a id="ex.libvirt.inst.vm-install.noninteractive"></a><p class="title"><strong>Example 4.2. <span class="command">vm-install</span> command line switches</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.libvirt.inst.vm-install.noninteractive">¶</a></span></p><div class="example-contents"><pre class="screen">vm-install --os-type sles11<a id="co.vm-install.ostype"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> --name "sles11_test"<a id="co.vm-install.name"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> \
--vcpus 2<a id="co.vm-install.cpu"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> --memory 512<a id="co.vm-install.minmam"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> --max-memory 768<a id="co.vm-install.maxmem"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> \
--disk /var/lib/kvm/images/sles11/hda,0,disk,w,8000,sparse=1 <a id="co.vm-install.hdd"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> \
--disk /iso/SLES-11-SP1-DVD-x86_64-GM-DVD1.iso,1,cdrom<a id="co.vm-install.cdrom"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a> \
--nic mac=52:54:00:05:11:11,model=virtio<a id="co.vm-install.nic"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a> \
--graphics cirrus<a id="co.vm-install.graphics"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a> --config-dir "/etc/libvirt/qemu"<a id="co.vm-install.conf"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a></pre></div></div><br class="example-break" /><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.ostype"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specifies the guest operating system to define suitable defaults. A
     list of valid values can be obtained with <span class="command"><strong>vm-install
     <code class="option">-O</code></strong></span>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.name"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Name of the VM Guest. This name must be unique.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.cpu"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Number of virtual processors.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.minmam"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Initial amount of memory.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.maxmem"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Maximum amount of memory. Requires an operating system with a
     para-virtualized <span class="guimenu">virtio-balloon</span> driver.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.hdd"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines a virtual hard disk. The file is located at
     <code class="filename">/var/lib/kvm/images/sles11/hda</code>. It is configured
     as the first (<code class="literal">0</code>) hard disk
     (<code class="literal">disk</code>). It is writable (<code class="literal">w</code>) with a
     size of 8 GB (<code class="literal">8000</code>). The file on the VM Host Server is a
     sparse file (<code class="literal">sparse=1</code>).
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.cdrom"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines an ISO image for a CD-ROM as the second (<code class="literal">1</code>)
     block device.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.nic"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Configures a para-virtualized network device with the MAC address
     <code class="literal">52:54:00:05:11:11</code>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.graphics"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specifies the graphics card.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vm-install.conf"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     The directory in which the XML configuration file for the virtual
     machine will be stored. It is strongly recommended to use the default
     directory <code class="filename">/etc/libvirt/qemu</code>.
    </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.inst.vm-install.prepare"></a>4.2.1. Defining a VM Guest without Starting the Installation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.inst.vm-install.prepare">¶</a></span></h3></div></div></div><p>
    <span class="command"><strong>vm-install</strong></span> provides the <code class="option">--no-install</code>
    parameter. With this parameter the XML configuration file defining the
    VM Guest is created, but the guest is not booted automatically. You may
    use it regardless whether you start <span class="command"><strong>vm-install</strong></span> in
    wizard mode or whether you specify all other options in the command
    line. You can start the installation.
   </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: No Virtual Disk Creation"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">No Virtual Disk Creation</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     When using the <code class="option">--no-install</code> parameter with
     <span class="command"><strong>vm-install</strong></span>, no virtual disks will be created.
     Therefore, you have to create the disks in advance using either
     <span class="command"><strong>qemu-img</strong></span> or <span class="command"><strong>virsh</strong></span>.
    </p></td></tr></table></div><p>
    Once the VM Guest XML configuration file is successfully created, you
    need to <span class="quote">“<span class="quote">register</span>”</span> it so it is recognized by Virtual Machine Manager or
    <span class="command"><strong>virsh</strong></span>. Do so by running:
   </p><pre class="screen">virsh -c qemu:///system define <em class="replaceable"><code>PATH_TO_XMLFILE</code></em></pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.inst.advanced"></a>4.3. Advanced Guest Installation Scenarios<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.inst.advanced">¶</a></span></h2></div></div></div><p>
   This section provides instructions for operations exceeding the scope of
   a normal installation, such as including add-on packages.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.kvm.inst.virtman_advanced.addons"></a>4.3.1. Including Add-On Products in the Installation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.kvm.inst.virtman_advanced.addons">¶</a></span></h3></div></div></div><p>
    Some operating systems such as <span class="phrase">openSUSE and</span>
    SUSE Linux Enterprise Server offer to include add-on products in the installation process. In
    case the add-on product installation source is provided via network, no
    special VM Guest configuration is needed.  If it is provided via CD/DVD
    or ISO image, it is necessary to provide the VM Guest installation system
    with both, the standard installation images and the image for the add-on
    product.
   </p><p>
    First add the standard installation image, and second the physical
    CD/DVD-ROM or add-on image. The image or device added first is
    automatically chosen as the boot image. In case you install <span class="phrase">openSUSE or</span> SUSE Linux Enterprise Server, it will be configured as
    <code class="filename">/dev/sr0</code>, while the add-on product source will be
    configured as <code class="filename">/dev/sr1</code>.
   </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.managing"></a>Chapter 5. Basic VM Guest Management<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.managing">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.list">5.1. Listing VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.vnc">5.2. Opening a Graphical Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.status">5.3. Changing a VM Guest's State: Start, Stop, Pause</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.manage.save">5.4. Saving and Restoring VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.managing.delete">5.5. Deleting a VM Guest</a></span></dt></dl></div><p>
  Basic management tasks such as starting or stopping a VM Guest, can
  either be done using the graphical application Virtual Machine Manager or on the command
  line using <span class="command"><strong>virsh</strong></span>. Connecting to the graphical console
  via VNC is only possible from a graphical user interface.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.managing.list"></a>5.1. Listing VM Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.list">¶</a></span></h2></div></div></div><p>
   In order to be able to list VM Guests, you need to connect to a VM Host Server
   first. If you start the management tool on the VM Host Server itself, you are
   automatically connected. When operating from remote, refer to
   <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.connecting" title="6.3. Connecting to a VM Host Server">Section 6.3, “Connecting to a VM Host Server”</a> for instructions.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.list.vmm"></a>5.1.1. Listing VM Guests with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.list.vmm">¶</a></span></h3></div></div></div><p>
    The main Window of the Virtual Machine Manager shows a list of all VM Guests for each
    VM Host Server it is connected to. Each VM Guest entry contains the machine's
    name, its status (<span class="guimenu">Running</span>, <span class="guimenu">Paused</span>,
    or <span class="guimenu">Shutoff</span>) displayed as icon and literal, and a CPU
    usage bar.
   </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.list.virsh"></a>5.1.2. Listing VM Guests with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.list.virsh">¶</a></span></h3></div></div></div><p>
    Use the command <span class="command"><strong>virsh <code class="option">list</code></strong></span> to get a
    list of VM Guests:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">List running guests on <code class="systemitem">localhost</code>
     </span></dt><dd><pre class="screen">virsh -c qemu:///system list</pre></dd><dt><span class="term">List running and inactive guests as user <code class="systemitem">root</code>s on a remote host over a TLS connection</span></dt><dd><pre class="screen">virsh -c qemu+tls://root@mercury.example.com/system list --all</pre></dd><dt><span class="term">List running and inactive guests as user tux on a remote host over an SSH tunnel</span></dt><dd><pre class="screen">virsh -c qemu+ssh://tux@mercury.example.com/system list --inactive</pre></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.managing.vnc"></a>5.2. Opening a Graphical Console<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.vnc">¶</a></span></h2></div></div></div><p>
   Opening a Graphical Console to a VM Guest lets you interact with the
   machine like a physical host via a VNC connection. If accessing the VNC
   server requires authentication, you are prompted to enter a user name (if
   applicable) and a password.
  </p><p>
   Once you click into the VNC console, the cursor is <span class="quote">“<span class="quote">grabbed</span>”</span>
   and cannot be used outside the console anymore. To release it, press
   <span class="keycap">Alt</span>+<span class="keycap">Ctrl</span>.
  </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: Seamless (Absolute) Cursor Movement"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">Seamless (Absolute) Cursor Movement</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    In order to prevent the console from grabbing the cursor and to enable
    seamless cursor movement, add a tablet input device to the VM Guest.
    See <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.tablet" title="8.1. Enabling Seamless and Synchronized Cursor Movement">Section 8.1, “Enabling Seamless and Synchronized Cursor Movement”</a> for more information.
   </p></td></tr></table></div><p>
   Certain key combinations such as <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span>+<span class="keycap">Del</span> are
   interpreted by the host system and are not passed to the VM Guest.
  </p><p>
   To pass such key combinations to a VM Guest, open the <span class="guimenu">Send
   Key</span> menu from the VNC window and choose the desired key
   combination entry. The <span class="guimenu">Send Key</span> menu is only available
   when using Virtual Machine Manager and <span class="command"><strong>virt-viewer</strong></span>
  </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Supported VNC Viewer"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Supported VNC Viewer</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Principally all VNC viewers are able to connect to the console of a
    VM Guest. However, if you are using SASL authentication and/or TLS/SSL
    connection to access the guest, the options become limited. Common VNC
    viewers such as <code class="literal">tightvnc</code> or
    <code class="literal">tigervnc</code> support neither SASL authentication or
    TSL/SSL. The only supported alternative to Virtual Machine Manager and
    <span class="command"><strong>virt-viewer</strong></span> is <span class="command"><strong>vinagre</strong></span>.
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.vnc.vmm"></a>5.2.1. Opening a Graphical Console with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.vnc.vmm">¶</a></span></h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li><p>
      In the Virtual Machine Manager, right-click on a VM Guest entry.
     </p></li><li><p>
      Choose <span class="guimenu">Open</span> from the pop-up menu.
     </p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.vnc.viewer"></a>5.2.2. Opening a Graphical Console with <span class="command"><strong>virt-viewer</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.vnc.viewer">¶</a></span></h3></div></div></div><p>
    <span class="command"><strong>virt-viewer</strong></span> is a simple VNC viewer with added
    functionality for displaying VM Guest consoles. It can, for example, be
    started in <span class="quote">“<span class="quote">wait</span>”</span> mode, where it waits for a VM Guest to
    start before it connects. It also supports automatically reconnecting to
    a VM Guest that is rebooted.
   </p><p>
    <span class="command"><strong>virt-viewer</strong></span> addresses VM Guests by name, by ID or by
    UUID. Use <span class="command"><strong>virsh <code class="option">list --all</code></strong></span> to get
    this data.
   </p><p>
    To connect to a guest that is running or paused, either use the ID,
    UUID, or name. VM Guests that are shut off do not have an ID—you
    can only connect by UUID or name.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Local connect to guest with ID 8</span></dt><dd><pre class="screen">virt-viewer -c qemu:///system 8</pre></dd><dt><span class="term">Local connect to the inactive guest sles11; will connect once the guest starts</span></dt><dd><pre class="screen">virt-viewer -c qemu:///system --wait sles11</pre><p>
       With the <code class="option">--wait</code> option, the connection will be
       upheld even if the VM Guest is not running at the moment. Once the
       guest starts, the viewer will be launched.
      </p></dd><dt><span class="term">Remote connect via ssh:</span></dt><dd><pre class="screen">virt-viewer -c qemu+ssh://root@mercury.example.com/system -w sles11</pre></dd></dl></div><p>
    For more information, see <span class="command"><strong>virt-viewer
    <code class="option">--help</code></strong></span> or <span class="command"><strong>man 1
    virt-viewer</strong></span>.
   </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.managing.status"></a>5.3. Changing a VM Guest's State: Start, Stop, Pause<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.status">¶</a></span></h2></div></div></div><p>
   Starting, stopping or pausing a VM Guest can either be done with Virtual Machine Manager
   or <span class="command"><strong>virsh</strong></span>. You can also configure a VM Guest to be
   automatically started when booting the VM Host Server.
  </p><p>
   When shutting down a VM Guest, you may either shut it down gracefully,
   or force the shutdown. The latter is equivalent to pulling the power plug
   on a physical host and is only recommended if there are no alternatives.
   Forcing a shutdown may cause file system corruption and loss of data on
   the VM Guest.
  </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: Graceful Shutdown"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">Graceful Shutdown</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    In order to be able to perform a graceful shutdown, the VM Guest must
    be configured to support ACPI. If you have created the guest with
    <span class="command"><strong>vm-install</strong></span> or with Virtual Machine Manager, ACPI should be available.
    Use the following procedure in Virtual Machine Manager to check:
   </p><p>
    Double-click the VM Guest entry in Virtual Machine Manager. Choose <span class="guimenu">View</span>+<span class="guimenu">Details</span> and
    then <span class="guimenu">Overview</span>+<span class="guimenu">Machine
    Settings</span>. <span class="guimenu">ACPI</span> should be
    checked.
   </p><p>
    Depending on the guest operating system, enabling ACPI may not be
    sufficient. It is strongly recommended to test shutting down and
    rebooting a guest before releasing it to production. openSUSE or
    SUSE Linux Enterprise Desktop, for example, may require PolicyKit authorization for shutdown and
    reboot. Make sure this policy is turned off on all VM Guests.
   </p><p>
    If ACPI was enabled during a Windows XP/Server 2003 guest installation,
    turning it on in the VM Guest configuration alone is not sufficient.
    See the following articles for more information:
   </p><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="ulink" href="http://support.microsoft.com/kb/314088/EN-US/" target="_top">http://support.microsoft.com/kb/314088/EN-US/</a>
    </td></tr><tr><td><a class="ulink" href="http://support.microsoft.com/?kbid=309283" target="_top">http://support.microsoft.com/?kbid=309283</a>
    </td></tr></table><p>
    A graceful shutdown is of course always possible from within the guest
    operating system, regardless of the VM Guest's configuration.
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.status.vmm"></a>5.3.1. Changing a VM Guest's State with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.status.vmm">¶</a></span></h3></div></div></div><p>
    Changing a VM Guest's state can either be done from Virtual Machine Manager's main
    window, or from a VNC window.
   </p><div class="procedure"><a id="id712136"></a><p class="title"><strong>Procedure 5.1. State Change from the Virtual Machine Manager Window</strong></p><ol class="procedure" type="1"><li><p>
      Right-click on a VM Guest entry.
     </p></li><li><p>
      Choose <span class="guimenu">Run</span>, <span class="guimenu">Pause</span>, or one of the
      <span class="guimenu">Shutdown options</span> from the pop-up menu.
     </p></li></ol></div><div class="procedure"><a id="id707340"></a><p class="title"><strong>Procedure 5.2. State change from the VNC Window</strong></p><ol class="procedure" type="1"><li><p>
      Open a VNC Window as described in
      <a class="xref" href="opensuse-kvm.html#sec.libvirt.managing.vnc.vmm" title="5.2.1. Opening a Graphical Console with Virtual Machine Manager">Section 5.2.1, “Opening a Graphical Console with Virtual Machine Manager”</a>.
     </p></li><li><p>
      Choose <span class="guimenu">Run</span>, <span class="guimenu">Pause</span>, or one of the
      <span class="guimenu">Shut Down</span> options either from the toolbar or from
      the <span class="guimenu">Virtual Machine</span> menu.
     </p></li></ol></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.managing.status.vmm.autostart"></a>5.3.1.1. Autostarting a VM Guest<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.status.vmm.autostart">¶</a></span></h4></div></div></div><p>
     Automatically starting a guest when the VM Host Server boots is not enabled
     by default. This feature needs to be turned on for each VM Guest
     individually. There is no way to activate it globally.
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Double-click the VM Guest entry in Virtual Machine Manager to open its console.
      </p></li><li><p>
       Choose <span class="guimenu">View</span>+<span class="guimenu">Details</span> to open the VM Guest
       configuration window.
      </p></li><li><p>
       Choose <span class="guimenu">Boot Options</span> and check <span class="guimenu">Start
       virtual machine on host boot up</span>.
      </p></li><li><p>
       Save the new configuration with <span class="guimenu">Apply</span>.
      </p></li></ol></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.status.virsh"></a>5.3.2. Changing a VM Guest's State with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.status.virsh">¶</a></span></h3></div></div></div><p>
    In the following examples the state of a VM Guest named
    <span class="quote">“<span class="quote">sles11</span>”</span> is changed.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Start</span></dt><dd><pre class="screen">virsh -c qemu:///system start sles11</pre></dd><dt><span class="term">Pause</span></dt><dd><pre class="screen">virsh -c qemu:///system suspend sles11</pre></dd><dt><span class="term">Reboot</span></dt><dd><pre class="screen">virsh -c qemu:///system reboot sles11</pre></dd><dt><span class="term">Graceful shutdown</span></dt><dd><pre class="screen">virsh -c qemu:///system shutdown sles11</pre></dd><dt><span class="term">Force shutdown</span></dt><dd><pre class="screen">virsh -c qemu:///system destroy sles11</pre></dd><dt><span class="term">Turn on autostart</span></dt><dd><pre class="screen">virsh -c qemu:///system autostart sles11</pre></dd><dt><span class="term">Turn off autostart</span></dt><dd><pre class="screen">virsh -c qemu:///system autostart --disable sles11</pre></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a 
id="sec.libvirt.manage.save"></a>5.4. Saving and Restoring VM Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.manage.save">¶</a></span></h2></div></div></div><p>
   Saving a VM Guest preserves the exact state of the guest’s memory. The
   operation is slightly similar to <span class="emphasis"><em>hibernating</em></span> a
   computer. A saved VM Guest can be quickly restored to its previously
   saved running condition.
  </p><p>
   When saved, the VM Guest is paused, its current memory state is saved to
   disk, and then the guest is stopped. The operation does not make a copy
   of any portion of the VM Guest’s virtual disk. The amount of time to
   save the virtual machine depends on the amount of memory allocated. When
   saved, a VM Guest’s memory is returned to the pool of memory available
   on the VM Host Server.
  </p><p>
   The restore operation loads a VM Guest’s previously saved memory state
   file and starts it. The guest is not booted but rather resumes at the
   point where it was previously saved. The operation is slightly similar to
   coming out of hibernation.
  </p><p>
   The VM Guest is saved to a state file. Make sure there is enough space
   on the partition you are going to save to. Issue the following command on
   the guest to get a rough estimation of the file size in megabytes to be
   expected:
  </p><pre class="screen">free -m | awk '/^Mem:/ {print $3}'</pre><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    After using the save operation, do not boot, start, or run the saved
    VM Guest. Doing so would cause the machine's virtual disk and the saved
    memory state getting out of sync and can result in critical errors when
    restoring the guest.
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.manage.save.vmm"></a>5.4.1. Saving / Restoring with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.manage.save.vmm">¶</a></span></h3></div></div></div><div class="procedure"><a id="id704850"></a><p class="title"><strong>Procedure 5.3. Saving a VM Guest</strong></p><ol class="procedure" type="1"><li><p>
      Open a VNC connection window to a VM Guest. Make sure the guest is
      running.
     </p></li><li><p>
      Choose <span class="guimenu">Virtual Machine</span>+<span class="guimenu">Save</span>
     </p></li><li><p>
      Choose a location and a file name.
     </p></li><li><p>
      Click <span class="guimenu">Save</span>. Saving the guest's state may take some
      time. After the operation has finished, the VM Guest will
      automatically shut down.
     </p></li></ol></div><div class="procedure"><a id="id706870"></a><p class="title"><strong>Procedure 5.4. Restoring a VM Guest</strong></p><ol class="procedure" type="1"><li><p>
      Start the Virtual Machine Manager.
     </p></li><li><p>
      Type <span class="keycap">Alt</span>+<span class="keycap">R</span> or choose <span class="guimenu">File</span>+<span class="guimenu">Restore Saved Machine</span>.
     </p></li><li><p>
      Choose the file you want to restore and proceed with
      <span class="guimenu">Open</span>. Once the file has been successfully loaded,
      the VM Guest is up and running.
     </p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.manage.save.virsh"></a>5.4.2. Saving / Restoring with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.manage.save.virsh">¶</a></span></h3></div></div></div><p>
    Save a running VM Guest with the command <span class="command"><strong>virsh
    <code class="option">save</code></strong></span> and specify the file to where it is
    saved.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Save the guest named opensuse11</span></dt><dd><pre class="screen">virsh save opensuse11 /virtual/saves/opensuse11.vmsav</pre></dd><dt><span class="term">Save the guest with the ID 37</span></dt><dd><pre class="screen">virsh save 37 /virtual/saves/opensuse11.vmsave</pre></dd></dl></div><p>
    To restore it, use <span class="command"><strong>virsh <code class="option">restore</code></strong></span>:
   </p><pre class="screen">virsh restore /virtual/saves/opensuse11.vmsave</pre></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.managing.delete"></a>5.5. Deleting a VM Guest<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.delete">¶</a></span></h2></div></div></div><p>
   Deleting a VM Guest removes its XML configuration by default. Since the
   attached storage is not deleted by default, you will be able to use it
   with another VM Guest. With Virtual Machine Manager you may also delete a guest's storage
   files as well—this will completely erase the guest.
  </p><p>
   In order to delete a VM Guest, it has to be shut down first (refer to
   <a class="xref" href="opensuse-kvm.html#sec.libvirt.managing.status" title="5.3. Changing a VM Guest's State: Start, Stop, Pause">Section 5.3, “Changing a VM Guest's State: Start, Stop, Pause”</a> for instructions). It is
   not possible to delete a running guest.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.delete.vmm"></a>5.5.1. Deleting a VM Guest with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.delete.vmm">¶</a></span></h3></div></div></div><div class="procedure"><ol class="procedure" type="1"><li><p>
      In the Virtual Machine Manager, right-click on a VM Guest entry.
     </p></li><li><p>
      Choose <span class="guimenu">Delete</span> from the pop-up menu.
     </p></li><li><p>
      A confirmation window opens. Clicking <span class="guimenu">Delete</span> will
      permanently erase the VM Guest. The deletion is not recoverable.
     </p><p>
      You may also choose to permanently delete the guest's virtual disk by
      ticking <span class="guimenu">Delete Associated Storage Files</span>. The
      deletion is not recoverable either.
     </p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.managing.delete.virsh"></a>5.5.2. Deleting a VM Guest with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.managing.delete.virsh">¶</a></span></h3></div></div></div><p>
    To delete a VM Guest with <span class="command"><strong>virsh</strong></span> run <span class="command"><strong>virsh
    <code class="option">undefine</code> <em class="replaceable"><code>VM_NAME</code></em></strong></span>.
    There is no option to automatically delete the attached storage files.
   </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.connect"></a>Chapter 6. Connecting and Authorizing<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.connect">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.auth">6.1. Authentication</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.remote">6.2. Configuring Remote Connections</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.connect.connecting">6.3. Connecting to a VM Host Server</a></span></dt></dl></div><p>
  Having to manage several VM Host Servers, each hosting a couple of VM Guests,
  quickly becomes difficult to handle. One of the major benefits of
  <code class="systemitem">libvirt</code> is the ability to connect to several VM Host Servers at once,
  providing a single interface to manage all VM Guests and to connect to
  their graphical console.
 </p><p>
  In order to ensure only authorized users can connect, <code class="systemitem">libvirt</code> offers
  several connection types (via TLS, SSH, Unix sockets, and TCP) that can be
  combined with different authorization mechanisms (socket, PolicyKit, SASL and
  Kerberos).
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.connect.auth"></a>6.1. Authentication<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth">¶</a></span></h2></div></div></div><p>
   The power to manage VM Guests and to access their graphical console
   obviously is something that should be restricted to a well defined circle
   of persons. In order to achieve this goal, you can use the following
   authentication techniques on the VM Host Server:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     Access control for UNIX sockets with permissions and group ownership.
     This method is available for <code class="systemitem">libvirtd</code> connections only.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Access control for UNIX sockets with PolicyKit. This method is available for
     local <code class="systemitem">libvirtd</code> connections only.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Username and password authentication with SASL (Simple Authentication
     and Security Layer). This method is available for both, <code class="systemitem">libvirtd</code> and
     VNC connections. Using SASL does not require real user accounts on the
     server, since it uses its own database to store usernames and
     passwords. Connections authenticated with SASL are encrypted.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Kerberos authentication. This method, available for <code class="systemitem">libvirtd</code>
     connections only, is not covered in this manual. Please refer to
     <a class="ulink" href="http://libvirt.org/auth.html#ACL_server_kerberos" target="_top">http://libvirt.org/auth.html#ACL_server_kerberos</a>
     for details.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Single password authentication. This method is available for VNC
     connections only.
    </p></li></ul></div><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Authentication for libvirtd and VNC need to be configured separately"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Authentication for <code class="systemitem">libvirtd</code> and VNC need to be configured separately</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Access to the VM Guest management functions (via <code class="systemitem">libvirtd</code>) on the one
    hand and to their graphical console on the other hand, always needs to
    be configured separately. When restricting the access to the management
    tools, these restrictions do <span class="emphasis"><em>not</em></span> automatically
    apply to VNC connections!
   </p></td></tr></table></div><p>
   When accessing VM Guests from remote via TLS/SSL connections, access can
   be indirectly controlled on each client by restricting read permissions
   to the certificate's key file to a certain group. See
   <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a> for
   details.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.connect.auth.libvirt"></a>6.1.1. <code class="systemitem">libvirtd</code> Authentication<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt">¶</a></span></h3></div></div></div><p>
    <code class="systemitem">libvirtd</code> authentication is configured in
    <code class="filename">/etc/libvirt/libvirtd.conf</code>. The configuration made
    here applies to all <code class="systemitem">libvirt</code> tools such as the Virtual Machine Manager or
    <span class="command"><strong>virsh</strong></span>.
   </p><p>
    <code class="systemitem">libvirt</code> offers two sockets: a read-only socket for monitoring purposes
    and a read-write socket to be used for management operations. Access to
    both sockets can be configured independently. By default, both sockets
    are owned by <code class="literal">root.root</code>. Default access permissions on
    the read-write socket are restricted to the user <code class="systemitem">root</code>
    (<code class="literal">0700</code>) and fully open on the read-only socket
    (<code class="literal">0777</code>).
   </p><p>
    In the following instructions you learn how to configure access
    permissions for the read-write socket. The same instructions also apply
    to the read-only socket. All configuration steps have to be carried out
    on the VM Host Server.
   </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Default Authentication Settings on openSUSE"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Default Authentication Settings on <span class="phrase">openSUSE</span></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     The default authentication method on <span class="phrase">openSUSE</span> is access control
     for UNIX sockets. Only the user <code class="systemitem">root</code> may authenticate. When
     accessing the <code class="systemitem">libvirt</code> tools as a non-root user directly on the
     VM Host Server, you need to provide the <code class="systemitem">root</code> password through PolicyKit once
     and are granted access for the current and for future sessions.
    </p></td></tr></table></div><div class="variablelist"><p class="title"><strong>Recommended Authorization Methods</strong></p><dl class="variablelist"><dt><span class="term">Local Connections</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.pk" title="6.1.1.2. Local Access Control for UNIX Sockets with PolicyKit">Section 6.1.1.2, “Local Access Control for UNIX Sockets with PolicyKit”</a>
       </td></tr><tr><td><a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.traditional" title="6.1.1.1. Access Control for UNIX Sockets with Permissions and Group Ownership">Section 6.1.1.1, “Access Control for UNIX Sockets with Permissions and Group Ownership”</a>
       </td></tr></table></dd><dt><span class="term">Remote Tunnel over SSH</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.traditional" title="6.1.1.1. Access Control for UNIX Sockets with Permissions and Group Ownership">Section 6.1.1.1, “Access Control for UNIX Sockets with Permissions and Group Ownership”</a>
       </td></tr></table></dd><dt><span class="term">Remote TLS/SSL Connection</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.sasl" title="6.1.1.3. Username and Password Authentication with SASL">Section 6.1.1.3, “Username and Password Authentication with SASL”</a>
       </td></tr><tr><td>none (access controlled on the client side by restricting
	access to the certificates)</td></tr></table></dd></dl></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.auth.libvirt.traditional"></a>6.1.1.1. Access Control for UNIX Sockets with Permissions and Group Ownership<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.traditional">¶</a></span></h4></div></div></div><p>
     In order to grant access for non-<code class="systemitem">root</code> accounts, configure the
     sockets to be owned and accessible by a certain group
     (<code class="systemitem">libvirt</code> in the
     following example). This authentication method can be used for local
     and remote SSH connections.
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       In case it does not exist, create the group which should own the
       socket:
      </p><pre class="screen">groupadd libvirt</pre><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Group Needs to Exist"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Group Needs to Exist</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        The group must exist prior to restarting <code class="systemitem">libvirtd</code>. If not, the
        restart will fail.
       </p></td></tr></table></div></li><li><p>
       Add the desired users to the group:
      </p><pre class="screen">usermod -A libvirt tux</pre></li><li><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/libvirtd.conf</code> as follows:
      </p><pre class="screen">
       unix_sock_group = "libvirt"<a id="co.libvirt.connect.ssh.group"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>
       unix_sock_rw_perms = "0770"<a id="co.libvirt.connect.ssh.perms"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>
       auth_unix_rw = "none"<a id="co.libvirt.connect.ssh.enable"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.ssh.group"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         Group ownership will be set to group <code class="literal">libvirt</code>.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.ssh.perms"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         Sets the access permissions for the socket
         (<code class="literal">srwxrwx---</code>).
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.ssh.enable"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         Disables other authentication methods (PolicyKit or SASL). Access is
         solely controlled by the socket permissions.
        </p></td></tr></table></div></li><li><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.auth.libvirt.pk"></a>6.1.1.2. Local Access Control for UNIX Sockets with PolicyKit<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.pk">¶</a></span></h4></div></div></div><p>
     Access control for UNIX sockets with PolicyKit is the default authentication
     method on <span class="phrase">openSUSE</span> for non-remote connections. Therefore, no
     <code class="systemitem">libvirt</code> configuration changes are needed. With PolicyKit authorization
     enabled, permissions on both sockets default to <code class="literal">0777</code>
     and each application trying to access a socket needs to authenticate
     via PolicyKit. <span class="phrase">openSUSE</span>
    </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: PolicyKit Authentication for Local Connections Only"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">PolicyKit Authentication for Local Connections Only</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Authentication with PolicyKit can only be used for local connections on the
      VM Host Server itself, since PolicyKit does not handle remote authentication.

     </p></td></tr></table></div><p>
     Two policies for accessing <code class="systemitem">libvirt</code>'s sockets exist:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
       <span class="emphasis"><em>org.libvirt.unix.monitor</em></span>: accessing the
       read-only socket
      </p></li><li class="listitem" style="list-style-type: disc"><p>
       <span class="emphasis"><em>org.libvirt.unix.manage</em></span>: accessing the
       read-write socket
      </p></li></ul></div><p>
     By default, the policy for accessing the read-write socket is to
     authenticate with <code class="systemitem">root</code> password once and grant the privilege for
     the current and for future sessions (auth_admin_keep_always).
    </p><p>
     In order to grant users access to the read-write socket without having
     to provide the <code class="systemitem">root</code> password, there are two possibilities:
    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li><p>
       Using the <span class="command"><strong>polkit-auth</strong></span> command, you can grant the
       privilege without any restrictions:
      </p><pre class="screen">polkit-auth --user tux --grant org.libvirt.unix.manage    # grant privilege
polkit-auth --user tux --revoke org.libvirt.unix.manage   # revoke privilege</pre></li><li><p>
       Editing <code class="filename">/etc/PolicyKit/PolicyKit.conf</code> offers
       more advanced options. Add the following XML snippet in between the
       existing <code class="literal">&lt;config version="0.1"&gt;</code> and
       <code class="literal">&lt;/config&gt;</code> tags:
      </p><pre class="screen">&lt;match action="org.libvirt.unix.manage"&gt;<a id="co.libvirt.pk.action"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>
  &lt;match user="tux"&gt;<a id="co.libvirt.pk.user"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>
    &lt;return result="yes"/&gt;<a id="co.libvirt.pk.priv"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>
  &lt;/match&gt;
&lt;/match&gt;</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.pk.action"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         The name of the policy; <code class="literal">org.libvirt.unix.manage</code>
         stands for accessing the read-write socket.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.pk.user"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         The username(s) which to grant the privilege. Use the
         <code class="literal">|</code> symbol to separate entries
         (<code class="literal">user="tux|wilber"</code>).
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.pk.priv"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         The privilege that is granted. The following options exist:
         <code class="literal">yes</code> (no restrictions), <code class="literal">no</code>
         (block access completely), <code class="literal">auth_self</code> or
         <code class="literal">auth_admin</code> (authenticate with own
         password/<code class="systemitem">root</code> password every time the privilege is
         requested), <code class="literal">auth_self_keep_session</code> or
         <code class="literal">auth_admin_keep_session</code> (authenticate with own
         password/<code class="systemitem">root</code> password once per session) and
         <code class="literal">auth_self_keep_always</code> or
         <code class="literal">auth_admin_keep_always</code> (authenticate only once
         with own password/<code class="systemitem">root</code> password).
        </p></td></tr></table></div></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.auth.libvirt.sasl"></a>6.1.1.3. Username and Password Authentication with SASL<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.sasl">¶</a></span></h4></div></div></div><p>
     SASL provides username and password authentication as well as data
     encryption (digest-md5, by default). Since SASL maintains its own user
     database, the users do not need to exist on the VM Host Server. SASL is
     required by TCP connections and on top of TLS/SSL connections.
    </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Plain TCP and SASL with digest-md5 Encryption"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Plain TCP and SASL with digest-md5 Encryption</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Using digest-md5 encryption on an otherwise unencrypted TCP connection
      does not provide enough security for production environments. It is
      recommended to only use it in testing environments.
     </p></td></tr></table></div><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: SASL Authentication on Top of TLS/SSL"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">SASL Authentication on Top of TLS/SSL</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Access from remote TLS/SSL connections can be indirectly controlled on
      the <span class="emphasis"><em>client side</em></span> by restricting access to the
      certificate's key file. However, this might prove error-prone when
      dealing with a large number of clients. Utilizing SASL with TLS adds
      security by additionally controlling access on the server side.
     </p></td></tr></table></div><p>
     To configure SASL authentication, proceed as follows:
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/libvirtd.conf</code> as follows:
      </p><ol type="a" class="substeps"><li><p>
         To enable SASL for TCP connections:
        </p><pre class="screen">auth_tcp = "sasl"</pre></li><li><p>
         To enable SASL for TLS/SSL connections:
        </p><pre class="screen">auth_tls = "sasl"</pre></li></ol></li><li><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li><li><p>
       The libvirt SASL configuration file is located at
       <code class="filename">/etc/sasl2/libvirtd.conf</code>. Normally, there is no
       need to change the defaults. However, if using SASL on top of TLS,
       you may turn off session encryption to avoid additional
       overhead— TLS connections are already encrypted— by
       commenting the <code class="literal">mech_list</code>. For TCP connections this
       parameter must be set to digest-md5:
      </p><pre class="screen">mech_list: digest-md5   # mandatory for TCP connections
#mech_list: digest-md5   # apply default (username+password) TLS/SSL only!</pre></li><li><p>
       By default, no SASL users are configured, so no logins are possible.
       Use the following commands to add, list, and delete users:
      </p><pre class="screen">mercury:~ # saslpasswd2 -a libvirt tux                  # add user tux
Password: 
Again (for verification): 
mercury:~ # sasldblistusers2 -f /etc/libvirt/passwd.db  # list users
tux@mercury.example.com: userPassword
mercury:~ # saslpasswd2 -a libvirt -d tux               # delete user tux</pre></li></ol></div><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: virsh and SASL Authentication"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left"><span class="command"><strong>virsh</strong></span> and SASL Authentication</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      When using SASL authentication you will be prompted for a username and
      password every time you issue a <span class="command"><strong>virsh</strong></span> command.
      Avoid this by using <span class="command"><strong>virsh</strong></span> in shell mode.
     </p></td></tr></table></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.connect.auth.vnc"></a>6.1.2. VNC Authentication<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.vnc">¶</a></span></h3></div></div></div><p>
    Since access to the graphical console of a VM Guest is not controlled
    by <code class="systemitem">libvirt</code>, but rather by <code class="literal">QEMU</code>, it is always
    necessary to additionally configure VNC authentication. The main
    configuration file is <code class="filename">/etc/libvirt/qemu.conf</code>.
   </p><p>
    Two authentication types are available: SASL and single password
    authentication. If you are using SASL for <code class="systemitem">libvirt</code> authentication, it
    is strongly recommended to use it for VNC authentication as
    well—it is possible to share the same database.
   </p><p>
    A third method to restrict access to the VM Guest is to enable the use
    of TLS encryption on the VNC server. This requires the VNC clients to
    have access to x509 client certificates. By restricting access to these
    certificates, access can indirectly be controlled on the client side.
    Refer to <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.vnc.client" title="6.2.2.4.2. VNC over TLS/SSL: Client Configuration">Section 6.2.2.4.2, “VNC over TLS/SSL: Client Configuration”</a> for
    details.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.auth.vnc.tls"></a>6.1.2.1. Username and Password Authentication with SASL<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.vnc.tls">¶</a></span></h4></div></div></div><p>
     SASL provides username and password authentication as well as data
     encryption. Since SASL maintains its own user database, the users do
     not need to exist on the VM Host Server. As with SASL authentication for
     <code class="systemitem">libvirt</code>, you may use SASL on top of TLS/SSL connections. Refer to
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.vnc.client" title="6.2.2.4.2. VNC over TLS/SSL: Client Configuration">Section 6.2.2.4.2, “VNC over TLS/SSL: Client Configuration”</a> for
     details on configuring these connections.
    </p><p>
     To configure SASL authentication for VNC, proceed as follows:
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Create a SASL configuration file. It is recommended to use the
       existing <code class="systemitem">libvirt</code> file. If you have already configured SASL for
       <code class="systemitem">libvirt</code> and are planning to use the same settings including the
       same username/password database, a simple link is suitable:
      </p><pre class="screen">ln -s /etc/sasl2/libvirt.conf /etc/sasl2/qemu.conf</pre><p>
       In case you are setting up SASL for VNC only or planning to use a
       different configuration than for <code class="systemitem">libvirt</code>, copy the existing file to
       use as a template and edit it according to your needs:
      </p><pre class="screen">cp /etc/sasl2/libvirt.conf /etc/sasl2/qemu.conf</pre></li><li><p>
       By default, no SASL users are configured, so no logins are possible.
       Use the following commands to add, list, and delete users:
      </p><pre class="screen">mercury:~ # saslpasswd2 -a libvirt tux                  # add user tux
Password: 
Again (for verification): 
mercury:~ # sasldblistusers2 -f /etc/libvirt/passwd.db  # list users
tux@mercury.example.com: userPassword
mercury:~ # saslpasswd2 -a libvirt -d tux               # delete user tux</pre></li><li><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows:
      </p><pre class="screen">vnc_listen = "0.0.0.0"
vnc_sasl = 1</pre><p>
       The first parameter enables VNC to listen on all public interfaces
       (rather than to the local host only), and the second parameter
       enables SASL authentication.
      </p></li><li><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li><li><p>
       Restart all VM Guests that have been running prior to changing the
       configuration. VM Guests that have not been restarted will not use
       SASL authentication for VNC connects.
      </p></li></ol></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Supported VNC Viewers"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Supported VNC Viewers</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Currently only the same VNC viewers that also support TLS/SSL
      connections, support SASL authentication, namely Virtual Machine Manager,
      <span class="command"><strong>virt-viewer</strong></span>, and <span class="command"><strong>vinagre</strong></span>.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.auth.vnc.pw"></a>6.1.2.2. Single Password Authentication<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.auth.vnc.pw">¶</a></span></h4></div></div></div><p>
     Access to the VNC server may also be controlled by setting a VNC
     password. You can either set a global password for all VM Guests or
     set individual passwords for each guest. The latter requires to edit
     the VM Guest's config files.
    </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Always Set a Global Password"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Always Set a Global Password</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      If you are using the single password authentication, it is good
      practice to set a global password even if setting passwords for each
      VM Guest. This will always leave your virtual machines protected with
      a <span class="quote">“<span class="quote">fallback</span>”</span> password if you forget to set a per-machine
      password. The global password will only be used if no other password
      is set for the machine.
     </p></td></tr></table></div><div class="procedure"><a id="id714000"></a><p class="title"><strong>Procedure 6.1. Setting a Global VNC Password</strong></p><ol class="procedure" type="1"><li><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows:
      </p><pre class="screen">vnc_listen = "0.0.0.0"
       vnc_password = "<em class="replaceable"><code>PASSWORD</code></em>"</pre><p>
       The first parameter enables VNC to listen on all public interfaces
       (rather than to the local host only), and the second parameter sets
       the password. The maximum length of the password is eight characters.
      </p></li><li><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li><li><p>
       Restart all VM Guests that have been running prior to changing the
       configuration. VM Guests that have not been restarted will not use
       password authentication for VNC connects.
      </p></li></ol></div><div class="procedure"><a id="id714060"></a><p class="title"><strong>Procedure 6.2. Setting a VM Guest Specific VNC Password</strong></p><ol class="procedure" type="1"><li><p>
       Change the configuration in
       <code class="filename">/etc/libvirt/qemu.conf</code> as follows to enable VNC
       to listen on all public interfaces (rather than to the local host
       only).
      </p><pre class="screen">vnc_listen = "0.0.0.0"</pre></li><li><p>
       Open the VM Guest's XML configuration file in an editor. Replace
       <em class="replaceable"><code>VM NAME</code></em> in the following example with the
       name of the VM Guest. The editor that is used defaults to
       <code class="envar">$EDITOR</code>. If that variable is not set,
       <span class="command"><strong>vi</strong></span> is used.
      </p><pre class="screen">virsh edit <em class="replaceable"><code>VM NAME</code></em></pre></li><li><p>
       Search for the element <code class="literal">&lt;graphics&gt;</code> with the
       attribute <code class="literal">type='vnc'</code>, for example:
      </p><pre class="screen">&lt;graphics type='vnc' port='-1' autoport='yes'/&gt;</pre></li><li><p>
       Add the <code class="literal">passwd=<em class="replaceable"><code>PASSWORD</code></em></code>
       attribute, save the file and leave the editor. The maximum length of
       the password is eight characters.
      </p><pre class="screen">&lt;graphics type='vnc' port='-1' autoport='yes' passwd='PASSWORD'/&gt;</pre></li><li><p>
       Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li><li><p>
       Restart all VM Guests that have been running prior to changing the
       configuration. VM Guests that have not been restarted will not use
       password authentication for VNC connects.
      </p></li></ol></div><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Security"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Security</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      The VNC protocol is not considered to be safe. Although the password
      is sent encrypted, it might be vulnerable, when an attacker is able to
      sniff both, the encrypted password and the encryption key. Therefore,
      it is recommended to use VNC with TLS/SSL or tunneled over SSH.
      <span class="command"><strong>virt-viewer</strong></span>, as well as the Virtual Machine Manager and
      <span class="command"><strong>vinagre</strong></span> from version 2.30 on, support both methods.
     </p></td></tr></table></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.connect.remote"></a>6.2. Configuring Remote Connections<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote">¶</a></span></h2></div></div></div><p>
   A major benefit of <code class="systemitem">libvirt</code> is the ability to manage VM Guests on
   different remote hosts from a central location. This section gives
   detailed instructions on how to configure server and client to allow
   remote connections.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.connect.remote.ssh"></a>6.2.1. Remote Tunnel over SSH (<code class="literal">qemu+ssh</code>)<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.ssh">¶</a></span></h3></div></div></div><p>
    Enabling a remote connection that is tunneled over SSH on the VM Host Server
    only requires the ability to accept SSH connections. Make sure the SSH
    daemon is started (<span class="command"><strong>rcsshd status</strong></span>) and that the ports
    for service <code class="systemitem">SSH</code> are opened in
    the firewall.
   </p><p>
    User authentication for SSH connections can be done using traditional
    file user/group ownership and permissions as described in
    <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.traditional" title="6.1.1.1. Access Control for UNIX Sockets with Permissions and Group Ownership">Section 6.1.1.1, “Access Control for UNIX Sockets with Permissions and Group Ownership”</a>.
    Connecting as user <code class="systemitem">root</code>
    (<code class="literal">qemu+ssh://root@mercury.example.com/system</code>) works out of the
    box and does not require additional configuration on the <code class="systemitem">libvirt</code> side.
   </p><p>
    When connecting via SSH
    <code class="literal">qemu+ssh://<em class="replaceable"><code>USER</code></em>@<em class="replaceable"><code>SYSTEM</code></em></code>
    you need to provide the password for <em class="replaceable"><code>USER</code></em>.
    This can be avoided by copying your public key to
    <code class="filename">~<em class="replaceable"><code>USER</code></em>/.ssh/authorized_keys</code>
    on the VM Host Server as explained in
    Section “Copying an SSH Key” (Chapter 12, <em>SSH: Secure Network Operations</em>, ↑Security Guide). Using an ssh-agent on
    the machine from which you are connecting adds even more
    convenience—see Section “Using the <span class="command"><strong>ssh-agent</strong></span>” (Chapter 12, <em>SSH: Secure Network Operations</em>, ↑Security Guide) for
    instructions.
   </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.connect.remote.tls"></a>6.2.2. Remote TLS/SSL Connection with x509 Certificate (<code class="literal">qemu+tls</code>)<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls">¶</a></span></h3></div></div></div><p>
    Using TCP connections with TLS/SSL encryption and authentication via
    x509 certificates is much more complicated to set up than SSH, but it is
    a lot more scalable. Use this method if you have to manage several
    VM Host Servers with a varying number of administrators.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.concept"></a>6.2.2.1. Basic concept<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.concept">¶</a></span></h4></div></div></div><p>
     Basically, TLS (Transport Layer Security) encrypts the communication
     between two computers by using certificates. The computer starting the
     connection is always considered as the <span class="quote">“<span class="quote">client</span>”</span> using a
     <span class="quote">“<span class="quote">client certificate</span>”</span>, while the receiving computer is
     always considered as the <span class="quote">“<span class="quote">server</span>”</span>, using a <span class="quote">“<span class="quote">server
     certificate</span>”</span>. This scenario applies, for example, if you manage
     your VM Host Servers from a central desktop.
    </p><p>
     If connections are initiated from both computers, each needs to have a
     client <span class="emphasis"><em>and</em></span> a server certificate. This is the case,
     for example, if you migrate a VM Guest from one host to another.
    </p><p>
     Each x509 certificate has a matching private key file. Only the
     combination of certificate and private key file is able to identify
     itself correctly. In order to assure that a certificate was issued by
     the assumed owner, it is signed and issued by a central certificate
     called certification authority (CA). Both the client and the server
     certificates must be issued by the same CA.
    </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: User Authentication"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">User Authentication</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Using a remote TLS/SSL connection basically only ensures that two
      computers are allowed to communicate in a certain direction.
      Restricting access to certain users can indirectly be achieved on the
      client side by restricting access to the certificates. Refer to
      <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a> for
      details. <code class="systemitem">libvirt</code> also supports user authentication on the server
      with SASL. Read more in
      <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.sasl" title="6.2.2.6. Central User Authentication with SASL for TLS Sockets">Section 6.2.2.6, “Central User Authentication with SASL for TLS Sockets”</a>.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.server"></a>6.2.2.2. Configuring the VM Host Server<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.server">¶</a></span></h4></div></div></div><p>
     The VM Host Server is the machine receiving connections. Therefore, the
     <span class="emphasis"><em>server</em></span> certificates have to be installed. The CA
     certificate needs to be installed, as well. Once the certificates are
     in place, TLS support can be turned on for <code class="systemitem">libvirt</code>.
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Create the server certificate and export it together with the CA
       certificate as described in <a class="xref" href="opensuse-kvm.html#app.kvm.certificates" title="A.2. Generating x509 Client/Server Certificates">Section A.2, “Generating x509 Client/Server Certificates”</a>.
      </p></li><li><p>
       Create the following directories on the VM Host Server:
      </p><pre class="screen">mkdir -p /etc/pki/CA/ /etc/pki/libvirt/private/</pre><p>
       Install the certificates as follows:
      </p><pre class="screen">/etc/pki/CA/cacert.pem
/etc/pki/libvirt/servercert.pem
/etc/pki/libvirt/private/serverkey.pem</pre><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Restrict Access to Certificates"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Restrict Access to Certificates</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Make sure to restrict access to certificates as explained in
        <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a>.
       </p></td></tr></table></div></li><li><p>
       Enable TLS support by editing
       <code class="filename">/etc/libvirt/libvirtd.conf</code> and setting
       <code class="literal">listen_tls = 1</code>. Restart <code class="systemitem">libvirtd</code>:
      </p><pre class="screen">rclibvirtd restart</pre></li><li><p>
       By default, <code class="systemitem">libvirt</code> uses the TCP port 16514 for accepting secure
       TLS connections. Open this port in the firewall.
      </p></li></ol></div><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Restarting libvirtd with TLS enabled"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Restarting <code class="systemitem">libvirtd</code> with TLS enabled</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      If you enable TLS for <code class="systemitem">libvirt</code>, the server certificates need to be in
      place, otherwise restarting <code class="systemitem">libvirtd</code> will fail. You also need to
      restart <code class="systemitem">libvirtd</code> in case you change the certificates.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.client"></a>6.2.2.3. Configuring the Client and Testing the Setup<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.client">¶</a></span></h4></div></div></div><p>
     The client is the machine initiating connections. Therefore the
     <span class="emphasis"><em>client</em></span> certificates have to be installed. The CA
     certificate needs to be installed, as well.
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       Create the client certificate and export it together with the CA
       certificate as described in <a class="xref" href="opensuse-kvm.html#app.kvm.certificates" title="A.2. Generating x509 Client/Server Certificates">Section A.2, “Generating x509 Client/Server Certificates”</a>.
      </p></li><li><p>
       Create the following directories on the client:
      </p><pre class="screen">mkdir -p /etc/pki/CA/ /etc/pki/libvirt/private/</pre><p>
       Install the certificates as follows:
      </p><pre class="screen">/etc/pki/CA/cacert.pem
/etc/pki/libvirt/clientcert.pem
/etc/pki/libvirt/private/clientkey.pem</pre><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Restrict Access to Certificates"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Restrict Access to Certificates</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Make sure to restrict access to certificates as explained in
        <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a>.
       </p></td></tr></table></div></li><li><p>
       Test the client/server setup by issuing the following command.
       Replace <em class="replaceable"><code>mercury.example.com</code></em> with the name of your
       VM Host Server. Specify the same full qualified hostname as used when
       creating the server certificate.
      </p><pre class="screen">virsh -c qemu+tls://<em class="replaceable"><code>mercury.example.com</code></em>/system list --all</pre><p>
       If your setup is correct, you will see a list of all VM Guests
       registered with <code class="systemitem">libvirt</code> on the VM Host Server.
      </p></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.vnc"></a>6.2.2.4. Enabling VNC for TLS/SSL connections<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.vnc">¶</a></span></h4></div></div></div><p>
     Currently, VNC communication over TLS is only supported by few tools.
     The widespread <span class="command"><strong>tightvnc</strong></span> or
     <span class="command"><strong>tigervnc</strong></span> viewer, for example, do not support TLS.
     Known to work are the Virtual Machine Manager (<span class="command"><strong>virt-manager</strong></span>),
     <span class="command"><strong>virt-viewer</strong></span> and the GNOME VNC viewer
     <span class="command"><strong>vinagre</strong></span>.
    </p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="sec.libvirt.connect.remote.tls.vnc.server"></a>6.2.2.4.1. VNC over TLS/SSL: VM Host Server Configuration<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.vnc.server">¶</a></span></h5></div></div></div><p>
      In order to access the graphical console via VNC over TLS/SSL, you
      need to configure the VM Host Server as follows:
     </p><div class="procedure"><ol class="procedure" type="1"><li><p>
        Open ports for the service
        <code class="systemitem">VNC</code> in your firewall.
       </p></li><li><p>
        Create a directory <code class="filename">/etc/pki/libvirt-vnc</code> and
        link the certificates into this directory as follows:
       </p><pre class="screen">mkdir -p /etc/pki/libvirt-vnc &amp;&amp; cd /etc/pki/libvirt-vnc
	ln -s /etc/pki/CA/cacert.pem ca-cert.pem
	ln -s /etc/pki/libvirt/servercert.pem server-cert.pem
	ln -s /etc/pki/libvirt/private/serverkey.pem server-key.pem</pre></li><li><p>
        Edit <code class="filename">/etc/libvirt/qemu.conf</code> and set the
        following parameters:
       </p><pre class="screen">vnc_listen = "0.0.0.0"
	vnc_tls = 1
	vnc_tls_x509_verify = 1</pre></li><li><p>
        Restart the <code class="systemitem">libvirtd</code>:
       </p><pre class="screen">rclibvirtd restart</pre><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: VM Guests Need to be Restarted"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">VM Guests Need to be Restarted</th></tr><tr><td colspan="2" align="left" valign="top"><p>
         The VNC TLS setting is only set when starting a VM Guest.
         Therefore, you need to restart all machines that have been running
         prior to making the configuration change.
        </p></td></tr></table></div></li></ol></div></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="sec.libvirt.connect.remote.tls.vnc.client"></a>6.2.2.4.2. VNC over TLS/SSL: Client Configuration<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.vnc.client">¶</a></span></h5></div></div></div><p>
      The only action needed on the client side is to place the x509 client
      certificates in a location recognized by the client of choice.
      Unfortunately, each supported client—Virtual Machine Manager,
      <span class="command"><strong>virt-viewer</strong></span>, and
      <span class="command"><strong>vinagre</strong></span>—expects the certificates in a
      different location. However, Virtual Machine Manager and <span class="command"><strong>vinagre</strong></span> can
      either read from a system wide location applying to all users, or from
      a per user location.
     </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>
	 Virtual Machine Manager (<span class="command"><strong>virt-manager</strong></span>)
	</strong></span>
       </span></dt><dd><p>
         In order to connect to the remote host, Virtual Machine Manager requires the setup
         explained in
         <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.client" title="6.2.2.3. Configuring the Client and Testing the Setup">Section 6.2.2.3, “Configuring the Client and Testing the Setup”</a>. In order
         to be able to connect via VNC the client certificates also need to
         be placed in the following locations:
        </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">System wide location</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/private/clientkey.pem</code>
            </td></tr></table></dd><dt><span class="term">Per user location</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/libvirt-vnc/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/libvirt-vnc/private/clientkey.pem</code>
            </td></tr></table></dd></dl></div></dd><dt><span class="term"><span class="bold"><strong><span class="command"><strong>virt-viewer</strong></span></strong></span>
       </span></dt><dd><p>
         <span class="command"><strong>virt-viewer</strong></span> only accepts certificates from a
         system wide location:
        </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
         </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/clientcert.pem</code>
         </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/private/clientkey.pem</code>
         </td></tr></table></dd><dt><span class="term"><span class="bold"><strong><span class="command"><strong>vinagre</strong></span></strong></span>
       </span></dt><dd><div class="variablelist"><dl class="variablelist"><dt><span class="term">System wide location</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/vinagre/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">/etc/pki/vinagre/private/clientkey.pem</code>
            </td></tr></table></dd><dt><span class="term">Per user location</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">$HOME/.pki/CA/cacert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/vinagre/clientcert.pem</code>
            </td></tr><tr><td><code class="filename">~/.pki/vinagre/private/clientkey.pem</code>
            </td></tr></table></dd></dl></div></dd></dl></div><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Restrict Access to Certificates"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Restrict Access to Certificates</th></tr><tr><td colspan="2" align="left" valign="top"><p>
       Make sure to restrict access to certificates as explained in
       <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a>.
      </p></td></tr></table></div></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.security"></a>6.2.2.5. Restricting Access (Security Considerations)<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security">¶</a></span></h4></div></div></div><p>
     Each x509 certificate consists of two pieces: the public certificate
     and a private key. A client can only authenticate using both pieces.
     Therefore, any user that has read access to the client certificate and
     its private key can access your VM Host Server. On the other hand, an
     arbitrary machine equipped with the full server certificate can pretend
     to be the VM Host Server. Since this is probably not desirable, access to at
     least the private key files needs to be restricted as much as possible.
     The easiest way to control access to a key file is to use access
     permissions.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>Server Certificates</strong></span>
      </span></dt><dd><p>
        Server certificates need to be readable for QEMU processes. On
        <span class="phrase">openSUSE</span> QEMU processes started from <code class="systemitem">libvirt</code> tools are
        owned by <code class="systemitem">root</code>, so it is sufficient if <code class="systemitem">root</code> is able to
        read them certificates:
       </p><pre class="screen">chmod 700 /etc/pki/libvirt/private/
chmod 600 /etc/pki/libvirt/private/serverkey.pem</pre><p>
        If you change the ownership for QEMU processes in
        <code class="filename">/etc/libvirt/qemu.conf</code>, you also need to adjust
        the ownership of the key file.
       </p></dd><dt><span class="term"><span class="bold"><strong>System Wide Client Certificates</strong></span>
      </span></dt><dd><p>
        To control access to a key file that is available system wide,
        restrict read access a certain group, so that only members of that
        group can read the key file. In the following example, a group
        <code class="systemitem">libvirt</code> is created and
        the group ownership of the <code class="filename">clientkey.pem</code> and
        its parent directory is set to
        <code class="systemitem">libvirt</code>. Afterwards,
        the access permissions are restricted to owner and group. Finally
        the user tux is added to the group
        <code class="systemitem">libvirt</code>, so he will be
        able to access the key file.
       </p><pre class="screen">CERTPATH="/etc/pki/libvirt/"
# create group libvirt
groupadd libvirt
# change ownership to user root and group libvirt
chown root.libvirt $CERTPATH/private $CERTPATH/clientkey.pem
# restrict permissions
chmod 750 $CERTPATH/private
chmod 640 $CERTPATH/private/clientkey.pem
# add user tux to group libvirt
usermod -A libvirt tux
</pre></dd><dt><span class="term"><span class="bold"><strong>Per User Certificates</strong></span>
      </span></dt><dd><p>
        User specific client certificates for accessing the graphical
        console of a VM Guest via VNC need to be placed in the users home
        directory in <code class="filename">~/.pki</code>. Contrary to, for example,
        the VNC viewer using these certificates do not check the access
        permissions of the private key file. Therefore, it is solely on the
        user's responsibility to make sure the key file is not readable by
        others.
       </p></dd></dl></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="sec.libvirt.connect.remote.tls.server.restrict"></a>6.2.2.5.1. Restricting Access from the Server Side<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.server.restrict">¶</a></span></h5></div></div></div><p>
      By default, every client that is equipped with appropriate client
      certificates may connect to a VM Host Server accepting TLS connections.
      Therefore, it is possible to use additional server side authentication
      with SASL as described in
      <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.sasl" title="6.1.1.3. Username and Password Authentication with SASL">Section 6.1.1.3, “Username and Password Authentication with SASL”</a>.
     </p><p>
      It is also possible to restrict access with a whitelist of DNs
      (distinguished names), so only clients with a certificate matching a
      DN from the list can connect.
     </p><p>
      Add a list of allowed DNs to <code class="literal">tls_allowed_dn_list</code> in
      <code class="filename">/etc/libvirt/libvirtd.conf</code>. This list may contain
      wildcards. Do not specify an empty list, since that would result in
      refusing all connections.
     </p><pre class="screen">tls_allowed_dn_list = [
   "C=US,L=Provo,O=SUSE Linux Products GmbH,OU=*,CN=venus.example.com,EMAIL=*",
   "C=DE,L=Nuremberg,O=SUSE Linux Products GmbH,OU=Documentation,CN=*"]</pre><p>
      Get the distinguished name of a certificate with the following
      command:
     </p><pre class="screen">certtool -i --infile /etc/pki/libvirt/clientcert.pem | grep "Subject:"</pre><p>
      Restart <code class="systemitem">libvirtd</code> after having changed the configuration:
     </p><pre class="screen">rclibvirtd restart</pre></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.sasl"></a>6.2.2.6. Central User Authentication with SASL for TLS Sockets<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.sasl">¶</a></span></h4></div></div></div><p>
     A direct user authentication via TLS is not possible - this is handled
     indirectly on each client via the read permissions for the certificates
     as explained in
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.security" title="6.2.2.5. Restricting Access (Security Considerations)">Section 6.2.2.5, “Restricting Access (Security Considerations)”</a>.
     However, if a central, server based user authentication is needed
     <code class="systemitem">libvirt</code> also allows to use SASL (Simple Authentication and Security
     Layer) on top of TLS for direct user authentication. See
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.auth.libvirt.sasl" title="6.1.1.3. Username and Password Authentication with SASL">Section 6.1.1.3, “Username and Password Authentication with SASL”</a> for
     configuration details.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.connect.remote.tls.troubleshoot"></a>6.2.2.7. Troubleshooting<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.troubleshoot">¶</a></span></h4></div></div></div><p></p><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="id719663"></a>6.2.2.7.1. Virtual Machine Manager/<span class="command"><strong>virsh</strong></span> Cannot Connect to Server<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id719663">¶</a></span></h5></div></div></div><p>
      Check the following in the given order:
     </p><table border="0" summary="Simple list" class="simplelist"><tr><td>Is it a firewall issue (TCP port 16514 needs to be open on the
       server)?</td></tr><tr><td>Is the client certificate (certificate and key) readable by the
       user that has started
       Virtual Machine Manager/<span class="command"><strong>virsh</strong></span>?
      </td></tr><tr><td>Has the same full qualified hostname as in the server
       certificate been specified with the connection?</td></tr><tr><td>Is TLS enabled on the server (<code class="literal">listen_tls =
	1</code>)?</td></tr><tr><td>Has <code class="systemitem">libvirtd</code> been
       restarted on the server?</td></tr></table></div><div class="sect4"><div class="titlepage"><div><div><h5 class="title"><a id="id719709"></a>6.2.2.7.2. VNC Connection fails<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id719709">¶</a></span></h5></div></div></div><p>
      Ensure that you can basically connect to the remote server using
      Virtual Machine Manager. If so, check whether the virtual machine on the server has been
      started with TLS support. The virtual machine's name in the following
      example is <span class="quote">“<span class="quote">sles11</span>”</span>.
     </p><pre class="screen">ps ax | grep qemu | grep "\-name sles11" | awk -F" -vnc " '{ print FS $2 }'</pre><p>
      If the output does not begin with a string similar to the following,
      the machine has not been started with TLS support and must be
      restarted.
     </p><pre class="screen"> -vnc 0.0.0.0:0,tls,x509verify=/etc/pki/libvirt</pre></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.connect.connecting"></a>6.3. Connecting to a VM Host Server<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.connecting">¶</a></span></h2></div></div></div><p>
   In order to connect to a hypervisor with <code class="systemitem">libvirt</code>, you need to specify a
   uniform resource identifier (URI). This URI is needed with
   <span class="command"><strong>virsh</strong></span> and <span class="command"><strong>virt-viewer</strong></span> (except when
   working as <code class="systemitem">root</code> on the VM Host Server) and is optional for the Virtual Machine Manager.
   Although the latter can be called with a connection parameter (for
   example, <span class="command"><strong>virt-manager -c qemu:///system</strong></span>), it also
   offers a graphical interface to create connection URIs. See
   <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.connecting.vmm" title="6.3.1. Managing Connections with Virtual Machine Manager">Section 6.3.1, “Managing Connections with Virtual Machine Manager”</a> for details.
  </p><pre class="screen"><em class="replaceable"><code>HYPERVISOR</code></em><a id="co.libvirt.connect.hyperv"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a><em class="replaceable"><code>+PROTOCOL</code></em><a id="co.libvirt.connect.protocol"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>://<em class="replaceable"><code>USER@REMOTE</code></em><a id="co.libvirt.connect.remote"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>/<em class="replaceable"><code>CONNECTION_TYPE</code></em><a id="co.libvirt.connect.type"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.hyperv"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specify the hypervisor. <span class="phrase">openSUSE</span> currently supports the following
     hypervisors: <code class="option">test</code> (dummy for testing),
     <code class="option">qemu</code> (KVM), and <code class="option">xen</code> (Xen). This
     parameter is mandatory.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.protocol"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     When connecting to a remote host, specify the protocol here. Can be one
     of: <code class="option">ssh</code> (connection via SSH tunnel),
     <code class="option">tcp</code> (TCP connection with SASL/Kerberos
     authentication), <code class="option">tls</code> (TLS/SSL encrypted connection
     with authentication via x509 certificates).
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.remote"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     When connecting to a remote host, specify the user and the remote
     hostname. If no user is specified, the username that has called the
     command (<code class="envar">$USER</code>) is used. Please see below for more
     information. For TLS connections the hostname has to be specified
     exactly as in the x509 certificate.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.libvirt.connect.type"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     When connecting to <code class="literal">QEMU</code> hypervisor, two
     connections types are accepted: <code class="option">system</code> for full access
     rights, or <code class="option">session</code> for restricted access. Since
     <code class="option">session</code> access is not supported on <span class="phrase">openSUSE</span>, this
     documentation focuses on <code class="option">system</code> access.
    </p></td></tr></table></div><div class="variablelist"><p class="title"><strong>Example Hypervisor Connection URIs</strong></p><dl class="variablelist"><dt><span class="term"><code class="option">test:///default</code>
    </span></dt><dd><p>
      Connect to the local dummy hypervisor. Useful for testing.
     </p></dd><dt><span class="term"><code class="option">qemu:///system</code>
    </span></dt><dd><p>
      Connect to the QEMU hypervisor on the local host having full access
      (type system). This usually requires that the command is issued by the
      user <code class="systemitem">root</code>.
     </p></dd><dt><span class="term"><code class="option">qemu+ssh://tux@mercury.example.com/system</code>
    </span></dt><dd><p>
      Connect to the QEMU hypervisor on the remote host mercury.example.com. The
      connection is established via an SSH tunnel.
     </p></dd><dt><span class="term"><code class="option">qemu+tls://saturn.example.com/system</code>
    </span></dt><dd><p>
      Connect to the QEMU hypervisor on the remote host mercury.example.com. The
      connection is established TLS/SSL.
     </p></dd></dl></div><p>
   For more details and examples, refer to the <code class="systemitem">libvirt</code> documentation at
   <a class="ulink" href="http://libvirt.org/uri.html" target="_top">http://libvirt.org/uri.html</a>.
  </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Usernames in URIs"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Usernames in URIs</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    A username needs to be specified when using Unix socket authentication
    (regardless whether using the username/password authentication scheme or
    PolicyKit). This applies to all SSH and local connections.
   </p><p>
    There is no need to specify a username when using SASL authentication
    (for TCP or TLS connections) or when doing no additional server side
    authentication for TLS connections. With SASL the username will not be
    evaluated—you will be prompted for a SASL user/password
    combination in any case.
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.connect.connecting.vmm"></a>6.3.1. Managing Connections with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.connect.connecting.vmm">¶</a></span></h3></div></div></div><p>
    The Virtual Machine Manager uses a <code class="literal">Connection</code> for every VM Host Server it
    manages. Each connection contains all VM Guests on the respective host.
    By default, a connection to the localhost is already configured and
    connected.
   </p><p>
    All configured connections are displayed in the Virtual Machine Manager main window.
    Active connections are marked with a small triangle which you can click
    in order to fold or unfold the list of VM Guests for this connection.
   </p><p>
    Inactive connections are listed gray and are marked with <code class="literal">Not
    Connected</code>. Either double-click or right-click it and choose
    <span class="guimenu">Connect</span> from the context menu. You can also
    <span class="guimenu">Delete</span> an existing connection from this menu.
   </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Editing Existing Connections"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Editing Existing Connections</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     It is not possible to edit an existing connection. In order to change a
     connection, create a new one with the desired parameters and delete the
     <span class="quote">“<span class="quote">old</span>”</span> one.
    </p></td></tr></table></div><p>
    To add a new connection in the Virtual Machine Manager, proceed as follows:
   </p><div class="procedure"><ol class="procedure" type="1"><li><p>
      Choose <span class="guimenu">File</span>+<span class="guimenu">Add
      Connection</span>
     </p></li><li><p>
      Choose the host's <span class="guimenu">Hypervisor</span>
      (<span class="guimenu">Xen</span> or <span class="guimenu">QEMU/KVM</span>)
     </p></li><li><p>
      Choose a <span class="guimenu">Connection</span> type—either
      <span class="guimenu">Local</span> for connecting to the host the Virtual Machine Manager was
      started on, or one of the remote connections (see
      <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote" title="6.2. Configuring Remote Connections">Section 6.2, “Configuring Remote Connections”</a> for more information).
     </p></li><li><p>
      In case of a remote connection, enter the <span class="guimenu">Hostname</span>
      of the remote machine as <code class="literal">USERNAME@REMOTE_HOST</code>.
      Usernames must be specified for local connections as well as for SSH
     </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Specifying a Username"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Specifying a Username</th></tr><tr><td colspan="2" align="left" valign="top"><p>
       There is no need to specify a username for TCP and TLS connections;
       it will not be evaluated anyway. A username must be specified for
       local connections as well as for SSH connections—if not, the
       default user <code class="literal">root</code> will be used.
      </p></td></tr></table></div></li><li><p>
      If you do not want the connection to be automatically activated when
      starting the Virtual Machine Manager, remove the tick from
      <span class="guimenu">Autoconnect</span>.
     </p></li><li><p>
      Finish the configuration by clicking <span class="guimenu">Connect</span>.
     </p></li></ol></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.storage"></a>Chapter 7. Managing Storage<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.storage">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.vmm">7.1. Managing Storage with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.storage.virsh">7.2. Managing Storage with <span class="command"><strong>virsh</strong></span></a></span></dt></dl></div><p>
  When managing a VM Guest on the VM Host Server itself, it is possible to access
  the complete file system of the VM Host Server in order to attach or create
  virtual hard disks or to attach existing images to the VM Guest. However,
  this is not possible when managing VM Guests from a remote host. For this
  reason, <code class="systemitem">libvirt</code> supports so called <span class="quote">“<span class="quote">Storage Pools</span>”</span> which
  can be accessed from remote machines.
 </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: CD/DVD ISO images"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">CD/DVD ISO images</th></tr><tr><td colspan="2" align="left" valign="top"><p>
   In order to be able to access CD/DVD iso images on the VM Host Server from
   remote, they also need to be placed in a storage pool.
  </p></td></tr></table></div><p>
  <code class="systemitem">libvirt</code> knows two different types of storage: volumes and pools.
 </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Storage Volume</span></dt><dd><p>
     A storage volume is a storage device that can be assigned to a
     guest—a virtual disk or a CD/DVD/floppy image. Physically (on the
     VM Host Server) it can be a block device (a partition, a logical volume,
     etc.) or a file.
    </p></dd><dt><span class="term">Storage Pool</span></dt><dd><p>
     A storage pool basically is a storage resource on the VM Host Server that can
     be used for storing volumes, similar to network storage for a desktop
     machine. Physically it can be one of the following types:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">File System Directory (<span class="guimenu">dir</span>)</span></dt><dd><p>
        A directory for hosting image files. The files can be either one of
        the supported disk formats (raw, qcow2, or qed), or ISO images.
       </p></dd><dt><span class="term">Physical Disk Device (<span class="guimenu">disk</span>)</span></dt><dd><p>
        Use a complete physical disk as storage. A partition is created for
        each volume that is added to the pool.
       </p></dd><dt><span class="term">Pre-Formatted Block Device (<span class="guimenu">fs</span>)</span></dt><dd><p>
        Specify a partition to be used in the same way as a file system
        directory pool (a directory for hosting image files). The only
        difference to using a file system directory is the fact that
        <code class="systemitem">libvirt</code> takes care of mounting the device.
       </p></dd><dt><span class="term">iSCSI Target (iscsi)</span></dt><dd><p>
        Set up a pool on an iSCSI target. You need to have been logged into
        the volume once before, in order to use it with <code class="systemitem">libvirt</code>. Volume
        creation on iSCSI pools is not supported, instead each existing
        Logical Unit Number (LUN) represents a volume. Each volume/LUN also
        needs a valid (empty) partition table or disk label before you can
        use it. If missing, use <span class="command"><strong>fdisk</strong></span> to add it:
       </p><pre class="screen">~ # fdisk -cu /dev/disk/by-path/ip-192.168.2.100:3260-iscsi-iqn.2010-10.com.example:[...]-lun-2
Device contains neither a valid DOS partition table, nor Sun, SGI
or OSF disklabel
Building a new DOS disklabel with disk identifier 0xc15cdc4e.
Changes will remain in memory only, until you decide to write them.
After that, of course, the previous content won't be recoverable.

Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)

Command (m for help): w
The partition table has been altered!

Calling ioctl() to re-read partition table.
Syncing disks.
	</pre></dd><dt><span class="term">LVM Volume Group (logical)</span></dt><dd><p>
        Use a LVM volume group as a pool. You may either use a pre-defined
        volume group, or create a group by specifying the devices to use.
        Storage volumes are created as partitions on the volume.
       </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Deleting the LVM Based Pool"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Deleting the LVM Based Pool</th></tr><tr><td colspan="2" align="left" valign="top"><p>
         When the LVM based pool is deleted in the Storage Manager, the
         volume group is deleted as well. This results in a non-recoverable
         loss of all data stored on the pool!
        </p></td></tr></table></div></dd><dt><span class="term">Multipath Devices (<span class="guimenu">mpath</span>)</span></dt><dd><p>
        At the moment, multipathing support is limited to assigning existing
        devices to the guests. Volume creation or configuring multipathing
        from within <code class="systemitem">libvirt</code> is not supported.
       </p></dd><dt><span class="term">Network Exported Directory (<span class="guimenu">netfs</span>)</span></dt><dd><p>
        Specify a network directory to be used in the same way as a file
        system directory pool (a directory for hosting image files). The
        only difference to using a file system directory is the fact that
        <code class="systemitem">libvirt</code> takes care of mounting the directory. Supported protocols
        are NFS and glusterfs.
       </p></dd><dt><span class="term">SCSI Host Adapter (<span class="guimenu">scsi</span>)</span></dt><dd><p>
        Use an SCSI host adapter in almost the same way a an iSCSI target.
        It is recommended to use a device name from
        <code class="filename">/dev/disk/by-*</code> rather than the simple
        <code class="filename">/dev/sd<em class="replaceable"><code>X</code></em></code>, since the
        latter may change (for example when adding or removing hard disks).
        Volume creation on iSCSI pools is not supported, instead each
        existing LUN (Logical Unit Number) represents a volume.
       </p></dd></dl></div></dd></dl></div><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Security Considerations"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Security Considerations</th></tr><tr><td colspan="2" align="left" valign="top"><p>
   In order to avoid data loss or data corruption, do not attempt to use
   resources such as LVM volume groups, iSCSI targets, etc. that are used to
   build storage pools on the VM Host Server, as well. There is no need to connect
   to these resources from the VM Host Server or to mount them on the
   VM Host Server—<code class="systemitem">libvirt</code> takes care of this.
  </p><p>
   Do not mount partitions on the VM Host Server by label. Under certain
   circumstances it is possible that a partition is labeled from within a
   VM Guest with a name already existing on the VM Host Server.
  </p></td></tr></table></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.storage.vmm"></a>7.1. Managing Storage with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm">¶</a></span></h2></div></div></div><p>
   The Virtual Machine Manager provides a graphical interface—the Storage Manager—
   to manage storage volumes and pools. To access it, either right-click on
   a connection and choose <span class="guimenu">Details</span>, or highlight a
   connection and choose <span class="guimenu">Edit</span>+<span class="guimenu">Connection Details</span>. Select the
   <span class="guimenu">Storage</span> tab.
  </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="60%"><tr><td><img src="images/virt_virt-manager_storage.png" width="100%" /></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.vmm.addpool"></a>7.1.1. Adding a Storage Pool<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm.addpool">¶</a></span></h3></div></div></div><p>
    To add a storage pool, proceed as follows:
   </p><div class="procedure"><ol class="procedure" type="1"><li><p>
      Click the plus symbol in the bottom left corner to open the
      <span class="guimenu">Add a New Storage Pool Window</span>.
     </p></li><li><p>
      Provide a <span class="guimenu">Name</span> for the pool (consisting of
      alphanumeric characters plus _-.) and select a
      <span class="guimenu">Type</span>. Proceed with <span class="guimenu">Forward</span>.
     </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="60%"><tr><td><img src="images/virt_virt-manager_storage_add.png" width="100%" /></td></tr></table></div></div></li><li><p>
      Specify the needed details in the following window. The data that
      needs to be entered depends on the type of pool you are creating.
     </p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="60%"><tr><td><img src="images/virt_virt-manager_storage_add_details.png" width="100%" /></td></tr></table></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">dir:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path</span>: Specify an existing directory.
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">disk:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path</span>: The directory which hosts the
           devices. The default value <code class="filename">/dev</code> should fit
           in most cases.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Format</span>: Format of the device's partition
           table. Using <span class="guimenu">auto</span> should work in most cases.
           If not, get the needed format by running the command
           <span class="command"><strong>parted <code class="option">-l</code></strong></span> on the VM Host Server.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> Path to the device. It is
           recommended to use a device name from
           <code class="filename">/dev/disk/by-*</code> rather than the simple
           <code class="filename">/dev/sd<em class="replaceable"><code>X</code></em></code>, since
           the latter may change (for example when adding or removing hard
           disks). You need to specify the path that resembles the whole
           disk, not a partition on the disk (if existing).
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Build Pool:</span> Activating this option formats the
           device. Use with care— all data on the device will be lost!
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">fs:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path:</span> Mount point on the VM Host Server file
           system.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Format: </span> File system format of the device. the
           default value <code class="literal">auto</code> should work.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> Path to the device file. It is
           recommended to use a device name from
           <code class="filename">/dev/disk/by-*</code> rather than the simple
           <code class="filename">/dev/sd<em class="replaceable"><code>X</code></em></code>, since
           the latter may change (for example when adding or removing hard
           disks).
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">iscsi:</span>
       </span></dt><dd><p>
         Get the necessary data by running the following command on the
         VM Host Server:
        </p><pre class="screen">iscsiadm --mode node</pre><p>
         It will return a list of iSCSI volumes with the following format.
         The elements highlighted with a bold font are the ones needed:
        </p><pre class="screen"><span class="bold"><strong>IP_ADDRESS</strong></span>:PORT,TPGT <span class="bold"><strong>TARGET_NAME_(IQN)</strong></span></pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path:</span> The directory containing the
           device file. Use <code class="literal">/dev/disk/by-path</code> (default)
           or <code class="literal">/dev/disk/by-id</code>.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Host Name:</span> Host name or IP address of the
           iSCSI server.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> The iSCSI target name (IQN).
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">logical:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path:</span> In case you use an existing
           volume group, specify the existing device path. In case of
           building a new LVM volume group, specify a device name in the
           <code class="filename">/dev</code> directory that does not already exist.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> Leave empty when using an
           existing volume group. When creating a new one, specify its
           devices here.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Build Pool:</span> Only activate when creating a new
           volume group.
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">mpath:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path:</span> Support of multipathing is
           currently limited to making all multipath devices available.
           Therefore you may enter an arbitrary string here (needed,
           otherwise the XML parser will fail), it will be ignored anyway.
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">netfs:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">target Path:</span> Mount point on the VM Host Server file
           system.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Format:</span> Network file system protocol
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Host Name:</span> IP address or hostname of the
           server exporting the network file system.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> Directory on the server that is
           being exported.
          </p></li></ul></div></dd><dt><span class="term"><span class="bold"><strong>Type</strong></span><span class="guimenu">scsi:</span>
       </span></dt><dd><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Target Path:</span> The directory containing the
           device file. Use <code class="literal">/dev/disk/by-path</code> (default)
           or <code class="literal">/dev/disk/by-id</code>.
          </p></li><li class="listitem" style="list-style-type: disc"><p>
           <span class="guimenu">Source Path:</span> Name of the SCSI adapter.
          </p></li></ul></div></dd></dl></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: File Browsing"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">File Browsing</th></tr><tr><td colspan="2" align="left" valign="top"><p>
       Using the file browser by clicking on <span class="guimenu">Browse</span> is
       not possible when operating from remote.
      </p></td></tr></table></div></li><li><p>
      Click <span class="guimenu">Finish</span> to add the storage pool.
     </p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.vmm.manage"></a>7.1.2. Managing Storage Pools<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm.manage">¶</a></span></h3></div></div></div><p>
    Virtual Machine Manager's Storage Manager lets you create or delete volumes in a pool. You
    may also temporarily deactivate or permanently delete existing storage
    pools. Changing the basic configuration of a pool is currently not
    supported by SUSE.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.storage.vmm.manage.pool"></a>7.1.2.1. Starting, Stopping and Deleting Pools<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm.manage.pool">¶</a></span></h4></div></div></div><p>
     The purpose of storage pools is to provide block devices located on the
     VM Host Server, that can be added to a VM Guest when managing it from
     remote. In order to make a pool temporarily inaccessible from remote,
     you may <span class="guimenu">Stop</span> it by clicking on the stop symbol in
     the bottom left corner of the Storage Manager. Stopped pools are marked
     with <span class="guimenu">State: Inactive</span> and are grayed out in the list
     pane. By default, a newly created pool will be automatically started
     <span class="guimenu">On Boot</span> of the VM Host Server.
    </p><p>
     To <span class="guimenu">Start</span> an inactive pool and make it available from
     remote again click on the play symbol in the bottom left corner of the
     Storage Manager.
    </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: A Pool's State Does not Affect Attached Volumes"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">A Pool's State Does not Affect Attached Volumes</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Volumes from a pool attached to VM Guests are always available,
      regardless of the pool's state (<span class="guimenu">Active</span> (stopped) or
      <span class="guimenu">Inactive</span> (started)). The state of the pool solely
      affects the ability to attach volumes to a VM Guest via remote
      management.
     </p></td></tr></table></div><p>
     To permanently make a pool inaccessible, you can
     <span class="guimenu">Delete</span> it by clicking on the shredder symbol in the
     bottom left corner of the Storage Manager. You may only delete inactive
     pools. Deleting a pool does not physically erase its contents on
     VM Host Server—it only deletes the pool configuration. However, you
     need to be extra careful when deleting pools, especially when deleting
     LVM volume group-based tools:
    </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Deleting Storage Pools"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Deleting Storage Pools</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Deleting storage pools based on <span class="emphasis"><em>local</em></span> file system
      directories, local partitions or disks has no effect on the
      availability of volumes from these pools currently attached to
      VM Guests.
     </p><p>
      Volumes located in pools of type iSCSI, SCSI, LVM group or Network
      Exported Directory will become inaccessible from the VM Guest in case
      the pool will be deleted. Although the volumes themselves will not be
      deleted, the VM Host Server will no longer have access to the resources.
     </p><p>
      Volumes on iSCSI/SCSI targets or Network Exported Directory will be
      accessible again when creating an adequate new pool or when
      mounting/accessing these resources directly from the host system.
     </p><p>
      When deleting an LVM group-based storage pool, the LVM group
      definition will be erased and the LVM group will no longer exist on
      the host system. The configuration is not recoverable and all volumes
      from this pool are lost.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.storage.vmm.manage.volume_add"></a>7.1.2.2. Adding Volumes to a Storage Pool<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm.manage.volume_add">¶</a></span></h4></div></div></div><p>
     Virtual Machine Manager lets you create volumes in all storage pools, except in pools of
     types Multipath, iSCSI, or SCSI. A volume in these pools is equivalent
     to a LUN and cannot be changed from within <code class="systemitem">libvirt</code>.
    </p><div class="procedure"><ol class="procedure" type="1"><li><p>
       A new volume can either be created using the Storage Manager or while
       adding a new storage device to a VM Guest. In both cases, select a
       <span class="guimenu">Storage Pool</span> and then click <span class="guimenu">New
       Volume</span>.
      </p></li><li><p>
       Specify a <span class="guimenu">Name</span> for the image and choose an image
       format (note that SUSE currently only supports
       <code class="literal">raw</code>, <code class="literal">qcow2</code>, or
       <code class="literal">qed</code> images). The latter option is not available on
       LVM group-based pools.
      </p><p>
       Specify a <span class="guimenu">Max Capacity</span> and the amount of space
       that should initially be allocated. If both values differ, a
       <code class="literal">sparse</code> image file, growing on demand, will be
       created.
      </p></li><li><p>
       Start the volume creation by clicking <span class="guimenu">Finish</span>.
      </p></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.storage.vmm.manage.volume_delete"></a>7.1.2.3. Deleting Volumes From a Storage Pool<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.vmm.manage.volume_delete">¶</a></span></h4></div></div></div><p>
     Deleting a volume can only be done from the Storage Manager, by
     selecting a volume and clicking <span class="guimenu">Delete Volume</span>.
     Confirm with <span class="guimenu">Yes</span>. Use this function with extreme
     care!
    </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: No Checks Upon Volume Deletion"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">No Checks Upon Volume Deletion</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      A volume will be deleted in any case, regardless whether it is
      currently used in an active or inactive VM Guest. There is no way to
      recover a deleted volume.
     </p><p>
      Whether a volume is used by a VM Guest is indicated in the
      <span class="guimenu">Used By</span> column in the Storage Manager.
     </p></td></tr></table></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.storage.virsh"></a>7.2. Managing Storage with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh">¶</a></span></h2></div></div></div><p>
   Managing storage from the command line is also possible by using
   <span class="command"><strong>virsh</strong></span>. However, creating storage pools is currently
   not supported by SUSE. Therefore this section is restricted to document
   functions like starting, stopping and deleting pools and volume
   management.
  </p><p>
   A list of all <span class="command"><strong>virsh</strong></span> subcommands for managing pools and
   volumes is available by running <span class="command"><strong>virsh help pool</strong></span> and
   <span class="command"><strong>virsh help volume</strong></span>, respectively.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.virsh.list_pools"></a>7.2.1. Listing Pools and Volumes<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh.list_pools">¶</a></span></h3></div></div></div><p>
    List all pools currently active by executing the following command. To
    also list inactive pools, add the option <code class="option">--all</code>:
   </p><pre class="screen">virsh pool-list --details</pre><p>
    Details about a specific pool can be obtained with the
    <code class="literal">pool-info</code> subcommand:
   </p><pre class="screen">virsh pool-info <em class="replaceable"><code>POOL</code></em></pre><p>
    Volumes can only be listed per pool by default. To list all volumes from
    a pool, enter the following command.
   </p><pre class="screen">virsh vol-list --details <em class="replaceable"><code>POOL</code></em></pre><p>
    At the moment <span class="command"><strong>virsh</strong></span> offers no tools to show whether a
    volume is used by a guest or not. The following procedure describes a
    way to list volumes from all pools that are currently used by a
    VM Guest.
   </p><div class="procedure"><a id="pro.libvirt.storage.virsh.list_vols"></a><p class="title"><strong>Procedure 7.1. Listing all Storage Volumes Currently Used on a VM Host Server</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#pro.libvirt.storage.virsh.list_vols">¶</a></span></p><ol class="procedure" type="1"><li><p>
      Create an XSLT style sheet by saving the following content to a file,
      for example, ~/libvirt/guest_storage_list.xsl:
     </p><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:output method="text"/&gt;
  &lt;xsl:template match="text()"/&gt;
  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:template match="disk"&gt;
    &lt;xsl:text&gt;  &lt;/xsl:text&gt;
    &lt;xsl:value-of select="(source/@file|source/@dev|source/@dir)[1]"/&gt;
    &lt;xsl:text&gt;&amp;#10;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;</pre></li><li><p>
      Run the following commands in a shell. It is assumed that the guest's
      XML definitions are all stored in the default location
      (<code class="filename">/etc/libvirt/qemu</code>). <span class="command"><strong>xsltproc</strong></span>
      is provided by the package
      <code class="systemitem">libxslt</code>.
     </p><pre class="screen">SSHEET="$HOME/libvirt/guest_storage_list.xsl"
cd /etc/libvirt/qemu
for FILE in *.xml; do
  basename $FILE .xml 
  xsltproc $SSHEET $FILE
done</pre></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.virsh.start_pools"></a>7.2.2. Starting, Stopping and Deleting Pools<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh.start_pools">¶</a></span></h3></div></div></div><p>
    Use the <span class="command"><strong>virsh</strong></span> pool subcommands to start, stop or
    delete a pool. Replace <em class="replaceable"><code>POOL</code></em> with the pool's
    name or its UUID in the following examples:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Stopping a Pool</span></dt><dd><pre class="screen">virsh pool-destroy <em class="replaceable"><code>POOL</code></em></pre><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: A Pool's State Does not Affect Attached Volumes"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">A Pool's State Does not Affect Attached Volumes</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Volumes from a pool attached to VM Guests are always available,
        regardless of the pool's state (<span class="guimenu">Active</span> (stopped)
        or <span class="guimenu">Inactive</span> (started)). The state of the pool
        solely affects the ability to attach volumes to a VM Guest via
        remote management.
       </p></td></tr></table></div></dd><dt><span class="term">Deleting a Pool</span></dt><dd><pre class="screen">virsh pool-delete <em class="replaceable"><code>POOL</code></em></pre><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Deleting Storage Pools"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Deleting Storage Pools</th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Deleting storage pools based on <span class="emphasis"><em>local</em></span> file
        system directories, local partitions or disks has no effect on the
        availability of volumes from these pools currently attached to
        VM Guests.
       </p><p>
        Volumes located in pools of type iSCSI, SCSI, LVM group or Network
        Exported Directory will become inaccessible from the VM Guest in
        case the pool will be deleted. Although the volumes themselves will
        not be deleted, the VM Host Server will no longer have access to the
        resources.
       </p><p>
        Volumes on iSCSI/SCSI targets or Network Exported Directory will be
        accessible again when creating an adequate new pool or when
        mounting/accessing these resources directly from the host system.
       </p><p>
        When deleting an LVM group-based storage pool, the LVM group
        definition will be erased and the LVM group will no longer exist on
        the host system. The configuration is not recoverable and all
        volumes from this pool are lost.
       </p></td></tr></table></div></dd><dt><span class="term">Starting a Pool</span></dt><dd><pre class="screen">virsh pool-start <em class="replaceable"><code>POOL</code></em></pre></dd><dt><span class="term">Enable Autostarting a Pool</span></dt><dd><pre class="screen">virsh pool-autostart <em class="replaceable"><code>POOL</code></em></pre><p>
       Only pools that are marked to autostart start will automatically be
       started in case the VM Host Server reboots.
      </p></dd><dt><span class="term">Disable Autostarting a Pool</span></dt><dd><pre class="screen">virsh pool-autostart <em class="replaceable"><code>POOL</code></em> --disable</pre></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.virsh.add_volumes"></a>7.2.3. Adding Volumes to a Storage Pool<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh.add_volumes">¶</a></span></h3></div></div></div><p>
    <span class="command"><strong>virsh</strong></span> offers two ways to create storage pools: either
    from an XML definition with <code class="literal">vol-create</code> and
    <code class="literal">vol-create-from</code> or via command line arguments with
    <code class="literal">vol-create-as</code>. The first two methods are currently
    not supported by SUSE, therefore this section focuses on the
    subcommand <code class="literal">vol-create-as</code>.
   </p><p>
    To add a volume to an existing pool, enter the following command:
   </p><pre class="screen">virsh vol-create-as <em class="replaceable"><code>POOL</code></em><a id="co.vol-create-as.pool"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a><em class="replaceable"><code>NAME</code></em><a id="co.vol-create-as.name"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> 12G --format<a id="co.vol-create-as.capacity"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a><em class="replaceable"><code>raw|qcow2|qed</code></em><a id="co.vol-create-as.format"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> --allocation 4G<a id="co.vol-create-as.alloc"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-create-as.pool"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </
p></td><td valign="top" align="left"><p>
      Name of the pool to which the volume should be added
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-create-as.name"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Name of the volume
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-create-as.capacity"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Size of the image, in this example 12 gigabyte. Use the suffixes
      k,M,G,T for kilobyte, megabyte, gigabyte, and terabyte, respectively.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-create-as.format"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Format of the volume. SUSE currently supports
      <code class="literal">raw</code>, <code class="literal">qcow2</code>, and
      <code class="literal">qed</code>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-create-as.alloc"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Optional parameter. By default <span class="command"><strong>virsh </strong></span>creates a
      sparse image file that grows on demand. Specify the amount of space
      that should be allocated with this parameter (4 gigabyte in this
      example). Use the suffixes k,M,G,T for kilobyte, megabyte, gigabyte,
      and terabyte, respectively.
     </p><p>
      When not specifying this parameter, a sparse image file with no
      allocation will be generated. If you want to create a non-sparse
      volume, specify the whole image size with this parameter (would be
      <code class="literal">12G</code> in this example).
     </p></td></tr></table></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec.libvirt.storage.virsh.add_volumes.clone"></a>7.2.3.1. Cloning Existing Volumes<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh.add_volumes.clone">¶</a></span></h4></div></div></div><p>
     Another way to add volumes to a pool is to clone an existing volume.
     The new instance is always created in the same pool as the original.
    </p><pre class="screen">vol-clone <em class="replaceable"><code>NAME_EXISTING_VOLUME</code></em><a id="co.vol-clone.existing"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a><em class="replaceable"><code>NAME_NEW_VOLUME</code></em><a id="co.vol-clone.new"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> --pool <em class="replaceable"><code>POOL</code></em><a id="co.vol-clone.pool"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-clone.existing"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Name of the existing volume that should be cloned
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-clone.new"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Name of the new volume
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.vol-clone.pool"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Optional parameter. <code class="systemitem">libvirt</code> tries to locate the existing volume
       automatically. If that fails, specify this parameter.
      </p></td></tr></table></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.storage.virsh.del_volumes"></a>7.2.4. Deleting Volumes from a Storage Pool<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.storage.virsh.del_volumes">¶</a></span></h3></div></div></div><p>
    To permanently delete a volume from a pool, use the subcommand
    <code class="literal">vol-delete</code>:
   </p><pre class="screen">virsh vol-delete <em class="replaceable"><code>NAME</code></em> --pool <em class="replaceable"><code>POOL</code></em></pre><p>
    <code class="option">--pool</code> is optional. <code class="systemitem">libvirt</code> tries to locate the
    volume automatically. If that fails, specify this parameter.
   </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: No Checks Upon Volume Deletion"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">No Checks Upon Volume Deletion</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     A volume will be deleted in any case, regardless whether it is
     currently used in an active or inactive VM Guest. There is no way to
     recover a deleted volume.
    </p><p>
     Whether a volume is used by a VM Guest can only be detected by using
     by the method described in
     <a class="xref" href="opensuse-kvm.html#pro.libvirt.storage.virsh.list_vols" title="Procedure 7.1. Listing all Storage Volumes Currently Used on a VM Host Server">Procedure 7.1, “Listing all Storage Volumes Currently Used on a VM Host Server”</a>.
    </p></td></tr></table></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.config"></a>Chapter 8. Configuring Virtual Machines<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.config">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.tablet">8.1. Enabling Seamless and Synchronized Cursor Movement</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.cdrom">8.2. Adding a CD/DVD-ROM Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.floppy">8.3. Adding a Floppy Device with Virtual Machine Manager</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change">8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager</a></span></dt><dt><span 
class="sect1"><a href="opensuse-kvm.html#sec.kvm.managing.clock">8.5. Clock Settings</a></span></dt></dl></div><p></p><div class="abstract"><div class="titlepage"></div><p>
   Virtual Machine Manager's <span class="guimenu">Details</span> view offers in-depth information about
   the VM Guest's complete configuration and hardware equipment. Using this
   view, you can also change the guest configuration or add and modify
   virtual hardware. To access this view, open the guests console in Virtual Machine Manager
   and either choose <span class="guimenu">View</span>+<span class="guimenu">Details</span> from the menu, or click on the
   blue information icon in the toolbar.
  </p></div><div class="figure"><a id="id721960"></a><p class="title"><strong>Figure 8.1. <span class="guimenu">Details</span> View of a VM Guest</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="75%"><tr><td><img src="images/libvirt_vmm_details.png" width="100%" alt="Details View of a VM Guest" /></td></tr></table></div></div></div><br class="figure-break" /><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.config.tablet"></a>8.1. Enabling Seamless and Synchronized Cursor Movement<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.config.tablet">¶</a></span></h2></div></div></div><p>
   When you click within a VM Guest's console with the mouse, the cursor is
   captured by the console window and cannot be used outside the console
   unless it is explicitly released (by pressing <span class="keycap">Alt</span>+<span class="keycap">Ctrl</span> ). To
   prevent the console from grabbing the key and to enable seamless cursor
   movement between host and guest instead, add a tablet to the VM Guest.
  </p><p>
   Adding a tablet has the additional advantage of synchronizing the cursor
   movement between VM Host Server and VM Guest when using a graphical
   environment on the guest. With no tablet configured on the guest, you
   will often see two cursor symbols with one dragging behind the other.
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
     switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span>+<span class="guimenu">Details</span>.
    </p></li><li><p>
     Click <span class="guimenu">Add Hardware</span> and choose
     <span class="guimenu">Input</span> and then <span class="guimenu">EvTouch USB Graphics
     Tablet</span> in the pop-up window. Proceed with
     <span class="guimenu">Finish</span>.
    </p></li><li><p>
     In case you tried to add the tablet while the guest was still running,
     you will be asked whether to enable the tablet after the next reboot.
     Confirm with <span class="guimenu">Yes</span>.
    </p></li><li><p>
     Once you (re)start the VM Guest the tablet is available in the
     VM Guest.
    </p></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.config.cdrom"></a>8.2. Adding a CD/DVD-ROM Device with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.config.cdrom">¶</a></span></h2></div></div></div><p>
   KVM supports CD or DVD-ROMs in VM Guest either by directly accessing a
   physical drive on the VM Host Server or by accessing ISO images. To create an
   ISO image from an existing CD or DVD, use <span class="command"><strong>dd</strong></span>:
  </p><pre class="screen">dd if=/dev/<em class="replaceable"><code>cd_dvd_device</code></em> of=my_distro.iso bs=2048</pre><p>
   To add a CD/DVD-ROM device to your VM Guest proceed as follows:
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
     switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span>+<span class="guimenu">Details</span>.
    </p></li><li><p>
     Click <span class="guimenu">Add Hardware</span> and choose
     <span class="guimenu">Storage</span> in the pop-up window. Proceed with
     <span class="guimenu">Forward</span>.
    </p></li><li><p>
     Change the <span class="guimenu">Device Type</span> to <span class="guimenu">IDE
     CDROM</span>.
    </p></li><li><p>
     Select <span class="guimenu">Select Managed or Other Existing Storage</span>.
    </p><ol type="a" class="substeps"><li><p>
       To assign the device to a physical medium, enter the path to the
       VM Host Server's CD/DVD-ROM device (for example,
       <code class="filename">/dev/cdrom</code>) next to the
       <span class="guimenu">Browse</span> button. Alternatively you may use the
       <span class="guimenu">Browse</span> button to open a file browser and then
       click <span class="guimenu">Browse Local</span> to select the device. Assigning
       the device to a physical medium is only possible, when the Virtual Machine Manager was
       started on the VM Host Server.
      </p></li><li><p>
       To assign the device to an existing image, click
       <span class="guimenu">Browse</span> to choose an image from a storage pool. If
       the Virtual Machine Manager was started on the VM Host Server, you may alternatively choose
       an image from another location on the file system by clicking
       <span class="guimenu">Browse Local</span>. Select an image and close the file
       browser with <span class="guimenu">Choose Volume</span>.
      </p></li></ol></li><li><p>
     Proceed with <span class="guimenu">Forward</span> to review the settings. Apply
     them with <span class="guimenu">Finish</span>, <span class="guimenu">Yes</span>, and
     <span class="guimenu">Apply</span>.
    </p></li><li><p>
     Reboot the VM Guest to make the new device available. For further
     information also see
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change" title="8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager">Section 8.4, “Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager”</a>.
    </p></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.config.floppy"></a>8.3. Adding a Floppy Device with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.config.floppy">¶</a></span></h2></div></div></div><p>
   Currently KVM only supports the use of floppy disk images—using a
   physical floppy drive is not supported. Create a floppy disk image from
   an existing floppy using <span class="command"><strong>dd</strong></span>:
  </p><pre class="screen">dd if=/dev/fd0 of=/var/lib/libvirt/images/floppy.img</pre><p>
   To create an empty floppy disk image use one of the following commands:
  </p><pre class="screen"># raw image
dd if=/dev/zero of=/var/lib/libvirt/images/floppy.img bs=512 count=2880

# FAT formatted image
mkfs.msdos -C /var/lib/libvirt/images/floppy.img 1440</pre><p>
   To add a floppy device to your VM Guest proceed as follows:
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
     switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span>+<span class="guimenu">Details</span>.
    </p></li><li><p>
     Click <span class="guimenu">Add Hardware</span> and choose
     <span class="guimenu">Storage</span> in the pop-up window. Proceed with
     <span class="guimenu">Forward</span>.
    </p></li><li><p>
     Change the <span class="guimenu">Device Type</span> to <span class="guimenu">Floppy
     Disk</span>.
    </p></li><li><p>
     Choose <span class="guimenu">Select Managed or Other Existing Storage</span> and
     click <span class="guimenu">Browse</span> to choose an existing image from a
     storage pool. If Virtual Machine Manager was started on the VM Host Server, you may
     alternatively choose an image from another location on the file system
     by clicking <span class="guimenu">Browse Local</span>. Select an image and close
     the file browser with <span class="guimenu">Choose Volume</span>.
    </p></li><li><p>
     Proceed with <span class="guimenu">Forward</span> to review the settings. Apply
     them with <span class="guimenu">Finish</span>, <span class="guimenu">Yes</span>, and
     <span class="guimenu">Apply</span>.
    </p></li><li><p>
     Reboot the VM Guest to make the new device available. For further
     information also see
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change" title="8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager">Section 8.4, “Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager”</a>.
    </p></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.config.cdrom.media_change"></a>8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change">¶</a></span></h2></div></div></div><p>
   Regardless whether you are using the VM Host Server's physical CD/DVD-ROM
   device or an ISO/Floppy image: before you can change the media or image
   of an existing device in the VM Guest, you first need to
   <!-- <code class="literal">disconnect</code> -->
   disconnect
   the media from the guest.
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Double-click a VM Guest entry in the Virtual Machine Manager to open its console and
     switch to the <span class="guimenu">Details</span> view with <span class="guimenu">View</span>+<span class="guimenu">Details</span>.
    </p></li><li><p>
     Choose the Floppy or CD/DVD-ROM device and <span class="quote">“<span class="quote">eject</span>”</span> the
     media by clicking <span class="guimenu">Disconnect</span>.
    </p></li><li><p>
     To <span class="quote">“<span class="quote">insert</span>”</span> a new media, click <span class="guimenu">Connect</span>.
    </p><ol type="a" class="substeps"><li><p>
       If using the VM Host Server's physical CD/DVD-ROM device, first change the
       media in the device (this may require to unmount it on the VM Host Server
       before it can be ejected). Then choose <span class="guimenu">CD-ROM or
       DVD</span> and select the device from the drop-down list.
      </p></li><li><p>
       If using an ISO image, choose <span class="guimenu">ISO image Location</span>
       and select an image by clicking <span class="guimenu">Browse</span>. When
       connecting from a remote host, you may only choose images from
       existing storage pools.
      </p></li></ol></li><li><p>
     Click <span class="guimenu">OK</span> to finish. The new media can now be
     accessed in the VM Guest.
    </p></li></ol></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.kvm.managing.clock"></a>8.5. Clock Settings<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.managing.clock">¶</a></span></h2></div></div></div><p>
   Keeping the correct time in a VM Guest is one of the more difficult
   aspects of virtualization. Keeping the correct time is especially
   important for network applications and is also a prerequisite to do a
   live migration of a VM Guest.
  </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: Time Keeping on the VM Host Server"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">Time Keeping on the VM Host Server</th></tr><tr><td colspan="2" align="left" valign="top"><p>
    It is strongly recommended to ensure the VM Host Server keeps the correct time
    as well, for example, by utilizing NTP (see
    Chapter 17, <em>Time Synchronization with NTP</em> (↑Reference) for more information).
   </p></td></tr></table></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.kvm.managing.clock.kvm"></a>8.5.1. Using <code class="systemitem">kvm_clock</code><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.managing.clock.kvm">¶</a></span></h3></div></div></div><p>
    KVM provides a para-virtualized clock which is currently supported by
    <span class="phrase">openSUSE,</span> SUSE Linux Enterprise Server 10 SP3 and newer and RedHat
    Enterprise Linux 5.4 and newer via the <code class="systemitem">kvm_clock</code>
    driver. It is strongly recommended to use
    <code class="systemitem">kvm_clock</code> when available.
   </p><p>
    Use the following command inside a VM Guest running Linux to check
    whether the driver <code class="systemitem">kvm_clock</code> has been loaded:
   </p><pre class="screen">~ # dmesg | grep kvm-clock
[    0.000000] kvm-clock: cpu 0, msr 0:7d3a81, boot clock
[    0.000000] kvm-clock: cpu 0, msr 0:1206a81, primary cpu clock
[    0.012000] kvm-clock: cpu 1, msr 0:1306a81, secondary cpu clock
[    0.160082] Switching to clocksource kvm-clock</pre><p>
    To check which clock source is currently used, run the following command
    in the VM Guest. It should output <code class="literal">kvm-clock</code>:
   </p><pre class="screen">cat /sys/devices/system/clocksource/clocksource0/current_clocksource</pre><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: kvm-clock and NTP"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left"><code class="literal">kvm-clock</code> and NTP</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     When using <code class="literal">kvm-clock</code>, it is not recommended to use
     NTP in the VM Guest, as well. Using NTP on the VM Host Server, however, is
     still recommended.
    </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.kvm.managing.clock.other"></a>8.5.2. Other Time Keeping Methods<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.kvm.managing.clock.other">¶</a></span></h3></div></div></div><p>
    The para-virtualized <code class="literal">kvm-clock</code> is currently not
    available for SUSE Linux Enterprise Server 9 and Windows operating systems. For Windows, use
    the <code class="literal">Windows Time Service Tools</code> for time
    synchronization (see
    <a class="ulink" href="http://technet.microsoft.com/en-us/library/cc773263%28WS.10%29.aspx" target="_top">http://technet.microsoft.com/en-us/library/cc773263%28WS.10%29.aspx</a>
    for more information).
   </p><p>
    Correct time keeping in SUSE Linux Enterprise Server 9 SP4 can be achieved by using special
    boot parameters:
   </p><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>32-bit Kernel:</em></span><code class="literal">clock=pmtmr</code>
    </td></tr><tr><td><span class="emphasis"><em>64-bit Kernel:</em></span><code class="literal">ignore_lost_ticks</code>
    </td></tr></table></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.libvirt.admin"></a>Chapter 9. Administrating VM Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.admin">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#sec.libvirt.admin.migrate">9.1. Migrating VM Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.libvirt.admin.monitor">9.2. Monitoring</a></span></dt></dl></div><p></p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec.libvirt.admin.migrate"></a>9.1. Migrating VM Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.admin.migrate">¶</a></span></h2></div></div></div><p>
   One of the major advantages of virtualization is the fact that VM Guests
   are portable. When a VM Host Server needs to go down for maintenance, or when
   the host gets overloaded, the guests can easily be moved to another
   VM Host Server. KVM and Xen even support <span class="quote">“<span class="quote">live</span>”</span> migrations
   during which the VM Guest is constantly available.
  </p><p>
   In order to successfully migrate a VM Guest to another VM Host Server, the
   following requirements need to be met:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     Host and target must have same processor manufacturer (Intel or AMD).
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     VM Guests running a 64-bit operating system can only be migrated to a
     64-bit host (whereas 32-bit VM Guests can be moved to a 64 or 32-bit
     host).
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Storage devices must be accessible from both machines (for example, via
     NFS or iSCSI) and must be configured as a storage pool on both machines
     (see <a class="xref" href="opensuse-kvm.html#cha.libvirt.storage" title="Chapter 7. Managing Storage">Chapter 7, <em>Managing Storage</em></a> for more information). This
     is also true for CD-ROM or floppy images that are connected during the
     move (however, you may disconnect them prior to the move as described
     in <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change" title="8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager">Section 8.4, “Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager”</a>).
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     <code class="systemitem">libvirtd</code> needs to run on both VM Host Servers and you must be able to open
     a remote <code class="systemitem">libvirt</code> connection between the target and the source host
     (or vice versa). Refer to
     <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote" title="6.2. Configuring Remote Connections">Section 6.2, “Configuring Remote Connections”</a> for details.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     If a firewall is running on the target host ports need to be opened to
     allow the migration. If you do not specify a port during the migration
     process, <code class="systemitem">libvirt</code> chooses one from the range 49152:49215. Make sure
     that either this range (recommended) or a dedicated port of your choice
     is opened in the firewall on the <span class="emphasis"><em>target host</em></span>.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Host and target machine should be in the same subnet on the network,
     otherwise networking will not work after the migration.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     No running or paused VM Guest with the same name must exist on the
     target host. If a shut down machine with the same name exists, its
     configuration will be overwritten.
    </p></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.admin.migrate.virtmanager"></a>9.1.1. Migrating with <span class="command"><strong>virt-manager</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.admin.migrate.virtmanager">¶</a></span></h3></div></div></div><p>
    When using the Virtual Machine Manager to migrate VM Guests, it does not matter on which
    machine it is started. You can start Virtual Machine Manager on the source or the target
    host or even on a third host. In the latter case you need to be able to
    open remote connections to both the target and the source host.
   </p><div class="procedure"><ol class="procedure" type="1"><li><p>
      Start Virtual Machine Manager and establish a connection to the target or the source
      host. If the Virtual Machine Manager was started neither on the target nor the source
      host, connections to both hosts need to be opened.
     </p></li><li><p>
      Right-click on the VM Guest that is to be migrated and choose
      <span class="guimenu">Migrate</span>. Make sure the guest is running or paused -
      it is not possible to migrate guests that are shut off.
     </p></li><li><p>
      Choose a <span class="guimenu">New Host</span> for the VM Guest. If the desired
      target host does not show up, make sure a connection to this host has
      been established.
     </p><p>
      By default, a <span class="quote">“<span class="quote">live</span>”</span> migration is performed. If you
      prefer an <span class="quote">“<span class="quote">offline</span>”</span> migration where the VM Guest is
      paused during the migration, tick <span class="guimenu">Migrate offline</span>.
     </p></li><li><p>
      Click <span class="guimenu">Migrate</span> to start a migration with the default
      port and bandwidth.
     </p><p>
      In order to change these defaults, make the advanced options available
      by clicking the triangle at <span class="guimenu">Advanced Options</span>. Here
      you can enter the target host's <span class="guimenu">Address</span> (IP address
      or hostname), a port and the bandwidth in megabit per second (Mbps).
      If you specify a <span class="guimenu">Port</span>, you must also specify an
      <span class="guimenu">Address</span>; the <span class="guimenu">Bandwidth</span> is
      optional.
     </p></li><li><p>
      Once the migration is complete, the <span class="guimenu">Migrate</span> window
      closes and the VM Guest is now listed on the new host in the Virtual Machine Manager
      Window. The original VM Guest will still be available on the target
      host (in state shut off).
     </p></li></ol></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec.libvirt.admin.migrate.virsh"></a>9.1.2. Migrating with <span class="command"><strong>virsh</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#sec.libvirt.admin.migrate.virsh">¶</a></span></h3></div></div></div><p>
    To migrate a VM Guest with <span class="command"><strong>virsh
    <code class="option">migrate</code></strong></span>, you need to have direct or remote
    shell access to the VM Host Server, because the command needs to be run on the
    host. Basically the migration command looks like this
   </p><pre class="screen">virsh migrate [OPTIONS] <em class="replaceable"><code>VM_ID_or_NAME</code></em><em class="replaceable"><code>CONNECTION URI</code></em> [--migrateuri tcp://<em class="replaceable"><code>REMOTE_HOST:PORT</code></em>]</pre><p>
    The most important options are listed below. See <span class="command"><strong>virsh help
    migrate</strong></span> for a full list.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="option">--live</code>
     </span></dt><dd><p>
       Does a live migration. If not specified, an offline migration where
       the VM Guest is paused during the migration, will be performed.
      </p></dd><dt><span class="term"><code class="option">--suspend</code>
     </span></dt><dd><p>
       Does an offline migration and does not restart the VM Guest on the
       target host.
      </p></dd><dt><span class="term"><code class="option">--persistent</code>
     </span></dt><dd><p>
       By default a migrated VM Guest will be migrated transient, so its
       configuration is automatically deleted on the target host if it is
       shut down. Use this switch to make the migration persistent.
      </p></dd><dt><span class="term"><code class="option">--undefinesource</code>
     </span></dt><dd><p>
       When specified, the VM Guest definition on the source host will be
       deleted after a successful migration (however, virtual disks attached
       to this guest will <span class="emphasis"><em>not</em></span> be deleted).
      </p></dd></dl></div><p>
    The following examples use mercury.example.com as the source system and jupiter.example.com
    as the target system, the VM Guest's name is
    <code class="literal">opensuse11</code> with Id <code class="literal">37</code>.
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Offline migration with default parameters</span></dt><dd><pre class="screen">virsh migrate 37 qemu+ssh://root@jupiter.example.com/system</pre></dd><dt><span class="term">Transient live migration with default parameters</span></dt><dd><pre class="screen">virsh migrate --live opensuse11 qemu+ssh://root@jupiter.example.com/system</pre></dd><dt><span class="term">Persistent live migration; delete VM definition on source</span></dt><dd><pre class="screen">virsh migrate --live --persistent --undefinesource 37 \
qemu+tls://root@jupiter.example.com/system</pre></dd><dt><span class="term">Offline migration using port 49152</span></dt><dd><pre class="screen">virsh migrate opensuse11 qemu+ssh://root@jupiter.example.com/system \
--migrateuri tcp://@jupiter.example.com:49152</pre></dd></dl></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Transient vs. Persistant Migrations"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Transient vs. Persistant Migrations</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     By default <span class="command"><strong>virsh migrate</strong></span> creates a temporary
     (transient) copy of the VM Guest on the target host. A shut down
     version of the original guest description remains on the source host. A
     transient copy will be deleted from the server once it is shut down.
    </p><p>
     In order to create a permanent copy of a guest on the target host, use
     the switch <code class="option">--persistent</code>. A shut down version of the
     original guest description remains on the source host, too. Use the
     option <code class="option">--undefinesource</code> together with
     <code class="option">--persistent</code> for a <span class="quote">“<span class="quote">real</span>”</span> move where a
     permanet copy is created on the target host and the version on the
     source host is deleted.
    </p><p>
     It is not recommended to use <code class="option">--undefinesource</code> without
     the <code class="option">--persistent</code> option, since this will result in the
     loss of both VM Guest definitions when the guest is shut down on the
     target host.
    </p></td></tr></table></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.libvirt.admin.monitor"></a>9.2. Monitoring<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.admin.monitor">¶</a></span></h2></div></div></div><p></p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.libvirt.admin.monitor.virt-manager"></a>9.2.1. Monitoring with Virtual Machine Manager<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.libvirt.admin.monitor.virt-manager">¶</a></span></h3></div></div></div><p>
    After starting Virtual Machine Manager and connecting to the VM Host Server, a CPU usage graph
    of all the running guests is displayed.
   </p><p>
    It is also possible to get information about disk and network usage with
    this tool, however, you must first activate this in the
    <span class="guimenu">Preferences</span>:
   </p><div class="procedure"><ol class="procedure" type="1"><li><p>
      Run <span class="command"><strong>virt-manager</strong></span>.
     </p></li><li><p>
      Select <span class="guimenu">Edit</span>+<span class="guimenu">Preferences</span>.
     </p></li><li><p>
      Change the tab from <span class="guimenu">General</span> to
      <span class="guimenu">Stats</span>.
     </p></li><li><p>
      Activate the check boxes for <span class="guimenu">Disk I/O</span> and
      <span class="guimenu">Network I/O</span>.
     </p></li><li><p>
      If desired, also change the update interval or the number of samples
      that are kept in the history.
     </p></li><li><p>
      Close the <span class="guimenu">Preferences</span> dialog.
     </p></li><li><p>
      Activate the graphs that should be displayed under <span class="guimenu">View</span>+<span class="guimenu">Graph</span>.
     </p></li></ol></div><p>
    Afterwards, the disk and network statistics are also displayed in the
    main window of the Virtual Machine Manager.
   </p><p>
    More precise data is available from the VNC window. Open a VNC window as
    described in <a class="xref" href="opensuse-kvm.html#sec.libvirt.managing.vnc" title="5.2. Opening a Graphical Console">Section 5.2, “Opening a Graphical Console”</a>. Choose
    <span class="guimenu">Details</span> from the toolbar or the
    <span class="guimenu">View</span> menu. The statistics are displayed from the
    <span class="guimenu">Performance</span> entry of the left-hand tree menu.
   </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="id723322"></a>9.2.2. Monitoring with <span class="command"><strong>kvm_stat</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id723322">¶</a></span></h3></div></div></div><p>
    <span class="command"><strong>kvm_stat</strong></span> can be used to trace KVM performance
    events. It monitors <code class="filename">/sys/kernel/debug/kvm</code>, so it
    needs the debugfs to be mounted. On <span class="phrase">openSUSE</span> it should be mounted
    by default. In case it is not mounted, use the following command:
   </p><pre class="screen">mount -t debugfs none /sys/kernel/debug</pre><p>
    <span class="command"><strong>kvm_stat</strong></span> can be used in three different modes:
   </p><pre class="screen">kvm_stat                    # update in 1 second intervals
kvm_stat -1                 # 1 second snapshot
kvm_stat -l &gt; kvmstats.log  # update in 1 second intervals in log format
                            # can be imported to a spreadsheet</pre><div class="example"><a id="id723360"></a><p class="title"><strong>Example 9.1. Typical Output of <span class="command">kvm_stat</span></strong></p><div class="example-contents"><pre class="screen">kvm statistics

 efer_reload                  0       0
 exits                 11378946  218130
 fpu_reload               62144     152
 halt_exits              414866     100
 halt_wakeup             260358      50
 host_state_reload       539650     249
 hypercalls                   0       0
 insn_emulation         6227331  173067
 insn_emulation_fail          0       0
 invlpg                  227281      47
 io_exits                113148      18
 irq_exits               168474     127
 irq_injections          482804     123
 irq_window               51270      18
 largepages                   0       0
 mmio_exits                6925       0
 mmu_cache_miss           71820      19
 mmu_flooded              35420       9
 mmu_pde_zapped           64763      20
 mmu_pte_updated              0       0
 mmu_pte_write           213782      29
 mmu_recycled                 0       0
 mmu_shadow_zapped       128690      17
 mmu_unsync                  46      -1
 nmi_injections               0       0
 nmi_window                   0       0
 pf_fixed               1553821     857
 pf_guest               1018832     562
 remote_tlb_flush        174007      37
 request_irq                  0       0
 signal_exits                 0       0
 tlb_flush               394182     148</pre></div></div><br class="example-break" /><p>
    See
    <a class="ulink" href="http://clalance.blogspot.com/2009/01/kvm-performance-tools.html" target="_top">http://clalance.blogspot.com/2009/01/kvm-performance-tools.html</a>
    for further information on how to interpret these values.
   </p></div></div></div></div><div class="part"><div class="titlepage"><div><div><h1 class="title"><a id="id723395"></a>Part III. Managing Virtual Machines with QEMU</h1></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.overview">10. QEMU Overview</a></span></dt><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.guest_inst">11. Guest Installation</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm">11.1. Basic Installation with <span class="command"><strong>qemu-kvm</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img">11.2. Managing Disk Images with <span class="command"><strong>qemu-img</strong></span></a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.running">12. Running Virtual Machines with qemu-kvm</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.
html#cha.qemu.running.basic">12.1. Basic <span class="command"><strong>qemu-kvm</strong></span> Invocation</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.gen_opts">12.2. General <span class="command"><strong>qemu-kvm</strong></span> Options</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.devices">12.3. Using Devices in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.networking">12.4. Networking in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.vnc">12.5. Viewing a VM Guest with VNC</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.virtfs">12.6. VirtFS: Sharing Folders between Host and Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.ksm">12.7. KSM: Sharing Memory Pages between Guests</a></span></dt></dl></dd><dt><span class="chapter"><a href="opensuse-kvm.html#cha.qemu.monitor">13. Administrating 
Virtual Machines with QEMU Monitor</a></span></dt><dd><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id729276">13.1. Accessing Monitor Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729327">13.2. Getting Information about the Guest System</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729948">13.3. Changing VNC Password</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729967">13.4. Managing Devices</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730008">13.5. Controlling Keyboard and Mouse</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730136">13.6. Changing Available Memory</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730185">13.7. Dumping Virtual Machine Memory</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730504">13.8. Managing Virtual Machine Snapshots</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730727">13.9. Suspending 
and Resuming Virtual Machine Execution</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730818">13.10. Live Migration</a></span></dt></dl></dd></dl></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.qemu.overview"></a>Chapter 10. QEMU Overview<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.overview">¶</a></span></h2></div></div></div><p>
  QEMU is a fast, cross-platform Open Source machine emulator which can
  emulate a huge number of hardware architectures for you. QEMU lets you
  run a complete unmodified operating system (VM Guest) on top of your
  existing system (VM Host Server).
 </p><p>
  You can also use QEMU for debugging purposes - you can easily stop your
  running virtual machine, inspect its state and save and restore it later.
 </p><p>
  QEMU consists of the following parts:
 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
    processor emulator (x86, PowerPC, Sparc ...)
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    emulated devices (graphic card, network card, hard drives, mice ...)
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    generic devices used to connect the emulated devices to the related host
    devices
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    descriptions of the emulated machines (PC, Power Mac ...)
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    debugger
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    user interface used to interact with the emulator
   </p></li></ul></div><p>
  As a virtualization solution, QEMU can be run together with the KVM
  kernel module. If the VM Guest hardware architecture is the same as
  VM Host Server's architecture, QEMU can take advantage of the KVM
  acceleration.
 </p></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.qemu.guest_inst"></a>Chapter 11. Guest Installation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm">11.1. Basic Installation with <span class="command"><strong>qemu-kvm</strong></span></a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img">11.2. Managing Disk Images with <span class="command"><strong>qemu-img</strong></span></a></span></dt></dl></div><p>
  A virtual machine is comprised of data and operating system files that
  define the virtual environment. Virtual machines are hosted and controlled
  by the VM Host Server. This chapter provides generalized instructions for
  installing virtual machines.
 </p><p>
  Before creating a virtual machine, consider the following:
 </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
    If you want to use an automated installation file (AutoYaST, NetWare®
    Response File, or RedHat Kickstart), you need to download it to a
    directory on the host machine server, or make it available through a
    network filesystem.
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    When creating sparse image files, make sure the partition on which you
    create them always has sufficient free space. The guest system has no
    means to check the host's disk space. Having no space left on the host
    partition causes write errors and loss of data on the guest system.
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    NetWare and OES Linux virtual machines need a static IP address for each
    virtual machine you create.
   </p></li><li class="listitem" style="list-style-type: disc"><p>
    If you are installing Open Enterprise Server (OES) 2 Linux, you need a
    network installation source for OES 2 Linux software.
    
   </p></li></ul></div><p>
  For further prerequisites, consult the manuals of the respective operating
  system to install.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.guest_inst.qemu-kvm"></a>11.1. Basic Installation with <span class="command"><strong>qemu-kvm</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm">¶</a></span></h2></div></div></div><p>
   The <code class="systemitem">libvirt</code>-based tools such as
   <span class="command"><strong>virt-manager</strong></span> or <span class="command"><strong>vm-install</strong></span> offer
   convenient interfaces to set up and manage virtual machines. They act as
   a kind of wrapper for <span class="command"><strong>qemu-kvm</strong></span>. However, it is also
   possible to utilize <span class="command"><strong>qemu-kvm</strong></span> directly without using
   <code class="systemitem">libvirt</code>-based tools at all.
  </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Virtual machines created with <span class="command"><strong>qemu-kvm</strong></span> are not
    "visible" for the <code class="systemitem">libvirt</code>-based
    tools.
   </p></td></tr></table></div><p>
   In the following example, a virtual machine with the same parameters as
   in <a class="xref" href="opensuse-kvm.html#ex.libvirt.inst.vm-install.interactive" title="Example 4.1. Interactive Setup on the Command Line Using vm-install">Example 4.1, “Interactive Setup on the Command Line Using <span class="command">vm-install</span>”</a> will be
   set up using <span class="command"><strong>qemu-kvm</strong></span>. For detailed information on the
   commands, refer to the respective man pages.
  </p><p>
   If you do not already have an image of a system which you want to run in
   a virtualized environment, you need to create one from the installation
   media. In such case, you need to prepare a hard disk image, and obtain an
   image of the installation media or the media itself.
  </p><p>
   Create a hard disk with <span class="command"><strong>qemu-img</strong></span>.
  </p><pre class="screen">qemu-img create<a id="co.qemu-img.create"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> -f raw<a id="co.qemu-img.format"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> /images/sles11/hda<a id="co.qemu-img.path"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> 8G<a id="co.qemu-img.size"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-img.create"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     The subcommand <code class="option">create</code> tells
     <span class="command"><strong>qemu-img</strong></span> to create a new image.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-img.format"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specify the disk's format with the <code class="option">-f</code> parameter.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-img.path"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     The full path to the image file.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-img.size"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     The size of the image—8 GB in this case. The image is created as
     a sparse file that grows when the disk is filled with data. The
     specified size defines the maximum size to which the image file can
     grow.
    </p></td></tr></table></div><p>
   After at least one hard disk image is created, you can set up a virtual
   machine with <span class="command"><strong>qemu-kvm</strong></span> that will boot into the
   installation system:
  </p><pre class="screen">qemu-kvm -name "sles11"<a id="co.qemu-kvn.name"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> -M pc-0.12<a id="co.qemu-kvm.type"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> -m 768<a id="co.qemu-kvm.memory"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> \
-smp 2<a id="co.qemu-kvm.cpu"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> -boot d<a id="co.qemu-kvm.boot"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> \
-drive file=/images/sles11/hda,if=virtio,index=0,media=disk,format=raw<a id="co.qemu-kvm.hdd"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> \
-drive file=/isos/SLES-11-SP1-DVD-x86_64-GM-DVD1.iso,index=1,media=cdrom<a id="co.qemu-kvm.cdrom"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a> \
-net nic,model=virtio,macaddr=52:54:00:05:11:11<a id="co.qemu-kvm.nic"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a> \
-vga cirrus<a id="co.qemu-kvm.gfx"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a> -balloon virtio<a id="co.qemu-kvm.balloon"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvn.name"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Name of the virtual machine that will be displayed in the window
     caption and also used for the VNC server. This name must be unique.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.type"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specifies the machine type (<span class="guimenu">Standard PC</span>,
     <span class="guimenu">ISA-only PC</span>, or <span class="guimenu">Intel-Mac</span>). Use
     <span class="command"><strong>qemu-kvm <code class="option">-M ?</code></strong></span> to display a list of
     valid parameters. <code class="literal">pc-0.12</code> is the default
     <span class="guimenu">Standard PC</span>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.memory"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Maximum amount of memory for the virtual machine.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.cpu"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines an SMP system with two processors.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.boot"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specifies the boot order. Valid values are <code class="literal">a</code>,
     <code class="literal">b</code> (floppy 1 and 2), <code class="literal">c</code> (first
     harddisk), d<code class="literal"></code> (first CDROM), or <code class="literal">n</code>
     to <code class="literal">p</code> (Ether-boot from network adapter 1-3). Defaults
     to <code class="literal">c</code>.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.hdd"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines the first (<code class="literal">index=0</code>) hard disk. It will be
     accessed as a paravirtualized (<code class="literal">if=virtio</code>) drive in
     <code class="literal">raw</code> format.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.cdrom"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     The second (<code class="literal">index=1</code>) image drive will act as a
     CD-ROM.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.nic"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines a paravirtualized (<code class="literal">model=virtio</code>) network
     adapter with the MAC address <code class="literal">52:54:00:05:11:11</code>. Be
     sure to specify a unique MAC address, otherwise a network conflict may
     occur.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.gfx"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Specifies the graphic card. If you specify
     <em class="replaceable"><code>none</code></em>, the graphic card will be disabled.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu-kvm.balloon"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Defines the paravirtualized balloon device that allows to dynamically
     change the amount of memory (up to the maximum value specified with the
     parameter <code class="option">-m</code>).
    </p></td></tr></table></div><p>
   After the installation of the guest operating system finishes, you can
   easily start the related virtual machine without the need to specify the
   CD-ROM device:
  </p><pre class="screen">qemu-kvm -name "sles11" -M pc-0.12 -m 768 \
-smp 2 -boot c \
-drive file=/images/sles11/hda,if=virtio,index=0,media=disk,format=raw \
-net nic,model=virtio,macaddr=52:54:00:05:11:11 \
-vga cirrus -balloon virtio
</pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.guest_inst.qemu-img"></a>11.2. Managing Disk Images with <span class="command"><strong>qemu-img</strong></span><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img">¶</a></span></h2></div></div></div><p>
   In the previous section (see
   <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm" title="11.1. Basic Installation with qemu-kvm">Section 11.1, “Basic Installation with <span class="command"><strong>qemu-kvm</strong></span>”</a>, we used the
   <span class="command"><strong>qemu-img</strong></span> command to create an image of a hard disk.
   You can, however, use <span class="command"><strong>qemu-img</strong></span> for general disk image
   manipulation. This section introduces useful <span class="command"><strong>qemu-img</strong></span>
   subcommands to help manage the disk images flexibly.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.guest_inst.qemu-img.general_invocation"></a>11.2.1. General Information on qemu-img Invocation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.general_invocation">¶</a></span></h3></div></div></div><p>
    <span class="command"><strong>qemu-img</strong></span> uses subcommands (like
    <span class="command"><strong>zypper</strong></span> does) to do specific tasks. Each subcommand
    understands a different set of options. Some of these options are
    general and used by more of these subcommands, while some of them are
    unique to the related subcommand. See the qemu-img manual page
    (<span class="command"><strong>man 1 qemu-img</strong></span>) for a complete list of all supported
    options. <span class="command"><strong>qemu-img</strong></span> uses the following general syntax:
   </p><pre class="screen">qemu-img subcommand [options]</pre><p>
    and supports the following subcommands:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">create</code>
     </span></dt><dd><p>
       Creates a new disk image on the filesystem.
      </p></dd><dt><span class="term"><code class="literal">check</code>
     </span></dt><dd><p>
       Checks an existing disk image for errors.
      </p></dd><dt><span class="term"><code class="literal">convert</code>
     </span></dt><dd><p>
       Converts an existing disk image to a new one in a different format.
      </p></dd><dt><span class="term"><code class="literal">info</code>
     </span></dt><dd><p>
       Displays information about the relevant disk image.
      </p></dd><dt><span class="term"><code class="literal">snapshot</code>
     </span></dt><dd><p>
       Manages snapshots of existing disk images.
      </p></dd><dt><span class="term"><code class="literal">commit</code>
     </span></dt><dd><p>
       Applies changes made to an existing disk image.
      </p></dd><dt><span class="term"><code class="literal">rebase</code>
     </span></dt><dd><p>
       Creates a new base image based on an existing image.
      </p></dd><dt><span class="term"><code class="literal">resize</code>
     </span></dt><dd><p>
       Increases or decreases the size of an existing image.
      </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.guest_inst.qemu-img.create"></a>11.2.2. Creating, Converting and Checking Disk Images<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create">¶</a></span></h3></div></div></div><p>
    This section describes how to create disk images, check their condition,
    convert a disk image from one format to another, and get detailed
    information about a particular disk image.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.create.create"></a>11.2.2.1. qemu-img create<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create.create">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img create</strong></span> to create a new disk image for
     your VM Guest operating system. The command uses the following syntax:
    </p><pre class="screen">qemu-img create -f fmt<a id="co.qemu_img.create.f"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> -o options<a id="co.qemu_img.create.o"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> fname<a id="co.qemu_img.create.filename"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> size<a id="co.qemu_img.create.size"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.create.f"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The format of the target image. To get a complete list of image
       formats supported by QEMU, run <span class="command"><strong>qemu-img
       <code class="option">-h</code></strong></span> and look at the last line of the
       output.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.create.o"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Some of the image formats support additional options to be passed on
       the command line. You can specify them here with the
       <code class="literal">-o</code> option. The <code class="literal">raw</code> image format
       supports only the <code class="literal">size</code> option, so it is possible
       to insert <code class="literal">-o size=8G</code> instead of adding the size
       option at the end of the command.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.create.filename"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Path to the target disk image to be created.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.create.size"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Size of the target disk image (if not already specified with the
       <code class="literal">-o size=&lt;image_size&gt;</code> option. Optional suffixes
       for the image size are <code class="literal">K</code> (kilobyte),
       <code class="literal">M</code> (megabyte), <code class="literal">G</code> (gigabyte), or
       <code class="literal">T</code> (terabyte).
      </p></td></tr></table></div><p>
     To create a new disk image <code class="filename">sles11sp1.raw</code> in the
     directory <code class="filename">/images</code> growing up to a maximum size of
     4 GB, run the following command:
    </p><pre class="screen">tux@venus:~&gt; qemu-img create -f raw -o size=4G /images/sles11sp1.raw
Formatting '/images/sles11sp1.raw', fmt=raw size=4294967296

tux@venus:~&gt; ls -l /images/sles11sp1.raw
-rw-r--r-- 1 tux users 4294967296 Nov 15 15:56 /images/sles11sp1.raw

tux@venus:~&gt; qemu-img info /images/sles11sp1.raw
image: /images/sles11sp1.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 0
</pre><p>
     As you can see, the <span class="emphasis"><em>virtual</em></span> size of the newly
     created image is 4 GB, but the actual reported disk size is 0 as no
     data has been written to the image yet.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.create.convert"></a>11.2.2.2. qemu-img convert<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create.convert">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img convert</strong></span> to convert disk images to
     another format. To get a complete list of image formats supported by
     QEMU, run <span class="command"><strong>qemu-img <code class="option">-h</code></strong></span> and look at
     the last line of the output. The command uses the following syntax:
    </p><pre class="screen">qemu-img convert -c<a id="co.qemu_img.convert.c"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> -f fmt<a id="co.qemu_img.convert.fmt"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> -O out_fmt<a id="co.qemu_img.convert.ofmt"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> -o options<a id="co.qemu_img.convert.o"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> fname<a id="co.qemu_img.convert.fname"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> out_fname<a id="co.qemu_img.convert.ofname"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.c"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="
top" align="left"><p>
       Applies compression on the target disk image. Only
       <code class="literal">qcow</code> and <code class="literal">qcow2</code> formats support
       compression.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.fmt"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The format of the source disk image. It is autodetected in most cases
       and can therefore be omitted.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.ofmt"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The format of the target disk image.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.o"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Specify additional options relevant for the target image format. Use
       <code class="literal">-o ?</code> to view the list of options supported by the
       target image format:
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.fname"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Path to the source disk image to be converted.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.convert.ofname"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Path to the converted target disk image.
      </p></td></tr></table></div><pre class="screen">tux@venus:~&gt; qemu-img convert -O vmdk /images/sles11sp1.raw \
/images/sles11sp1.vmdk

tux@venus:~&gt; ls -l /images/
-rw-r--r-- 1 tux users 4294967296 16. lis 10.50 sles11sp1.raw
-rw-r--r-- 1 tux users 2574450688 16. lis 14.18 sles11sp1.vmdk
</pre><p>
     To see a list of options relevant for the selected target image format,
     run the following command (replace <code class="literal">vmdk</code> with your
     image format):
    </p><pre class="screen">tux@venus:~&gt; qemu-img convert -O vmdk /images/sles11sp1.raw \
/images/sles11sp1.vmdk -o ?
Supported options:
size             Virtual disk size
backing_file     File name of a base image
compat6          VMDK version 6 image
subformat        VMDK flat extent format, can be one of {monolithicSparse \
    (default) | monolithicFlat | twoGbMaxExtentSparse | twoGbMaxExtentFlat}
scsi             SCSI image
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.create.check"></a>11.2.2.3. qemu-img check<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create.check">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img check</strong></span> to check the existing disk image
     for errors. Not all disk image formats support this feature. The
     command uses the following syntax:
    </p><pre class="screen">qemu-img check -f fmt<a id="co.qemu_img.check.fmt"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> fname<a id="co.qemu_img.check.fname"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.check.fmt"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The format of the source disk image. It is autodetected in most cases
       and can therefore be omitted.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.check.fname"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Path to the source disk image to be checked.
      </p></td></tr></table></div><p>
     If no error is found, the command returns no output. Otherwise, the
     type and number of errors found is shown.
    </p><pre class="screen">tux@venus:~&gt; qemu-img check -f qcow2 /images/sles11sp1.qcow2
ERROR: invalid cluster offset=0x2af0000
[...]
ERROR: invalid cluster offset=0x34ab0000
378 errors were found on the image.
</pre></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="id724442"></a>11.2.2.4. Increasing the Size of an Existing Disk Image<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id724442">¶</a></span></h4></div></div></div><p>
     When creating a new image, you must specify its maximum size before the
     image is created (see
     <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create.create" title="11.2.2.1. qemu-img create">Section 11.2.2.1, “qemu-img create”</a>).
     After you install and run VM Guest for some time, the initial size of
     the image may no longer be sufficient and you need to add more space to
     it.
    </p><p>
     To increase the size of an existing disk image by 2 Gigabytes, use
    </p><pre class="screen">qemu-img resize /images/sles11sp1.raw +2GB</pre><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
      You can resize the <code class="literal">raw</code> disk images only. To resize
      other image formats, convert it to <code class="literal">raw</code> with
      <span class="command"><strong>qemu-img convert</strong></span> first.
     </p></td></tr></table></div><p>
     The image now contains an empty space of 2 GB after the final
     partition. You can resize the existing partitions or add new ones.
    </p><div class="figure"><a id="id724485"></a><p class="title"><strong>Figure 11.1. New 2GB Partition in Guest YaST Partitioner</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="75%"><tr><td><img src="images/qemu_guest_partman.png" width="100%" alt="New 2GB Partition in Guest YaST Partitioner" /></td></tr></table></div></div></div><br class="figure-break" /></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.guest_inst.qemu-img.snapshots"></a>11.2.3. Managing Snapshots of Virtual Machines with qemu-img<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.snapshots">¶</a></span></h3></div></div></div><p>
    Virtual machine snapshots are snapshots of the complete environment in
    which a VM Guest is running. The snapshot includes the state of the
    processor (CPU), memory (RAM), devices, and all writable disks.
   </p><p>
    Snapshots are helpful when you need to save your virtual machine in a
    particular state. For example, after you configured network services on
    a virtualized server and want to quickly start the virtual machine in
    the same state you last saved it. Or you can create a snapshot after the
    virtual machine has been powered off to create a backup state before you
    try something experimental and possibly make VM Guest unstable. This
    section introduces the latter case, while the former is described in
    <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a>.
   </p><p>
    To use snapshots, your VM Guest must contain at least one writable hard
    disk image in <code class="literal">qcow2</code> format. This device is usually
    the first virtual hard disk.
   </p><p>
    Virtual machine snapshots are created with the <code class="literal">savevm</code>
    command in the interactive QEMU monitor. You can assign a 'tag' to
    each snapshot which makes its identification easier. For more
    information on QEMU monitor, see <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a>.
   </p><p>
    Once your <code class="literal">qcow2</code> disk image contains saved snapshots,
    you can inspect them with the <span class="command"><strong>qemu-img snapshot</strong></span>
    command.
   </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     Do not create or delete virtual machine snapshots with the
     <span class="command"><strong>qemu-img snapshot</strong></span> command while the virtual machine
     is running. Otherwise, you can damage the disk image with the state of
     the virtual machine saved.
    </p></td></tr></table></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.snapshots.l"></a>11.2.3.1. Listing Existing Snapshots<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.snapshots.l">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img snapshot -l
     <em class="replaceable"><code>disk_image</code></em></strong></span> to view a list of all
     existing snapshots saved in the <code class="literal">disk_image</code> image.
     You can get the list even while the VM Guest is running.
    </p><pre class="screen">tux@venus:~&gt; qemu-img snapshot -l /images/sles11sp1.qcow2 
Snapshot list:
ID<a id="co.qemu_img.snapshot.l.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>       TAG<a id="co.qemu_img.snapshot.l.tag"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>               VM SIZE<a id="co.qemu_img.snapshot.l.size"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>        DATE<a id="co.qemu_img.snapshot.l.date"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a>          VM CLOCK<a id="co.qemu_img.snapshot.l.clock"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a>
1         booting                4.4M 2010-11-22 10:51:10   00:00:20.476
2         booted                 184M 2010-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2010-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2010-11-22 11:12:27   00:08:44.965</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.snapshot.l.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Unique identification number of the snapshot. Usually
       auto-incremented.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.snapshot.l.tag"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Unique description string of the snapshot. It is meant as a human
       readable version of the ID.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.snapshot.l.size"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The disk space occupied by the snapshot. Note that the more memory is
       consumed by running applications, the bigger the snapshot is.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.snapshot.l.date"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Time and date the snapshot was created.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.snapshot.l.clock"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The current state of the virtual machine's clock.
      </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.snapshots.c"></a>11.2.3.2. Creating Snapshots of a Powered-Off Virtual Machine<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.snapshots.c">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img snapshot -c
     <em class="replaceable"><code>snapshot_title</code></em>
     <em class="replaceable"><code>disk_image</code></em></strong></span> to create a snapshot of
     the current state of a virtual machine which was previously powered
     off.
    </p><pre class="screen">tux@venus:~&gt; qemu-img snapshot -c backup_snapshot /images/sles11sp1.qcow2</pre><pre class="screen">tux@venus:~&gt; qemu-img snapshot -l /images/sles11sp1.qcow2 
Snapshot list:
ID        TAG                 VM SIZE                DATE       VM CLOCK
1         booting                4.4M 2010-11-22 10:51:10   00:00:20.476
2         booted                 184M 2010-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2010-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2010-11-22 11:12:27   00:08:44.965
5         backup_snapshot           0 2010-11-22 14:14:00   00:00:00.000</pre><p>
     Once something breaks in your VM Guest and you need to restore the
     state of the saved snapshot (id 5 in our example), power off your
     VM Guest and do the following:
    </p><pre class="screen">tux@venus:~&gt; qemu-img snapshot -a 5 /images/sles11sp1.qcow2</pre><p>
     Next time you run the virtual machine with <span class="command"><strong>qemu-kvm</strong></span>,
     it will be in the state of snapshot number 5.
    </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
      The <span class="command"><strong>qemu-img snapshot -c</strong></span> command is not related to
      the <code class="literal">savevm</code> command of QEMU monitor (see
      <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a>. For example, you cannot
      apply a snapshot with <span class="command"><strong>qemu-img snapshot -a</strong></span> on a
      snapshot created with <code class="literal">savevm</code> in QEMU's monitor.
     </p></td></tr></table></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.snapshots.d"></a>11.2.3.3. Deleting Snapshots<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.snapshots.d">¶</a></span></h4></div></div></div><p>
     Use <span class="command"><strong>qemu-img snapshot -d
     <em class="replaceable"><code>snapshot_id</code></em>
     <em class="replaceable"><code>disk_image</code></em></strong></span> to delete old or
     unneeded snapshots of a virtual machine. This saves some disk space
     inside the <code class="literal">qcow2</code> disk image as the space occupied by
     the snapshot data is restored:
    </p><pre class="screen">tux@venus:~&gt; qemu-img snapshot -d 2 /images/sles11sp1.qcow2</pre></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.guest_inst.qemu-img.effect"></a>11.2.4. Manipulate Disk Images Effectively<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.effect">¶</a></span></h3></div></div></div><p>
    Imagine the following real-life situation: you are a server
    administrator who runs and manages a number of virtualized operating
    systems. One group of these systems are based on one specific
    distribution, while another group (or groups) is based on different
    versions of the distribution or even on a different (and maybe non-Unix)
    platform. And to make the case even more complex, individual virtual
    guest systems based on the same distribution usually differ according to
    the department and deployment: a file server typically uses different
    setup and services than a Web server does, while both may still be based
    on SUSE® Linux Enterprise Server 11 SP1.
   </p><p>
    With QEMU it is possible to create <span class="quote">“<span class="quote">base</span>”</span> disk images.
    You can use them as template virtual machines. These base images will
    save you plenty of time because you will never need to install the same
    operating system more than once.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.effect.base_and_derived"></a>11.2.4.1. Base and Derived Images<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.effect.base_and_derived">¶</a></span></h4></div></div></div><p>
     First, build a disk image as usual and install the target system on it.
     For more information, see
     <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm" title="11.1. Basic Installation with qemu-kvm">Section 11.1, “Basic Installation with <span class="command"><strong>qemu-kvm</strong></span>”</a> and
     <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.create" title="11.2.2. Creating, Converting and Checking Disk Images">Section 11.2.2, “Creating, Converting and Checking Disk Images”</a>. Then build a new
     image while using the first one as a base image. The base image is also
     called a 'backing' file. After your new 'derived' image is built, never
     boot the base image again, but boot the derived image instead. Several
     derived images may depend on one base image at the same time.
     Therefore, changing the base image can damage the dependencies. While
     using your derived image, QEMU writes changes to it and uses the base
     image only for reading.
    </p><p>
     It is a good practice to create a base image from a freshly installed
     (and, if needed, registered) operating system with no patches applied
     and no additional applications installed or removed. Later on, you can
     create another base image with the latest patches applied and based on
     the original base image.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.effect.create_derived"></a>11.2.4.2. Creating Derived Images<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.effect.create_derived">¶</a></span></h4></div></div></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
      While you can use the <code class="literal">raw</code> format for base images,
      you cannot use it for derived images because the
      <code class="literal">raw</code> format does not support the
      <code class="literal">backing_file</code> option. Use for example the
      <code class="literal">qcow2</code> format for the derived images.
     </p></td></tr></table></div><p>
     For example, <code class="filename">/images/sles11sp1_base.raw</code> is the
     base image holding a freshly installed system.
    </p><pre class="screen">tux@venus:~&gt; qemu-img info /images/sles11sp1_base.raw 
image: /images/sles11sp1_base.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.4G</pre><p>
     The image's reserved size is 4 GB, the actual size is 2.4 GB, and its
     format is <code class="literal">raw</code>. Create an image derived from the
     <code class="filename">/images/sles11sp1_base.raw</code> base image with:
    </p><pre class="screen">tux@venus:~&gt; qemu-img create -f qcow2 /images/sles11sp1_derived.qcow2 \
-o backing_file=/images/sles11sp1_base.raw 
Formatting '/images/sles11sp1_derived.qcow2', fmt=qcow2 size=4294967296 \
backing_file='/images/sles11sp1_base.raw' encryption=off cluster_size=0
</pre><p>
     Look at the derived image details:
    </p><pre class="screen">tux@venus:~&gt; qemu-img info /images/sles11sp1_derived.qcow2 
image: /images/sles11sp1_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 140K
cluster_size: 65536
backing file: /images/sles11sp1_base.raw \
(actual path: /images/sles11sp1_base.raw)</pre><p>
     Although the reserved size of the derived image is the same as the size
     of the base image (4 GB), the actual size is 140 KB only. The reason is
     that only changes made to the system inside the derived image are
     saved. Run the derived virtual machine, register it, if needed, and
     apply the latest patches. Do any other changes in the system such as
     removing unneeded or installing new software packages. Then shut the
     VM Guest down and examine its details once more:
    </p><pre class="screen">tux@venus:~&gt; qemu-img info /images/sles11sp1_derived.qcow2
image: /images/sles11sp1_derived.qcow2
file format: qcow2
virtual size: 4.0G (4294967296 bytes)
disk size: 1.1G
cluster_size: 65536
backing file: /images/sles11sp1_base.raw \
(actual path: /images/sles11sp1_base.raw)</pre><p>
     The <code class="literal">disk size</code> value has grown to 1.1 GB, which is
     the disk space occupied by the changes on the filesystem compared to
     the base image.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.effect.rebase"></a>11.2.4.3. Rebasing Derived Images<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.effect.rebase">¶</a></span></h4></div></div></div><p>
     Once you modify the derived image (apply patches, install specific
     applications, or change the environment settings etc.) into a
     satisfactory shape, at some point you probably want to create a new
     base image 'merged' from the base image and the derived one. Your first
     base image (<code class="filename">/images/sles11sp1_base.raw</code>) holds a
     freshly installed system and can be a template for new modified base
     images, while the new one can contain the same system as the first one
     plus all security and update patches applied, for example. After you
     created this new base image, you can use it as a template for more
     specialized derived images as well. The new base image becomes
     independent of the original one. The process of creating base images
     from derived ones is called 'rebasing':
    </p><pre class="screen">tux@venus:~&gt; qemu-img convert /images/sles11sp1_derived.qcow2 \
-O raw /images/sles11sp1_base2.raw</pre><p>
     This command created the new base image
     <code class="filename">/images/sles11sp1_base2.raw</code> using the
     <code class="literal">raw</code> format.
    </p><pre class="screen">tux@venus:~&gt; qemu-img info /images/sles11sp1_base2.raw
image: /images/sles11sp1_base2.raw
file format: raw
virtual size: 4.0G (4294967296 bytes)
disk size: 2.8G</pre><p>
     The new image is 0.4 gigabytes bigger than the original base image. It
     uses no backing file, and you can easily create new derived images
     based upon it. This lets you create a sophisticated hierarchy of
     virtual disk images for your organization, saving a lot of time and
     work.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.guest_inst.qemu-img.effect.mount"></a>11.2.4.4. Mounting an Image on a VM Host Server<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.effect.mount">¶</a></span></h4></div></div></div><p>
     Sometimes it is useful to mount a virtual disk image under the host
     system. For example, if VM Host Server does not have a network support, this
     can be the only way to transfer files in and out of a VM Guest.
    </p><p>
     Linux systems can mount an internal partition of a
     <code class="literal">raw</code> disk image using a 'loopback' device. The first
     example procedure is more complex but more illustrative, while the
     second one is straightforward:
    </p><div class="procedure"><a id="id725035"></a><p class="title"><strong>Procedure 11.1. Mounting Disk Image by Calculating Partition Offset</strong></p><ol class="procedure" type="1"><li><p>
       Set a <span class="emphasis"><em>loop</em></span> device on the disk image whose
       partition you want to mount.
      </p><pre class="screen">tux@venus:~&gt; losetup /dev/loop0 /images/sles11sp1_base.raw</pre></li><li><p>
       Find the <span class="emphasis"><em>sector size</em></span> and the starting
       <span class="emphasis"><em>sector number</em></span> of the partition you want to
       mount.
      </p><pre class="screen">tux@venus:~&gt; fdisk -lu /dev/loop0

Disk /dev/loop0: 4294 MB, 4294967296 bytes
255 heads, 63 sectors/track, 522 cylinders, total 8388608 sectors
Units = sectors of 1 * 512 = 512<a id="co.qemu_img.loopback.sector_size"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> bytes
Disk identifier: 0x000ceca8

       Device Boot      Start         End      Blocks   Id  System
/dev/loop0p1              63     1542239      771088+  82  Linux swap
/dev/loop0p2   *     1542240<a id="co.qemu_img.loopback.sector_start"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>    8385929     3421845   83  Linux</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.loopback.sector_size"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         The disk sector size.
        </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_img.loopback.sector_start"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
         The starting sector of the partition.
        </p></td></tr></table></div></li><li><p>
       Calculate the partition start offset:
      </p><p>
       <code class="literal">sector_size * sector_start = 512 * 1542240 = 789626880
       </code>
      </p></li><li><p>
       Delete the loop and mount the partition inside the disk image with
       the calculated offset on a prepared directory.
      </p><pre class="screen">tux@venus:~&gt; losetup -d /dev/loop0
tux@venus:~&gt; mount -o loop,offset=789626880 \
/images/sles11sp1_base.raw /mnt/sles11sp1/
tux@venus:~&gt; ls -l /mnt/sles11sp1/
total 112
drwxr-xr-x   2 root root  4096 Nov 16 10:02 bin
drwxr-xr-x   3 root root  4096 Nov 16 10:27 boot
drwxr-xr-x   5 root root  4096 Nov 16 09:11 dev
[...]
drwxrwxrwt  14 root root  4096 Nov 24 09:50 tmp
drwxr-xr-x  12 root root  4096 Nov 16 09:16 usr
drwxr-xr-x  15 root root  4096 Nov 16 09:22 var
</pre></li><li><p>
       Copy one or more files onto the mounted partition and unmount it when
       finished.
      </p><pre class="screen">tux@venus:~&gt; cp /etc/X11/xorg.conf /mnt/sles11sp1/root/tmp
tux@venus:~&gt; ls -l /mnt/sles11sp1/root/tmp
tux@venus:~&gt; umount /mnt/sles11sp1/</pre></li></ol></div><div class="procedure"><a id="id725173"></a><p class="title"><strong>Procedure 11.2. Mounting Disk Image while Utilizing <span class="command"><strong>kpartx</strong></span></strong></p><ol class="procedure" type="1"><li><p>
       Set a <span class="emphasis"><em>loop</em></span> device on the disk image whose
       partition you want to mount.
      </p><pre class="screen">tux@venus:~&gt; losetup /dev/loop0 /images/sles11sp1_base.raw</pre></li><li><p>
       Create a device map from the disk image's partitions.
      </p><pre class="screen">tux@venus:~&gt; kpartx -a /dev/loop0</pre></li><li><p>
       Mount any partition of the disk image on a prepared mount point.
      </p><pre class="screen">tux@venus:~&gt; mount /dev/mapper/loop0p1 /mnt/p1</pre><p>
       You can replace <code class="literal">loop0p1</code> with the number of the
       partition you want to mount, for example <code class="literal">loop0p3</code>
       to mount the third partition on the disk image.
      </p></li><li><p>
       Copy or move files or directories to and from the mounted partition
       as you like. Once you finish, unmount the partition and delete the
       loop.
      </p><pre class="screen">tux@venus:~&gt; umount /mnt/p1</pre><pre class="screen">tux@venus:~&gt; losetup -d /dev/loop0</pre></li></ol></div><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Never mount a partition of an image of a running virtual machine in a
      <code class="literal">read-write</code> mode. This could corrupt the partition
      and break the whole VM Guest.
     </p></td></tr></table></div></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.qemu.running"></a>Chapter 12. Running Virtual Machines with qemu-kvm<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.basic">12.1. Basic <span class="command"><strong>qemu-kvm</strong></span> Invocation</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.gen_opts">12.2. General <span class="command"><strong>qemu-kvm</strong></span> Options</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.devices">12.3. Using Devices in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.qemu.running.networking">12.4. Networking in QEMU</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#cha.
qemu.running.vnc">12.5. Viewing a VM Guest with VNC</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.virtfs">12.6. VirtFS: Sharing Folders between Host and Guests</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#kvm.qemu.ksm">12.7. KSM: Sharing Memory Pages between Guests</a></span></dt></dl></div><p>
  Once you have a virtual disk image ready (for more information on disk
  images, see <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img" title="11.2. Managing Disk Images with qemu-img">Section 11.2, “Managing Disk Images with <span class="command"><strong>qemu-img</strong></span>”</a>), it is time to
  start the related virtual machine.
  <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm" title="11.1. Basic Installation with qemu-kvm">Section 11.1, “Basic Installation with <span class="command"><strong>qemu-kvm</strong></span>”</a> introduced simple commands
  to install and run a VM Guest. This chapter focuses on a more detailed
  explanation of <span class="command"><strong>qemu-kvm</strong></span> usage, and shows solutions of
  more specific tasks. For a complete list of <span class="command"><strong>qemu-kvm</strong></span>'s
  options, see its manual page (<span class="command"><strong>man 1 qemu-kvm</strong></span>).
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.running.basic"></a>12.1. Basic <span class="command"><strong>qemu-kvm</strong></span> Invocation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.basic">¶</a></span></h2></div></div></div><p>
   The <span class="command"><strong>qemu-kvm</strong></span> command uses the following syntax:
  </p><pre class="screen">qemu-kvm options<a id="co.qemu.running.basic.opts"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> disk_img<a id="co.qemu.running.basic.img"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.running.basic.opts"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     <span class="command"><strong>qemu-kvm</strong></span> understands a large number of options. Most
     of them define parameters of the emulated hardware, while others affect
     more general emulator behavior. If you do not supply any options,
     default values are used, and you need to supply the path to a disk
     image to be run.
    </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.running.basic.img"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
     Path to the disk image holding the guest system you want to virtualize.
     <span class="command"><strong>qemu-kvm</strong></span> supports a large number of image formats.
     Use <span class="command"><strong>qemu-img --help</strong></span> to list them. If you do not
     supply the path to a disk image as a separate argument, you have to use
     the <code class="literal">-drive file=</code> option.
    </p></td></tr></table></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.running.gen_opts"></a>12.2. General <span class="command"><strong>qemu-kvm</strong></span> Options<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.gen_opts">¶</a></span></h2></div></div></div><p>
   This section introduces general <span class="command"><strong>qemu-kvm</strong></span> options and
   options related to the basic emulated hardware, such as virtual machine's
   processor, memory, model type, or time processing methods.
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-name <em class="replaceable"><code>name_of_guest</code></em></code>
    </span></dt><dd><p>
      Specifies the name of the running guest system. The name is displayed
      in the window caption and also used for the VNC server.
     </p></dd><dt><span class="term"><code class="literal">-boot <em class="replaceable"><code>options</code></em></code>
    </span></dt><dd><p>
      Specifies the order in which the defined drives will be booted. Drives
      are represented by letters, where 'a' and 'b' stands for the floppy
      drives 1 and 2, 'c' stands for the first hard disk, 'd' stands for the
      first CD-ROM drive, and 'n' to 'p' stand for Ether-boot network
      adapters.
     </p><p>
      For example, <code class="literal">qemu-kvm [...] -boot order=ndc</code> first
      tries to boot from network, then from the first CD-ROM drive, and
      finally from the first hard disk.
     </p></dd><dt><span class="term"><code class="literal">-pidfile <em class="replaceable"><code>fname</code></em></code>
    </span></dt><dd><p>
      Stores the QEMU's process identification number (PID) in a file.
      This is useful if you run QEMU from a script.
     </p></dd><dt><span class="term"><code class="literal">-nodefaults</code>
    </span></dt><dd><p>
      By default QEMU creates basic virtual devices even if you do not
      specify them on the command line. This option turns this feature off,
      and you must specify every single device manually, including graphical
      and network cards, parallel or serial ports, or virtual consoles. Even
      QEMU monitor is not attached by default.
     </p></dd><dt><span class="term"><code class="literal">-daemonize</code>
    </span></dt><dd><p>
      'Daemonizes' the QEMU process after it is started. QEMU will
      detach from the standard input and standard output after it is ready
      to receive connections on any of its devices.
     </p></dd></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.gen_opts.basic"></a>12.2.1. Basic Virtual Hardware<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.gen_opts.basic">¶</a></span></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-M <em class="replaceable"><code>machine_type</code></em></code>
     </span></dt><dd><p>
       Specifies the type of the emulated machine. Run <span class="command"><strong>qemu-kvm -M
       ?</strong></span> to view a list of supported machine types.
      </p><pre class="screen">tux@venus:~&gt; qemu-kvm -M ?
Supported machines are:
pc         Standard PC (alias of pc-0.12)
pc-0.12    Standard PC (default)
pc-0.11    Standard PC, qemu 0.11
pc-0.10    Standard PC, qemu 0.10
isapc      ISA-only PC
</pre><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
        Currently, SUSE supports only <code class="literal">pc-0.12</code> and
        <code class="literal">pc-0.14</code>machine types.
       </p></td></tr></table></div></dd><dt><span class="term"><code class="literal">-m <em class="replaceable"><code>megabytes</code></em></code>
     </span></dt><dd><p>
       Specifies how many megabytes are used for the virtual RAM size.
       Default is 512 MB.
      </p></dd><dt><span class="term"><code class="literal">-balloon virtio</code>
     </span></dt><dd><p>
       Specifies a paravirtualized device to dynamically change the amount
       of virtual RAM memory assigned to VM Guest. The top limit is the
       amount of memory specified with <code class="literal">-m</code>.
      </p></dd><dt><span class="term"><code class="literal">-cpu <em class="replaceable"><code>cpu_model</code></em></code>
     </span></dt><dd><p>
       Specifies the type of the processor (CPU) model. Run
       <span class="command"><strong>qemu-kvm -cpu ?</strong></span> to view a list of supported CPU
       models.
      </p><pre class="screen">tux@venus:~&gt; qemu-kvm -cpu ?
x86           qemu64
x86           phenom
x86         core2duo
x86            kvm64
x86           qemu32
x86          coreduo
x86              486
x86          pentium
x86         pentium2
x86         pentium3
x86           athlon
x86             n270</pre></dd><dt><span class="term"><code class="literal">-smp <em class="replaceable"><code>number_of_cpus</code></em></code>
     </span></dt><dd><p>
       Specifies how many CPUs will be emulated. QEMU supports up to 255
       CPUs on the PC platform (up to 64 with KVM acceleration used). This
       option also takes other CPU-related parameters, such as number of
       <span class="emphasis"><em>sockets</em></span>, number of <span class="emphasis"><em>cores</em></span>
       per socket, or number of <span class="emphasis"><em>threads</em></span> per core.
      </p></dd></dl></div><p>
    Following is an example of a working <span class="command"><strong>qemu-kvm</strong></span> command
    line:
   </p><pre class="screen">qemu-kvm -name "SLES 11 SP1" -M pc-0.12 -m 512 -cpu kvm64 \
-smp 2 /images/sles11sp1.raw</pre><div class="figure"><a id="id725720"></a><p class="title"><strong>Figure 12.1. QEMU Window with SLES 11 SP1 as VM Guest</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="70%"><tr><td><img src="images/qemu_win_sles.png" width="100%" alt="QEMU Window with SLES 11 SP1 as VM Guest" /></td></tr></table></div></div></div><br class="figure-break" /><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-no-acpi</code>
     </span></dt><dd><p>
       Disables ACPI support. Try to use it if VM Guest reports problems
       with ACPI interface.
      </p></dd><dt><span class="term"><code class="literal">-S</code>
     </span></dt><dd><p>
       QEMU starts with CPU stopped. To start CPU, enter
       <code class="literal">c</code> in QEMU monitor. For more information, see
       <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a>.
      </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.gen_opts.storing_cong"></a>12.2.2. Storing and Reading Configuration of Virtual Devices<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.gen_opts.storing_cong">¶</a></span></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-readconfig <em class="replaceable"><code>cfg_file</code></em></code>
     </span></dt><dd><p>
       Instead of entering the devices configuration options on the command
       line each time you want to run VM Guest, <span class="command"><strong>qemu-kvm</strong></span>
       can read it from a file which was either previously saved with
       <code class="literal">-writeconfig</code> or edited manually.
      </p></dd><dt><span class="term"><code class="literal">-writeconfig <em class="replaceable"><code>cfg_file</code></em></code>
     </span></dt><dd><p>
       Dumps the current virtual machine devices configuration to a text
       file. It can be consequently re-used with the
       <code class="literal">-readconfig</code> option.
      </p><pre class="screen">tux@venus:~&gt; qemu-kvm -name "SLES 11 SP1" -M pc-0.12 -m 512 -cpu kvm64 \
-smp 2 /images/sles11sp1.raw -writeconfig /images/sles11sp1.cfg
(exited)
tux@venus:~&gt; more /images/sles11sp1.cfg
# qemu config file

[drive]
  index = "0"
  media = "disk"
  file = "/images/sles11sp1_base.raw"</pre><p>
       This way you can effectively manage the configuration of your virtual
       machines' devices in a well-arranged way.
      </p></dd></dl></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.gen_opts.rtc"></a>12.2.3. Guest Real-time Clock<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.gen_opts.rtc">¶</a></span></h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-rtc <em class="replaceable"><code>options</code></em></code>
     </span></dt><dd><p>
       Specifies the way the RTC is handled inside a VM Guest. By default,
       the clock of the guest is derived from that of the host system.
       Therefore, it is recommended that the host system clock is
       synchronized with an accurate external clock (for example, via NTP
       service).
      </p><p>
       If you need to isolate the VM Guest clock from the host one, specify
       <code class="literal">clock=vm</code> instead of the default
       <code class="literal">clock=host</code>.
      </p><p>
       You can also specify a 'starting point' for VM Guest clock with the
       <code class="literal">base</code> option:
      </p><pre class="screen">qemu-kvm [...] -rtc clock=vm,base=2010-12-03T01:02:00</pre><p>
       Instead of a timestamp, you can specify <code class="literal">utc</code> or
       <code class="literal">localtime</code>. The former instructs VM Guest to start
       at the current UTC value (Coordinated Universal Time, see
       <a class="ulink" href="http://en.wikipedia.org/wiki/UTC" target="_top">http://en.wikipedia.org/wiki/UTC</a>), while the latter
       applies the local time setting.
      </p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.running.devices"></a>12.3. Using Devices in QEMU<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices">¶</a></span></h2></div></div></div><p>
   QEMU virtual machines emulate all devices needed to run a VM Guest.
   QEMU supports, for example, several types of network cards, block
   devices (hard and removable drives), USB devices, character devices
   (serial and parallel ports), or multimedia devices (graphic and sound
   cards). For satisfactory operation and performance of the virtual
   machine, some or all of these devices must be configured correctly. This
   section introduces options to configure various types of supported
   devices.
  </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.devices.block"></a>12.3.1. Block Devices<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.block">¶</a></span></h3></div></div></div><p>
    Block devices are vital for virtual machines. In general, these are
    fixed or removable storage media usually referred to as 'drives'. One of
    the connected hard drives typically holds the guest operating system to
    be virtualized.
   </p><p>
    Virtual machine drives are defined with <code class="literal">-drive</code>. This
    option uses many suboptions, some of which are described in this
    section. For their complete list, see the manual page (<code class="literal">man 1
    qemu-kvm</code>).
   </p><div class="variablelist"><p class="title"><strong>Sub-options for the <code class="literal">-drive</code> Option</strong></p><dl class="variablelist"><dt><span class="term"><code class="literal">file=image_fname</code>
     </span></dt><dd><p>
       Specifies the path to the disk image which will be used with this
       drive. If not specified, an empty (removable) drive is assumed.
      </p></dd><dt><span class="term"><code class="literal">if=drive_interface</code>
     </span></dt><dd><p>
       Specifies the type of interface to which the drive is connected.
       Currently only <code class="literal">floppy</code>, <code class="literal">ide</code>, or
       <code class="literal">virtio</code> are supported by SUSE.
       <code class="literal">virtio</code> defines a paravirtualized disk driver.
       Default is <code class="literal">ide</code>.
      </p></dd><dt><span class="term"><code class="literal">index=index_of_connector</code>
     </span></dt><dd><p>
       Specifies the index number of a connector on the disk interface (see
       the <code class="literal">if</code> option) where the drive is connected. If
       not specified, the index is automatically incremented.
      </p></dd><dt><span class="term"><code class="literal">media=type</code>
     </span></dt><dd><p>
       Specifies the type of the media. Can be <code class="literal">disk</code> for
       hard disks, or <code class="literal">cdrom</code> for removable CD-ROM drives.
      </p></dd><dt><span class="term"><code class="literal">format=img_fmt</code>
     </span></dt><dd><p>
       Specifies the format of the connected disk image. If not specified,
       the format is autodetected. Currently, SUSE supports
       <code class="literal">qcow2</code>, <code class="literal">qed</code> and
       <code class="literal">raw</code> formats.
      </p></dd><dt><span class="term"><code class="literal">cache=method</code>
     </span></dt><dd><p>
       Specifies the caching method for the drive. Possible values are
       <code class="literal">unsafe</code>, <code class="literal">writethrough</code>,
       <code class="literal">writeback</code>, or <code class="literal">none</code>. For the
       <code class="literal">qcow2</code> image format, choose
       <code class="literal">writeback</code> if you care about performance.
       <code class="literal">none</code> disables the host page cache and, therefore,
       is the safest option. Default is <code class="literal">writethrough</code>.
      </p></dd></dl></div><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     To simplify defining of block devices, QEMU understands several
     shortcuts which you may find handy when entering the
     <code class="literal">qemu-kvm</code> command line.
    </p><p>
     You can use
    </p><pre class="screen">qemu-kvm -cdrom /images/cdrom.iso</pre><p>
     instead of
    </p><pre class="screen">qemu-kvm -drive file=/images/cdrom.iso,index=2,media=cdrom</pre><p>
     and
    </p><pre class="screen">qemu-kvm -hda /images/imagei1.raw -hdb /images/image2.raw -hdc \
/images/image3.raw -hdd /images/image4.raw</pre><p>
     instead of
    </p><pre class="screen">qemu-kvm -drive file=/images/image1.raw,index=0,media=disk \
-drive file=/images/image2.raw,index=1,media=disk \
-drive file=/images/image3.raw,index=2,media=disk \
-drive file=/images/image4.raw,index=3,media=disk</pre></td></tr></table></div><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip: Using Host Drives Instead of Images"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left">Using Host Drives Instead of Images</th></tr><tr><td colspan="2" align="left" valign="top"><p>
     Normally you will use disk images (see
     <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img" title="11.2. Managing Disk Images with qemu-img">Section 11.2, “Managing Disk Images with <span class="command"><strong>qemu-img</strong></span>”</a>) as disk drives of
     the virtual machine. However, you can also use existing VM Host Server disks,
     connect them as drives, and access them from VM Guest. Use the host
     disk device directly instead of disk image filenames.
    </p><p>
     To access the host CD-ROM drive, use
    </p><pre class="screen">qemu-kvm [...] -drive file=/dev/cdrom,media=cdrom</pre><p>
     To access the host hard disk, use
    </p><pre class="screen">qemu-kvm [...] -drive file=/dev/hdb,media=disk</pre><p>
     When accessing the host hard drive from VM Guest, always make sure the
     access is <span class="emphasis"><em>read-only</em></span>. You can do so by modifying
     the host device permissions.
    </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.devices.graphic"></a>12.3.2. Graphic Devices and Display Options<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.graphic">¶</a></span></h3></div></div></div><p>
    This section describes QEMU options affecting the type of the emulated
    video card and the way VM Guest graphical output is displayed.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.running.devices.graphic.vga"></a>12.3.2.1. Defining Video Cards<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.graphic.vga">¶</a></span></h4></div></div></div><p>
     QEMU uses <code class="literal">-vga</code> to define a video card used to
     display VM Guest graphical output. The <code class="literal">-vga</code> option
     understands the following values:
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">none</code>
      </span></dt><dd><p>
        Disables video cards on VM Guest (no video card is emulated). You
        can still access the running VM Guest via the QEMU monitor and
        the serial console.
       </p></dd><dt><span class="term"><code class="literal">std</code>
      </span></dt><dd><p>
        Emulates a standard VESA 2.0 VBE video card. Use it if you intend to
        use high display resolution on VM Guest.
       </p></dd><dt><span class="term"><code class="literal">cirrus</code>
      </span></dt><dd><p>
        Emulates Cirrus Logic GD5446 video card. Good choice if you insist
        on high compatibility of the emulated video hardware. Most operating
        systems (even Windows 95) recognize this type of card.
       </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
         For best video performance with the <code class="literal">cirrus</code> type,
         use 16-bit color depth both on VM Guest and VM Host Server.
        </p></td></tr></table></div></dd></dl></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.running.devices.graphic.display"></a>12.3.2.2. Display Options<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.graphic.display">¶</a></span></h4></div></div></div><p>
     The following options affect the way VM Guest graphical output is
     displayed.
    </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-nographic</code>
      </span></dt><dd><p>
        Disables QEMU's graphical output. The emulated serial port is
        redirected to the console.
       </p><p>
        After starting the virtual machine with
        <code class="literal">-nographic</code>, press
        <span class="keycap">Ctrl</span>+<span class="keycap">A</span>
        <span class="keycap">H</span> in the virtual console to view the list of other
        useful shortcuts, for example, to toggle between the console and the
        QEMU monitor.
       </p><pre class="screen">tux@venus:~&gt; qemu-kvm -hda /images/sles11sp1_base.raw -nographic

C-a h    print this help
C-a x    exit emulator
C-a s    save disk data back to file (if -snapshot)
C-a t    toggle console timestamps
C-a b    send break (magic sysrq)
C-a c    switch between console and monitor
C-a C-a  sends C-a
(pressed C-a c)

QEMU 0.12.5 monitor - type 'help' for more information
(qemu)</pre></dd><dt><span class="term"><code class="literal">-no-frame</code>
      </span></dt><dd><p>
        Disables decorations for the QEMU window. Convenient for dedicated
        desktop workspace.
       </p></dd><dt><span class="term"><code class="literal">-full-screen</code>
      </span></dt><dd><p>
        Starts QEMU graphical output in full screen mode.
       </p></dd><dt><span class="term"><code class="literal">-no-quit</code>
      </span></dt><dd><p>
        Disables the 'close' button of QEMU window and prevents it from
        being closed by force.
       </p></dd><dt><span class="term"><code class="literal">-alt-grab, -ctrl-grab</code>
      </span></dt><dd><p>
        By default QEMU window releases the 'captured' mouse after
        <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span> is
        pressed. You can change the key combination to either
        <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span>+<span class="keycap">Shift</span>
        (<code class="literal">-alt-grab</code>), or <span class="keycap">Right Ctrl</span>
        (<code class="literal">-ctrl-grab</code>).
       </p></dd></dl></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.devices.usb"></a>12.3.3. USB Devices<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.usb">¶</a></span></h3></div></div></div><p>
    There are basically two ways to create USB devices usable by the
    VM Guest in KVM: you can either emulate new USB devices inside a
    VM Guest, or assign an existing host USB device to a VM Guest. To use
    USB devices in QEMU you first need to enable the generic USB driver
    with the <code class="option">-usb</code> option. Then you can specify individual
    devices with the <code class="option">-usbdevice</code> option.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="kvm.usb.emulate"></a>12.3.3.1. Emulating USB Devices in VM Guest<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.usb.emulate">¶</a></span></h4></div></div></div><p>
     Although QEMU supports much more types of USB devices, SUSE
     currently only supports the types <code class="literal">mouse</code> and
     <code class="literal">tablet</code>.
    </p><div class="variablelist"><p class="title"><strong>Types of USB devices for the <code class="literal">-usbdevice</code> Option</strong></p><dl class="variablelist"><dt><span class="term"><code class="literal">mouse</code>
      </span></dt><dd><p>
        Emulates a virtual USB mouse. This option overrides the default PS/2
        mouse emulation. The following example shows the hardware status of
        a mouse on VM Guest started with <code class="literal">qemu-kvm [...] -usbdevice
        mouse</code>:
       </p><pre class="screen">tux@venus:~&gt; hwinfo --mouse
20: USB 00.0: 10503 USB Mouse
[Created at usb.122]
UDI: /org/freedesktop/Hal/devices/usb_device_627_1_1_if0
[...]
Hardware Class: mouse
Model: "Adomax QEMU USB Mouse"
Hotplug: USB
Vendor: usb 0x0627 "Adomax Technology Co., Ltd"
Device: usb 0x0001 "QEMU USB Mouse"
[...]</pre></dd><dt><span class="term"><code class="literal">tablet</code>
      </span></dt><dd><p>
        Emulates a pointer device that uses absolute coordinates (such as
        touchscreen). This option overrides the default PS/2 mouse
        emulation. The tablet device is useful if you are viewing VM Guest
        via the VNC protocol. See <a class="xref" href="opensuse-kvm.html#cha.qemu.running.vnc" title="12.5. Viewing a VM Guest with VNC">Section 12.5, “Viewing a VM Guest with VNC”</a> for
        more information.
       </p></dd></dl></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="kvm.usb.passthru"></a>12.3.3.2. USB Pass-Through<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.usb.passthru">¶</a></span></h4></div></div></div><p>
     To assign an existing host USB device to a VM Guest, you need to find
     out its host bus and device ID.
    </p><pre class="screen">tux@vmhost:~&gt; lsusb
[...]
Bus 002 Device 005: ID 12d1:1406 Huawei Technologies Co., Ltd. E1750
[...]</pre><p>
     In the above example, we want to assign a USB stick connected to the
     host's USB bus number 2 with device number 5. Now run the VM Guest
     with the following additional options:
    </p><pre class="screen">qemu-kvm [...] -usb -device usb-host,hostbus=2,hostaddr=5</pre><p>
     After the guest is booted, check that the assigned USB device is
     present on it.
    </p><pre class="screen">tux@vmguest:~&gt; lsusb
[...]
Bus 001 Device 002: ID 12d1:1406 Huawei Technologies Co., Ltd. E1750
[...]</pre><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
      The guest operating system must take care of mounting the assigned USB
      device so that it is accessible for the user.
     </p></td></tr></table></div></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="kvm.pciback"></a>12.3.4. PCI Pass-Through<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.pciback">¶</a></span></h3></div></div></div><p>
    PCI Pass-Through is a technique to give your VM Guest exclusive access to a
    PCI device.
   </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     To make use of PCI Pass-Through, your motherboard chipset, BIOS, and CPU must
     have support for AMD's IOMMU (or VT-d in Intel speak) virtualization
     technology. To make sure that your computer supports this feature, ask
     your supplier specifically to deliver a system that supports PCI Pass-Through.
    </p></td></tr></table></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     Assignment of graphics cards is not supported by SUSE.
    </p></td></tr></table></div><div class="procedure"><a id="id726766"></a><p class="title"><strong>Procedure 12.1. Configuring PCI Pass-Through</strong></p><ol class="procedure" type="1"><li><p>
      Make sure that <code class="literal">CONFIG_DMAR_DEFAULT_ON</code> is set in the
      host's running Kernel:
     </p><pre class="screen">grep CONFIG_DMAR_DEFAULT_ON /boot/config-`uname -r`</pre><p>
      If this option is not set, edit your boot loader configuration and add
      <code class="literal">intel_iommu=on</code> (Intel machines) or
      <code class="literal">iommu=pt iommu=1</code> (AMD machines). Then reboot the
      host machine.
     </p></li><li><p>
      Check that IOMMU is actively enabled and recognized on the host. Run
      <span class="command"><strong>dmesg | grep -e DMAR -e IOMMU</strong></span> on Intel machines, or
      <span class="command"><strong>dmesg | grep AMD-Vi</strong></span> on AMD machines. If you get no
      output, check carefully if your hardware supports IOMMU (VT-d) and
      check that it has been enabled in BIOS.
     </p></li><li><p>
      Identify the host PCI device to assign to the guest.
     </p><pre class="screen">tux@vmhost:~&gt; lspci -nn
[...] 00:1b.0 Audio device [0403]: Intel Corporation 82801H (ICH8 Family) \
HD Audio Controller [8086:284b] (rev 02) [...]</pre><p>
      Note down the device (<code class="literal">00:1b.0</code>) and vendor
      (<code class="literal">8086:284b</code>) ID.
     </p></li><li><p>
      Unbind the device from host Kernel driver and bind it to the PCI stub
      driver.
     </p><pre class="screen">tux@vmhost:~&gt; modprobe pci_stub
tux@vmhost:~&gt; echo "8086 284b" &gt; /sys/bus/pci/drivers/pci-stub/new_id
tux@vmhost:~&gt; echo "0000:00:1b.0" &gt; /sys/bus/pci/devices/0000:00:1b.0/driver/unbind
tux@vmhost:~&gt; echo "0000:00:1b.0" &gt; /sys/bus/pci/drivers/pci-stub/bind</pre></li><li><p>
      Now run the VM Guest with the PCI device assigned.
     </p><pre class="screen">qemu-kvm [...] -device pci-assign,host=00:1b.0</pre></li></ol></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     If the PCI device shares IRQ with other devices, it cannot be assigned
     to a VM Guest.
    </p></td></tr></table></div><p>
    KVM also supports PCI device hotplugging to a VM Guest. To achieve
    this, you need to switch to a QEMU monitor (see
    <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a> for more information) and issue
    the following commands:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
      hot add:
     </p><pre class="screen">device_add pci-assign,host=00:1b.0,id=new_pci_device</pre></li><li class="listitem" style="list-style-type: disc"><p>
      hot remove:
     </p><pre class="screen">device_del new_pci_device</pre></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.devices.char"></a>12.3.5. Character Devices<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.devices.char">¶</a></span></h3></div></div></div><p>
    Use <code class="literal">-chardev</code> to create a new character device. The
    option uses the following general syntax:
   </p><pre class="screen">qemu-kvm [...] -chardev <em class="replaceable"><code>backend_type</code></em>,id=<em class="replaceable"><code>id_string</code></em></pre><p>
    where <em class="replaceable"><code>backend_type</code></em> can be one of
    <code class="literal">null</code>, <code class="literal">socket</code>,
    <code class="literal">udp</code>, <code class="literal">msmouse</code>,
    <code class="literal">vc</code>, <code class="literal">file</code>, <code class="literal">pipe</code>,
    <code class="literal">console</code>, <code class="literal">serial</code>,
    <code class="literal">pty</code>, <code class="literal">stdio</code>,
    <code class="literal">braille</code>, <code class="literal">tty</code>, or
    <code class="literal">parport</code>. All character devices must have a unique
    identification string up to 127 characters long. It is used to identify
    the device in other related directives. For the complete description of
    all backend's suboptions, see the manual page (<span class="command"><strong>man 1
    qemu-kvm</strong></span>). A brief description of the available
    <code class="literal">backends</code> follows:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">null</code>
     </span></dt><dd><p>
       Creates an empty device which outputs no data and drops any data it
       receives.
      </p></dd><dt><span class="term"><code class="literal">stdio</code>
     </span></dt><dd><p>
       Connects to QEMU's process standard input and standard output.
      </p></dd><dt><span class="term"><code class="literal">socket</code>
     </span></dt><dd><p>
       Creates a two-way stream socket. If <em class="replaceable"><code>path</code></em>
       is specified, a Unix socket is created:
      </p><pre class="screen">qemu-kvm [...] -chardev \
socket,id=unix_socket1,path=/tmp/unix_socket1,server</pre><p>
       The <em class="replaceable"><code>server</code></em> suboption specifies that the
       socket is a listening socket.
      </p><p>
       If <em class="replaceable"><code>port</code></em> is specified, a TCP socket is
       created:
      </p><pre class="screen">qemu-kvm [...] -chardev \
socket,id=tcp_socket1,host=localhost,port=7777,server,nowait</pre><p>
       The command creates a local listening (<code class="literal">server</code>) TCP
       socket on port 7777. QEMU will not block waiting for a client to
       connect to the listening port (<code class="literal">nowait</code>).
      </p></dd><dt><span class="term"><code class="literal">udp</code>
     </span></dt><dd><p>
       Sends all network traffic from VM Guest to a remote host over the
       UDP protocol.
      </p><pre class="screen">qemu-kvm [...] -chardev udp,id=udp_fwd,host=mercury.example.com,port=7777</pre><p>
       The command binds port 7777 on the remote host mercury.example.com and sends
       VM Guest network traffic there.
      </p></dd><dt><span class="term"><code class="literal">vc</code>
     </span></dt><dd><p>
       Creates a new QEMU text console. You can optionally specify the
       dimensions of the virtual console:
      </p><pre class="screen">qemu-kvm [...] -chardev vc,id=vc1,width=640,height=480 -mon chardev=vc1</pre><p>
       The command creates a new virtual console called
       <code class="literal">vc1</code> of the specified size, and connects the QEMU
       monitor to it.
      </p></dd><dt><span class="term"><code class="literal">file</code>
     </span></dt><dd><p>
       Logs all traffic from VM Guest to a file on VM Host Server. The
       <code class="literal">path</code> is required and will be created if it does
       not exist.
      </p><pre class="screen">qemu-kvm [...] -chardev file,id=qemu_log1,path=/var/log/qemu/guest1.log</pre></dd></dl></div><p>
    By default QEMU creates a set of character devices for serial and
    parallel ports, and a special console for QEMU monitor. You can,
    however, create your own character devices and use them for just
    mentioned purposes. The following options will help you:
   </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">-serial <em class="replaceable"><code>char_dev</code></em></code>
     </span></dt><dd><p>
       Redirects the VM Guest's virtual serial port to a character device
       <em class="replaceable"><code>char_dev</code></em> on VM Host Server. By default, it is a
       virtual console (<code class="literal">vc</code>) in graphical mode, and
       <code class="literal">stdio</code> in non-graphical mode. The
       <code class="literal">-serial</code> understands many suboptions. See the
       manual page <span class="command"><strong>man 1 qemu-kvm</strong></span> for their complete
       list.
      </p><p>
       You can emulate up to 4 serial ports. Use <code class="literal">-serial
       none</code> to disable all serial ports.
      </p></dd><dt><span class="term"><code class="literal">-parallel <em class="replaceable"><code>device</code></em></code>
     </span></dt><dd><p>
       Redirects the VM Guest's parallel port to a
       <em class="replaceable"><code>device</code></em>. This option supports the same
       devices as <code class="literal">-serial</code>.
      </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
        With <span class="phrase">openSUSE or</span> SUSE Linux Enterprise Server as a VM Host Server,
        you can directly use the hardware parallel port devices
        <code class="filename">/dev/parportN</code> where <code class="literal">N</code> is the
        number of the port.
       </p></td></tr></table></div><p>
       You can emulate up to 3 parallel ports. Use <code class="literal">-parallel
       none</code> to disable all parallel ports.
      </p></dd><dt><span class="term"><code class="literal">-monitor <em class="replaceable"><code>char_dev</code></em></code>
     </span></dt><dd><p>
       Redirects the QEMU monitor to a character device
       <em class="replaceable"><code>char_dev</code></em> on VM Host Server. This option supports
       the same devices as <code class="literal">-serial</code>. By default, it is a
       virtual console (<code class="literal">vc</code>) in a graphical mode, and
       <code class="literal">stdio</code> in non-graphical mode.
      </p></dd></dl></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.running.networking"></a>12.4. Networking in QEMU<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.networking">¶</a></span></h2></div></div></div><p>
   Use the <code class="literal">-net</code> option to define a network interface and
   a specific type of networking for your VM Guest. Currently, SUSE
   supports the following options: <code class="literal">none</code>,
   <code class="literal">nic</code>, <code class="literal">user</code>, and
   <code class="literal">tap</code>. For a complete list of <code class="literal">-net</code>
   suboptions, see the manual page (<span class="command"><strong>man 1 qemu-kvm</strong></span>).
  </p><div class="variablelist"><p class="title"><strong>Supported <code class="literal">-net</code> Suboptions</strong></p><dl class="variablelist"><dt><span class="term"><code class="literal">none</code>
    </span></dt><dd><p>
      Disables a network card emulation on VM Guest. Only the loopback
      <code class="literal">lo</code> network interface is available.
     </p></dd><dt><span class="term"><code class="literal">nic</code>
    </span></dt><dd><p>
      Creates a new Network Interface Card (NIC) and connects it to a
      specified Virtual Local Area Network (VLAN). For more information, see
      <a class="xref" href="opensuse-kvm.html#cha.qemu.running.networking.nic" title="12.4.1. Defining a Network Interface Card">Section 12.4.1, “Defining a Network Interface Card”</a>
     </p></dd><dt><span class="term"><code class="literal">user</code>
    </span></dt><dd><p>
      Specifies a user-mode networking. For more information , see
      <a class="xref" href="opensuse-kvm.html#cha.qemu.running.networking.usermode" title="12.4.2. User-mode Networking">Section 12.4.2, “User-mode Networking”</a>.
     </p></dd><dt><span class="term"><code class="literal">tap</code>
    </span></dt><dd><p>
      Specifies a bridged or routed networking. For more information, see
      <a class="xref" href="opensuse-kvm.html#cha.qemu.running.networking.bridge" title="12.4.3. Bridged Networking">Section 12.4.3, “Bridged Networking”</a>.
     </p></dd></dl></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.networking.nic"></a>12.4.1. Defining a Network Interface Card<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.networking.nic">¶</a></span></h3></div></div></div><p>
    Use <code class="literal">-net nic</code> to add a new emulated network card:
   </p><pre class="screen">qemu-kvm [...] -net nic,vlan=1<a id="co.qemu.running.networking.nic.vlan"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>,macaddr=00:16:35:AF:94:4B<a id="co.qemu.running.networking.nic.mac"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>,\
model=virtio<a id="co.qemu.running.networking.nic.model"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>,name=ncard1<a id="co.qemu.running.networking.nic.name"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.running.networking.nic.vlan"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Connects the network interface to VLAN number 1. You can specify your
      own number, it is mainly useful for identification purpose. If you
      omit this suboption, QEMU uses the default 0.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.running.networking.nic.mac"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Specifies the Media Access Control (MAC) address for the network card.
      It is a unique identifier and you are advised to always specify it. If
      not, QEMU supplies its own default MAC address and creates a
      possible MAC address conflict within the related VLAN.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.running.networking.nic.model"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Specifies the model of the network card. Use <code class="literal">-net
      nic,model=?</code> to get the list of all network card models
      supported by QEMU on your platform:
     </p><p>
      Currently, SUSE supports the models <code class="literal">rtl8139</code> and
      <code class="literal">virtio</code>.
     </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.networking.usermode"></a>12.4.2. User-mode Networking<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.networking.usermode">¶</a></span></h3></div></div></div><p>
    The <code class="literal">-net user</code> option instructs QEMU to use a
    user-mode networking. This is the default if no networking mode is
    selected. Therefore, these command lines are equivalent:
   </p><pre class="screen">qemu-kvm -hda /images/sles11sp1_base.raw</pre><pre class="screen">qemu-kvm -hda /images/sles11sp1_base.raw -net nic -net user</pre><p>
    This mode is useful if you want to allow the VM Guest to access the
    external network resources, such as Internet. By default, no incoming
    traffic is permitted and therefore, the VM Guest is not visible to
    other machines on the network. No administrator privileges are required
    in this networking mode. The user-mode is also useful to do a
    'network-booting' on your VM Guest from a local directory on VM Host Server.
   </p><p>
    The VM Guest allocates an IP address from a virtual DHCP server.
    VM Host Server (the DHCP server) is reachable at 10.0.2.2, while the IP
    address range for allocation starts from 10.0.2.15. You can use
    <span class="command"><strong>ssh</strong></span> to connect to VM Host Server at 10.0.2.2, and
    <span class="command"><strong>scp</strong></span> to copy files back and forth.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="cha.qemu.running.networking.usermode.examples"></a>12.4.2.1. Command Line Examples<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.networking.usermode.examples">¶</a></span></h4></div></div></div><p>
     This section shows several examples on how to set up user-mode
     networking with QEMU.
    </p><div class="example"><a id="ex.qemu.net.usermode.resctrict"></a><p class="title"><strong>Example 12.1. Restricted User-mode Networking</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.qemu.net.usermode.resctrict">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -net user<a id="co.usermode.user"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>,vlan=1<a id="co.usermode.vlan"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>,name=user_net1<a id="co.usermode.name"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>,restrict=yes<a id="co.usermode.restrict"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.user"><span><img src="static/images/callouts/1.png" alt="1" 
border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies user-mode networking.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.vlan"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Connect to VLAN number 1. If omitted, defaults to 0.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.name"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies a human readable name of the network stack. Useful when
        identifying it in the QEMU monitor.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.restrict"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Isolates VM Guest. It will not be able to communicate with VM Host Server
        and no network packets will be routed to the external network.
       </p></td></tr></table></div></div></div><br class="example-break" /><div class="example"><a id="ex.qemu.net.usermode.iprange"></a><p class="title"><strong>Example 12.2. User-mode Networking with Custom IP Range</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.qemu.net.usermode.iprange">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -net user,net=10.2.0.0/8<a id="co.usermode.net"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>,host=10.2.0.6<a id="co.usermode.host"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>,dhcpstart=10.2.0.20<a id="co.usermode.dhcpstart"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>,\
hostname=tux_kvm_guest<a id="co.usermode.hostname"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.net"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies the IP address of the network that VM Guest sees and
        optionally the netmask. Default is 10.0.2.0/8.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.host"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies the VM Host Server IP address that VM Guest sees. Default is
        10.0.2.2.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.dhcpstart"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies the first of the 16 IP addresses that the built-in DHCP
        server can assign to VM Guest. Default is 10.0.2.15.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.hostname"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Specifies the hostname that the built-in DHCP server will assign to
        VM Guest.
       </p></td></tr></table></div></div></div><br class="example-break" /><div class="example"><a id="ex.qemu.net.usermode.netboot_tftp"></a><p class="title"><strong>Example 12.3. User-mode Networking with Network-boot and TFTP</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.qemu.net.usermode.netboot_tftp">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -net user,tftp=/images/tftp_dir<a id="co.usermode.tftp"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>,bootfile=/images/boot/pxelinux.0<a id="co.usermode.bootfile"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.tftp"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Activates a built-in TFTP (a file transfer protocol with the
        functionality of a very basic FTP) server. The files in the
        specified directory will be visible to a VM Guest as the root of a
        TFTP server.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.usermode.bootfile"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Broadcasts the specified file as a BOOTP (a network protocol which
        offers an IP address and a network location of a boot image, often
        used in diskless workstations) file. When used together with
        <code class="literal">tftp</code>, the VM Guest can boot from network from
        the local directory on the host.
       </p></td></tr></table></div></div></div><br class="example-break" /><div class="example"><a id="ex.qemu.net.usermode.hostfwd"></a><p class="title"><strong>Example 12.4. User-mode Networking with Host Port Forwarding</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.qemu.net.usermode.hostfwd">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -net user,hostfwd=tcp::2222-:22</pre><p>
      Forwards incoming TCP connections to the port 2222 on the host to the
      port 22 (<code class="systemitem">SSH</code>) on VM Guest.
      If <code class="systemitem">sshd</code> is running on
      VM Guest, enter
     </p><pre class="screen">ssh qemu_host -p 2222</pre><p>
      where <code class="literal">qemu_host</code> is the hostname or IP address of
      the host system, to get a <code class="systemitem">SSH</code>
      prompt from VM Guest.
     </p></div></div><br class="example-break" /></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.networking.bridge"></a>12.4.3. Bridged Networking<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.networking.bridge">¶</a></span></h3></div></div></div><p>
    With the <code class="literal">-net tap</code> option, QEMU creates a network
    bridge by connecting the host TAP network device to a specified VLAN of
    VM Guest. Its network interface is then visible to the rest of the
    network. This method does not work by default and has to be explicitly
    specified.
   </p><p>
    First, create a network bridge and add a VM Host Server physical network
    interface (usually <code class="literal">eth0</code>) to it:
   </p><div class="procedure"><ol class="procedure" type="1"><li><p>
      Start YaST Control Center and select <span class="guimenu">Network
      Devices</span>+<span class="guimenu">Network Settings</span>.
     </p></li><li><p>
      Click <span class="guimenu">Add</span> and select <span class="guimenu">Bridge</span> from
      the <span class="guimenu">Device Type</span> drop-down list in the
      <span class="guimenu">Hardware Dialog</span> window. Click
      <span class="guimenu">Next</span>.
     </p></li><li><p>
      Choose whether you need a dynamically or statically assigned IP
      address, and fill the related network settings if applicable.
     </p></li><li><p>
      In the <span class="guimenu">Bridged Devices</span> pane, select the Ethernet
      device to add to the bridge.
     </p><div class="figure"><a id="id728040"></a><p class="title"><strong>Figure 12.2. Configuring Network Bridge with YaST</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="70%"><tr><td><img src="images/qemu_yast_bridge_eth0.png" width="100%" alt="Configuring Network Bridge with YaST" /></td></tr></table></div></div></div><br class="figure-break" /><p>
      Click <span class="guimenu">Next</span>. When asked about adapting an already
      configured device, click <span class="guimenu">Continue</span>.
     </p></li><li><p>
      Click <span class="guimenu">OK</span> to apply the changes. Check if the bridge
      is created:
     </p><pre class="screen">tux@venus:~&gt; brctl show
bridge name bridge id          STP enabled  interfaces
br0         8000.001676d670e4  no           eth0</pre></li></ol></div><p>
    Use the following example script to connect VM Guest to the newly
    created bridge interface <code class="literal">br0</code>. Several commands in the
    script are run via the <span class="command"><strong>sudo</strong></span> mechanism because they
    require <code class="systemitem">root</code> privileges.
   </p><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
     Make sure the <code class="systemitem">tunctl</code> and
     <code class="systemitem">bridge-utils</code> packages are installed on the
     VM Host Server. If not, install them with <span class="command"><strong>zypper in tunctl
     bridge-utils</strong></span>.
    </p></td></tr></table></div><pre class="screen">
#!/bin/bash
bridge=br0<a id="co.qemu.net.bridge.br"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>
tap=$(sudo tunctl -u $(whoami) -b)<a id="co.qemu.net.bridge.tap"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>
sudo ip link set $tap up<a id="co.qemu.net.bridge.up"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>
sleep 1s<a id="co.qemu.net.bridge.sleep"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a>
sudo brctl addif $bridge $tap<a id="co.qemu.net.bridge.br3"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a>
qemu-kvm -m 512 -hda /images/sles11sp1_base.raw \
-net nic,vlan=0,model=virtio,macaddr=00:16:35:AF:94:4B \
-net tap,vlan=0,ifname=$tap<a id="co.qemu.net.bridge.ifname"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a>,script=no<a id="co.qemu.net.bridge.script"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a>,downscript=no
sudo brctl delif $bridge $tap<a id="co.qemu.net.bridge.delif"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a>
sudo ip link set $tap down<a id="co.qemu.net.bridge.linkdown"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a>
sudo tunctl -d $tap<a id="co.qemu.net.bridge.deltap"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.br"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Name of the bridge device.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.tap"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Prepare a new TAP device and assign it to the user who runs the
      script. TAP devices are virtual network devices often used for
      virtualization and emulation setups.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.up"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Bring up the newly created TAP network interface.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.sleep"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Make a 1 second pause to make sure the new TAP network interface is
      really up.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.br3"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Add the new <code class="literal">TAP</code> device to the network bridge
      <code class="literal">br0</code>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.ifname"><span><img src="static/images/callouts/6.png" alt="6" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      The <code class="literal">ifname=</code> suboption specifies the name of the TAP
      network interface used for bridging.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.script"><span><img src="static/images/callouts/7.png" alt="7" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Before <span class="command"><strong>qemu-kvm</strong></span> connects to a network bridge, it
      checks the <code class="literal">script</code> and <code class="literal">downscript</code>
      values. If it finds the specified scripts on the VM Host Server filesystem,
      it runs the <code class="literal">script</code> before it connects to the
      network bridge and <code class="literal">downscript</code> after it exits the
      network environment. You can use these scripts to first set up and
      bring up the bridged network devices, and then to deconfigure them. By
      default, <code class="filename">/etc/qemu-ifup</code> and
      <code class="filename">/etc/qemu-ifdown</code> are examined. If
      <code class="literal">script=no</code> and <code class="literal">downscript=no</code> are
      specified, the script execution is disabled and you have to take care
      manually.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.delif"><span><img src="static/images/callouts/8.png" alt="8" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Deletes the TAP interface from a network bridge
      <code class="literal">br0</code>.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.linkdown"><span><img src="static/images/callouts/9.png" alt="9" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Sets the state of the TAP device to 'down'.
     </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu.net.bridge.deltap"><span><img src="static/images/callouts/10.png" alt="10" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
      Deconfigures the TAP device.
     </p></td></tr></table></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="kvm.qemu.vnet"></a>12.4.4. Accelerated Networking with <code class="systemitem">vhost-net</code><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.qemu.vnet">¶</a></span></h3></div></div></div><p>
    The <code class="systemitem">vhost-net</code> module is used to accelerate
    KVM's paravirtualized network drivers. It provides better latency and
    greater throughput for network.
   </p><p>
    To make use of the module, verify that the host's running Kernel has
    <code class="literal">CONFIG_VHOST_NET</code> turned on or enabled as a module:
   </p><pre class="screen">grep CONFIG_VHOST_NET /boot/config-`uname -r`</pre><p>
    Also verify that the guest's running Kernel has
    <code class="literal">CONFIG_PCI_MSI</code> enabled:
   </p><pre class="screen">grep CONFIG_PCI_MSI /boot/config-`uname -r`</pre><p>
    If both conditions are met, use the <code class="literal">vhost-net</code> driver
    by starting the guest with the following example command line:
   </p><pre class="screen">qemu-kvm [...] -netdev tap,id=guest0,vhost=on,script=no
-net nic,model=virtio,netdev=guest0,macaddr=00:16:35:AF:94:4B</pre><p>
    Note that <code class="literal">guest0</code> is an identification string of the
    vhost-driven device.
   </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="cha.qemu.running.vnc"></a>12.5. Viewing a VM Guest with VNC<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.vnc">¶</a></span></h2></div></div></div><p>
   QEMU normally uses an SDL (a cross-platform multimedia library) window
   to display the graphical output of a VM Guest. With the
   <code class="literal">-vnc</code> option specified, you can make QEMU listen on a
   specified VNC display and redirect its graphical output to the VNC
   session.
  </p><div class="tip"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Tip"><tr class="head"><td width="32"><img alt="[Tip]" src="static/images/tip.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    When working with QEMU's virtual machine via VNC session, it is useful
    to work with the <code class="literal">-usbdevice tablet</code> option.
   </p><p>
    Moreover, if you need to use another keyboard layout than the default
    <code class="literal">en-us</code>, specify it with the <code class="literal">-k</code>
    option.
   </p></td></tr></table></div><p>
   The first suboption of <code class="literal">-vnc</code> must be a
   <span class="emphasis"><em>display</em></span> value. The <code class="literal">-vnc</code> option
   understands the following display specifications:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><code class="literal">host:display</code>
    </span></dt><dd><p>
      Only connections from <code class="literal">host</code> on the display number
      <code class="literal">display</code> will be accepted. The TCP port on which the
      VNC session is then running is normally a 5900 +
      <code class="literal">display</code> number. If you do not specify
      <code class="literal">host</code>, connections will be accepted from any host.
     </p></dd><dt><span class="term"><code class="literal">unix:path</code>
    </span></dt><dd><p>
      The VNC server listens for connections on Unix domain sockets. The
      <code class="literal">path</code> option specifies the location of the related
      Unix socket.
     </p></dd><dt><span class="term"><code class="literal">none</code>
    </span></dt><dd><p>
      The VNC server functionality is initialized, but the server itself is
      not started. You can start the VNC server later with the QEMU
      monitor. For more information, see <a class="xref" href="opensuse-kvm.html#cha.qemu.monitor" title="Chapter 13. Administrating Virtual Machines with QEMU Monitor">Chapter 13, <em>Administrating Virtual Machines with QEMU Monitor</em></a>.
     </p></dd></dl></div><pre class="screen">tux@venus:~&gt; qemu-kvm [...] -vnc :5
(on the client:)
wilber@jupiter:~&gt; vinagre venus:5905 &amp;</pre><div class="figure"><a id="id728589"></a><p class="title"><strong>Figure 12.3. QEMU VNC Session</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="70%"><tr><td><img src="images/qemu_sles_vnc.png" width="100%" alt="QEMU VNC Session" /></td></tr></table></div></div></div><br class="figure-break" /><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="cha.qemu.running.vnc.secure"></a>12.5.1. Secure VNC Connections<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.running.vnc.secure">¶</a></span></h3></div></div></div><p>
    The default VNC server setup does not use any form of authentication. In
    the previous example, any user can connect and view the QEMU VNC
    Session from any host on the network.
   </p><p>
    There are several levels of security which you can apply to your VNC
    client/server connection. You can either protect your connection with a
    password, use x509 certificates, use SASL authentication, or even
    combine some of these authentication methods in one QEMU command.
   </p><p>
    See <a class="xref" href="opensuse-kvm.html#app.kvm.certificates" title="A.2. Generating x509 Client/Server Certificates">Section A.2, “Generating x509 Client/Server Certificates”</a> for more information about
    the x509 certificates generation. For more information about configuring
    x509 certificates on a VM Host Server and the client, see
    <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls" title="6.2.2. Remote TLS/SSL Connection with x509 Certificate (qemu+tls)">Section 6.2.2, “Remote TLS/SSL Connection with x509 Certificate (<code class="literal">qemu+tls</code>)”</a> and
    <a class="xref" href="opensuse-kvm.html#sec.libvirt.connect.remote.tls.client" title="6.2.2.3. Configuring the Client and Testing the Setup">Section 6.2.2.3, “Configuring the Client and Testing the Setup”</a>.
   </p><p>
    The Vinagre VNC viewer supports advanced authentication mechanisms.
    Therefore, it will be used to view the graphical output of VM Guest in
    the following examples. For this example, let us assume that the server
    x509 certificates <code class="filename">ca-cert.pem</code>,
    <code class="filename">server-cert.pem</code>, and
    <code class="filename">server-key.pem</code> are located in the
    <code class="filename">/etc/pki/qemu</code> directory on the host, while the
    client's certificates are distributed in the following locations on the
    client:
   </p><table border="0" summary="Simple list" class="simplelist"><tr><td><code class="filename">/etc/pki/CA/cacert.pem</code>
    </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/clientcert.pem</code>
    </td></tr><tr><td><code class="filename">/etc/pki/libvirt-vnc/private/clientkey.pem</code>
    </td></tr></table><div class="example"><a id="ex.running.vnc.secure.pwd"></a><p class="title"><strong>Example 12.5. Password Authentication</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.running.vnc.secure.pwd">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -vnc :5,password -monitor stdio</pre><p>
     Starts the VM Guest graphical output on VNC display number 5 (usually
     port 5905). The <code class="literal">password</code> suboption initializes a
     simple password-based authentication method. There is no password set
     by default and you have to set one with the <span class="command"><strong>change vnc
     password</strong></span> command in QEMU monitor:
    </p><pre class="screen">QEMU 0.12.5 monitor - type 'help' for more information
(qemu) change vnc password
Password: ****
</pre><p>
     You need the <code class="literal">-monitor stdio</code> option here, because you
     would not be able to manage the QEMU monitor without redirecting its
     input/output.
    </p></div></div><br class="example-break" /><div class="figure"><a id="id728756"></a><p class="title"><strong>Figure 12.4. Authentication Dialog in Vinagre</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" cellspacing="0" cellpadding="0" width="70%"><tr><td><img src="images/qemu_vnc_pwd.png" width="100%" alt="Authentication Dialog in Vinagre" /></td></tr></table></div></div></div><br class="figure-break" /><div class="example"><a id="ex.running.vnc.secure.x509"></a><p class="title"><strong>Example 12.6. x509 Certificate Authentication</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.running.vnc.secure.x509">¶</a></span></p><div class="example-contents"><p>
     The QEMU VNC server can use TLS encryption for the session and x509
     certificates for authentication. The server asks the client for a
     certificate and validates it against the CA certificate. Use this
     authentication type if your company provides an internal certificate
     authority.
    </p><pre class="screen">qemu-kvm [...] -vnc :5,tls,x509verify=/etc/pki/qemu</pre></div></div><br class="example-break" /><div class="example"><a id="ex.running.vnc.secure.pwd_x509"></a><p class="title"><strong>Example 12.7. x509 Certificate and Password Authentication</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.running.vnc.secure.pwd_x509">¶</a></span></p><div class="example-contents"><p>
     You can combine the password authentication with TLS encryption and
     x509 certificate authentication to create a two-layer authentication
     model for clients. Remember to set the password in the QEMU monitor
     after you run the following command:
    </p><pre class="screen">qemu-kvm [...] -vnc :5,password,tls,x509verify=/etc/pki/qemu -monitor stdio</pre></div></div><br class="example-break" /><div class="example"><a id="ex.running.vnc.secure.sasl"></a><p class="title"><strong>Example 12.8. SASL Authentication</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.running.vnc.secure.sasl">¶</a></span></p><div class="example-contents"><p>
     Simple Authentication and Security Layer (SASL) is a framework for
     authentication and data security in Internet protocols. It integrates
     several authentication mechanisms, like PAM, Kerberos, LDAP and more.
     SASL keeps its own user database, so the connecting user accounts do
     not need to exist on VM Host Server.
    </p><p>
     For security reasons, you are advised to combine SASL authentication
     with TLS encryption and x509 certificates:
    </p><pre class="screen">qemu-kvm [...] -vnc :5,tls,x509,sasl -monitor stdio</pre></div></div><br class="example-break" /></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="kvm.qemu.virtfs"></a>12.6. VirtFS: Sharing Folders between Host and Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.qemu.virtfs">¶</a></span></h2></div></div></div><p>
   VM Guests usually run in a separate computing space — they are
   provided their own memory range, dedicated CPUs, and filesystem space.
   Ability to share parts of VM Host Server's filesystem makes the virtualization
   environment more flexible by simplifying mutual data exchange. Network
   filesystems, such as CIFS and NFS, have been the traditional way of
   sharing folders. But as they are not specifically designed for
   virtualization purposes, they suffer from major performance and feature
   issues.
  </p><p>
   KVM introduces a new and more optimized tool called
   <span class="emphasis"><em>VirtFS</em></span> (sometimes referred to as a <span class="quote">“<span class="quote">filesystem
   pass-through</span>”</span>). VirtFS uses a paravirtual filesystem driver, which
   avoids converting the guest application filesystem operations into block
   device operations, and then again into host filesystem operations. VirtFS
   uses Plan-9 network protocol for communication between the guest and the
   host.
  </p><p>
   You can typically use VirtFS to
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     access a shared folder from several guests, or to provide
     guest-to-guest filesystem access.
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     replace the virtual disk as the root filesystem to which the guest's
     ramdisk connects to during the guest boot process
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     provide storage services to different customers from a single host
     filesystem in a cloud environment
    </p></li></ul></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="kvm.qemu.virtfs.implement"></a>12.6.1. Implementation<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.qemu.virtfs.implement">¶</a></span></h3></div></div></div><p>
    In QEMU, the implementation of VirtFS is facilitated by defining two
    types of devices:
   </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
      <code class="literal">virtio-9p-pci</code> device which transports protocol
      messages and data between the host and the guest.
     </p></li><li class="listitem" style="list-style-type: disc"><p>
      <code class="literal">fsdev</code> device which defines the export filesystem
      properties, such as filesystem type and security model.
     </p></li></ul></div><div class="example"><a id="ex.qemu.virtfs.host"></a><p class="title"><strong>Example 12.9. Exporting Host's Filesystem with VirtFS</strong><span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#ex.qemu.virtfs.host">¶</a></span></p><div class="example-contents"><pre class="screen">qemu-kvm [...] -fsdev local,id=exp1<a id="co.virtfs.host.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>,path=/tmp/<a id="co.virtfs.host.path"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>,security_model=mapped<a id="co.virtfs.host.sec_model"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>
-device virtio-9p-pci,fsdev=exp1<a id="co.virtfs.host.fsdev"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a>,mount_tag=v_tmp<a id="co.virtfs.host.mnt_tag"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a></pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.virtfs.host.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Identification of the filesystem to be exported.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.virtfs.host.path"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Filesystem path on the host to be exported.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.virtfs.host.sec_model"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Security model to be used — <code class="literal">mapped</code> keeps the
       guest filesystem modes and permissions isolated from the host, while
       <code class="literal">none</code> invokes a <span class="quote">“<span class="quote">pass-through</span>”</span>
       security model in which permission changes on the guest's files are
       reflected on the host as well.
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.virtfs.host.fsdev"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       The exported filesystem ID defined before with <code class="literal">-fsdev
       id=</code> .
      </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.virtfs.host.mnt_tag"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
       Mount tag used later on the guest to mount the exported filesystem.
      </p></td></tr></table></div><p>
     Such an exported filesystem can be mounted on the guest like this
    </p><pre class="screen">mount -t 9p -o trans=virtio v_tmp /mnt</pre><p>
     where <code class="literal">v_tmp</code> is the mount tag defined earlier with
     <code class="literal">-device mount_tag=</code> and <code class="literal">/mnt</code> is
     the mount point where you want to mount the exported filesystem.
    </p></div></div><br class="example-break" /></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="kvm.qemu.ksm"></a>12.7. KSM: Sharing Memory Pages between Guests<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#kvm.qemu.ksm">¶</a></span></h2></div></div></div><p>
   Kernel SamePage Merging (KSM) is a Linux Kernel feature which merges
   identical memory pages from multiple running processes into one memory
   region. Because KVM guests run as processes under Linux, KSM provides
   the memory overcommit feature to hypervisors for more efficient use of
   memory. Therefore, if you need to run multiple virtual machines on a host
   with limited memory, KSM is the best solution for you.
  </p><p>
   To make use of KSM, do the following.
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Verify that KSM is enabled in your running Kernel:
    </p><pre class="screen">grep KSM /boot/config-`uname -r`
CONFIG_KSM=y</pre><p>
     If KSM is enabled in the running Kernel, you will see the following
     files under the <code class="filename">/sys/kernel/mm/ksm</code> directory:
    </p><pre class="screen">ls -l /sys/kernel/mm/ksm
total 0
drwxr-xr-x 2 root root    0 Nov  9 07:10 ./
drwxr-xr-x 6 root root    0 Nov  9 07:10 ../
-r--r--r-- 1 root root 4096 Nov  9 07:10 full_scans
-r--r--r-- 1 root root 4096 Nov  9 07:10 pages_shared
-r--r--r-- 1 root root 4096 Nov  9 07:10 pages_sharing
-rw-r--r-- 1 root root 4096 Nov  9 07:10 pages_to_scan
-r--r--r-- 1 root root 4096 Nov  9 07:10 pages_unshared
-r--r--r-- 1 root root 4096 Nov  9 07:10 pages_volatile
-rw-r--r-- 1 root root 4096 Nov  9 07:10 run
-rw-r--r-- 1 root root 4096 Nov  9 07:10 sleep_millisecs</pre></li><li><p>
     Check if KSM feature is turned on.
    </p><pre class="screen">cat /sys/kernel/mm/ksm/run</pre><p>
     If the command returns <code class="literal">0</code>, turn KSM on with
    </p><pre class="screen">echo 1 &gt; /sys/kernel/mm/ksm/run</pre></li><li><p>
     Now run several VM Guests under KVM and inspect the content of files
     <code class="filename">pages_sharing</code> and
     <code class="filename">pages_shared</code>, for example:
    </p><pre class="screen">while [ 1 ]; do cat /sys/kernel/mm/ksm/pages_shared; sleep 1; done
13522
13523
13519
13518
13520
13520
13528</pre></li></ol></div><p>
   For more information on the meaning of the
   <code class="filename">/sys/kernel/mm/ksm/*</code> files, see
   <code class="filename">/usr/src/linux/Documentation/vm/ksm.txt</code> (package
   <code class="systemitem">kernel-source</code>).
  </p></div></div><div class="chapter"><div class="titlepage"><div><div><h2 class="title"><a id="cha.qemu.monitor"></a>Chapter 13. Administrating Virtual Machines with QEMU Monitor<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#cha.qemu.monitor">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id729276">13.1. Accessing Monitor Console</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729327">13.2. Getting Information about the Guest System</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729948">13.3. Changing VNC Password</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id729967">13.4. Managing Devices</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730008">13.5. Controlling Keyboard and Mouse</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730136">13.6. Changing Available Memory</a></span></
dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730185">13.7. Dumping Virtual Machine Memory</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730504">13.8. Managing Virtual Machine Snapshots</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730727">13.9. Suspending and Resuming Virtual Machine Execution</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id730818">13.10. Live Migration</a></span></dt></dl></div><p>
  When QEMU is running, a monitor console is provided for performing
  interaction with the user. Using the commands available in the monitor
  console, it is possible to inspect the running operating system, change
  removable media, take screenshots or audio grabs and control several other
  aspects of the virtual machine.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id729276"></a>13.1. Accessing Monitor Console<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id729276">¶</a></span></h2></div></div></div><p>
   To access the monitor console from QEMU, press
   <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span>+<span class="keycap">2</span>. To return back to
   QEMU from the monitor console, press <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span>+<span class="keycap">1</span>.
  </p><p>
   To get help while using the console, use <span class="command"><strong>help</strong></span> or
   <span class="command"><strong>?</strong></span>. To get help for a specific command, use
   <span class="command"><strong>help <em class="replaceable"><code>command</code></em></strong></span>.
  </p></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id729327"></a>13.2. Getting Information about the Guest System<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id729327">¶</a></span></h2></div></div></div><p>
   To get information about the guest system, use the <span class="command"><strong>info
   <code class="option">option</code></strong></span> command. If used without any option,
   the list of possible options is printed. Options determine which part of the
   system will be analyzed:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>info version</strong></span>
    </span></dt><dd><p>
      Shows the version of QEMU
     </p></dd><dt><span class="term"><span class="command"><strong>info commands</strong></span>
    </span></dt><dd><p>
      Lists available QMP commands
     </p></dd><dt><span class="term"><span class="command"><strong>info network</strong></span>
    </span></dt><dd><p>
      Shows the network state
     </p></dd><dt><span class="term"><span class="command"><strong>info chardev</strong></span>
    </span></dt><dd><p>
      Shows the character devices
     </p></dd><dt><span class="term"><span class="command"><strong>info block</strong></span>
    </span></dt><dd><p>
      Information about block devices, such as hard drives, floppy drives,
      or CD-ROMs
     </p></dd><dt><span class="term"><span class="command"><strong>info blockstats</strong></span>
    </span></dt><dd><p>
      Read and write statistics on block devices
     </p></dd><dt><span class="term"><span class="command"><strong>info registers</strong></span>
    </span></dt><dd><p>
      Shows the CPU registers
     </p></dd><dt><span class="term"><span class="command"><strong>info cpus</strong></span>
    </span></dt><dd><p>
      Shows information about available CPUs
     </p></dd><dt><span class="term"><span class="command"><strong>info history</strong></span>
    </span></dt><dd><p>
      Shows the command line history
     </p></dd><dt><span class="term"><span class="command"><strong>info irq</strong></span>
    </span></dt><dd><p>
      Shows the interrupts statistics
     </p></dd><dt><span class="term"><span class="command"><strong>info pic</strong></span>
    </span></dt><dd><p>
      Shows the i8259 (PIC) state
     </p></dd><dt><span class="term"><span class="command"><strong>info pci</strong></span>
    </span></dt><dd><p>
      Shows the PCI information
     </p></dd><dt><span class="term"><span class="command"><strong>info tlb</strong></span>
    </span></dt><dd><p>
      Shows virtual to physical memory mappings
     </p></dd><dt><span class="term"><span class="command"><strong>info mem</strong></span>
    </span></dt><dd><p>
      Shows the active virtual memory mappings
     </p></dd><dt><span class="term"><span class="command"><strong>info jit</strong></span>
    </span></dt><dd><p>
      Shows dynamic compiler information
     </p></dd><dt><span class="term"><span class="command"><strong>info kvm</strong></span>
    </span></dt><dd><p>
      Shows the KVM information
     </p></dd><dt><span class="term"><span class="command"><strong>info numa</strong></span>
    </span></dt><dd><p>
      Shows the NUMA information
     </p></dd><dt><span class="term"><span class="command"><strong>info usb</strong></span>
    </span></dt><dd><p>
      Shows the guest USB devices
     </p></dd><dt><span class="term"><span class="command"><strong>info usbhost</strong></span>
    </span></dt><dd><p>
      Shows the host USB devices
     </p></dd><dt><span class="term"><span class="command"><strong>info profile</strong></span>
    </span></dt><dd><p>
      Shows the profiling information
     </p></dd><dt><span class="term"><span class="command"><strong>info capture</strong></span>
    </span></dt><dd><p>
      Shows the capture (audio grab) information
     </p></dd><dt><span class="term"><span class="command"><strong>info snapshots</strong></span>
    </span></dt><dd><p>
      Shows the currently saved virtual machine snapshots
     </p></dd><dt><span class="term"><span class="command"><strong>info status</strong></span>
    </span></dt><dd><p>
      Shows the current virtual machine status
     </p></dd><dt><span class="term"><span class="command"><strong>info pcmcia</strong></span>
    </span></dt><dd><p>
      Shows the guest PCMCIA status
     </p></dd><dt><span class="term"><span class="command"><strong>info mice</strong></span>
    </span></dt><dd><p>
      Shows which guest mice is receiving events
     </p></dd><dt><span class="term"><span class="command"><strong>info vnc</strong></span>
    </span></dt><dd><p>
      Shows the VNC server status
     </p></dd><dt><span class="term"><span class="command"><strong>info name</strong></span>
    </span></dt><dd><p>
      Shows the current virtual machine name
     </p></dd><dt><span class="term"><span class="command"><strong>info uuid</strong></span>
    </span></dt><dd><p>
      Shows the current virtual machine UUID
     </p></dd><dt><span class="term"><span class="command"><strong>info usernet</strong></span>
    </span></dt><dd><p>
      Shows the user network stack connection states
     </p></dd><dt><span class="term"><span class="command"><strong>info migrate</strong></span>
    </span></dt><dd><p>
      Shows the migration status
     </p></dd><dt><span class="term"><span class="command"><strong>info balloon</strong></span>
    </span></dt><dd><p>
      Shows the balloon device information
     </p></dd><dt><span class="term"><span class="command"><strong>info qtree</strong></span>
    </span></dt><dd><p>
      Shows the device tree
     </p></dd><dt><span class="term"><span class="command"><strong>info qdm</strong></span>
    </span></dt><dd><p>
      Shows the qdev device model list
     </p></dd><dt><span class="term"><span class="command"><strong>info roms</strong></span>
    </span></dt><dd><p>
      Shows the ROMs
     </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id729948"></a>13.3. Changing VNC Password<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id729948">¶</a></span></h2></div></div></div><p>
   To change the VNC password, use the <span class="command"><strong>change vnc
   password</strong></span> command and enter the new password:
  </p><pre class="screen">
(qemu) change vnc password
Password: ********
(qemu)
    </pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id729967"></a>13.4. Managing Devices<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id729967">¶</a></span></h2></div></div></div><p>
   To release the device or file connected to the removable media device,
   use the <span class="command"><strong>eject <em class="replaceable"><code>device</code></em></strong></span>
   command. Use the optional <code class="option">-f</code> to force ejection.
  </p><p>
   To change removable media (like CD-ROMs), use the <span class="command"><strong>change
   <em class="replaceable"><code>device</code></em></strong></span> command. The name of the
   removable media can be determined using the <span class="command"><strong>info block</strong></span>
   command:
  </p><pre class="screen">
(qemu) info block
ide1-cd0: type=cdrom removable=1 locked=0 file=/dev/sr0 ro=1 drv=host_device
(qemu) change ide1-cd0 /path/to/image
     </pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730008"></a>13.5. Controlling Keyboard and Mouse<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730008">¶</a></span></h2></div></div></div><p>
   It is possible to use the monitor console to emulate keyboard and mouse
   input if necessary. For example, if your graphical user interface
   intercepts some key combinations at low level (such as
   <span class="keycap">Ctrl</span>+<span class="keycap">Alt</span>+<span class="keycap">F1</span>
   in X Window), you can still enter them using the <span class="command"><strong>sendkey
   <em class="replaceable"><code>keys</code></em></strong></span>:
  </p><pre class="screen">sendkey ctrl-alt-f1</pre><p>
   To list the key names used in the <em class="replaceable"><code>keys</code></em> option,
   enter <span class="command"><strong>sendkey</strong></span> and press <span class="keycap">Tab</span>.
  </p><p>
   To control the mouse, the following commands can be used:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>mouse_move <em class="replaceable"><code>dx</code></em><em class="replaceable"><code>dy</code></em> [<em class="replaceable"><code>dz</code></em>]</strong></span>
    </span></dt><dd><p>
      Move the active mouse pointer to the specified coordinates dx, dy with
      the optional scroll axis dz.
     </p></dd><dt><span class="term"><span class="command"><strong>mouse_button <em class="replaceable"><code>val</code></em></strong></span>
    </span></dt><dd><p>
      Change the state of the mouse buttons (1=left, 2=middle, 4=right).
     </p></dd><dt><span class="term"><span class="command"><strong>mouse_set <em class="replaceable"><code>index</code></em></strong></span>
    </span></dt><dd><p>
      Set which mouse device receives events. Device index numbers can be
      obtained with the <span class="command"><strong>info mice</strong></span> command.
     </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730136"></a>13.6. Changing Available Memory<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730136">¶</a></span></h2></div></div></div><p>
   If the virtual machine was started with the <code class="option">-balloon
   virtio</code> option and the paravirtualized balloon device that allows
   to dynamically change the amount of memory available is therefore
   enabled, it is possible to change the available memory dynamically. For
   more information about enabling the balloon device, see
   <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-kvm" title="11.1. Basic Installation with qemu-kvm">Section 11.1, “Basic Installation with <span class="command"><strong>qemu-kvm</strong></span>”</a>.
  </p><p>
   To get information about the balloon device in the monitor console and to
   determine whether the device is enabled, use the <span class="command"><strong>info
   balloon</strong></span> command:
  </p><pre class="screen">(qemu) info balloon</pre><p>
   If the balloon device is enabled, use the <span class="command"><strong>balloon
   <em class="replaceable"><code>memory_in_MB</code></em></strong></span> command to set the
   requested amount of memory:
  </p><pre class="screen">(qemu) balloon 400</pre></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730185"></a>13.7. Dumping Virtual Machine Memory<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730185">¶</a></span></h2></div></div></div><p>
   To save the content of the virtual machine memory to a disk or console
   output, use the following commands:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>memsave <em class="replaceable"><code>addr</code></em><em class="replaceable"><code>size</code></em><em class="replaceable"><code>filename</code></em></strong></span>
    </span></dt><dd><p>
      Saves virtual memory dump starting at <em class="replaceable"><code>addr</code></em>
      of size <em class="replaceable"><code>size</code></em> to file
      <em class="replaceable"><code>filename</code></em>
     </p></dd><dt><span class="term"><span class="command"><strong>pmemsave <em class="replaceable"><code>addr</code></em><em class="replaceable"><code>size</code></em><em class="replaceable"><code>filename</code></em></strong></span>
    </span></dt><dd><p>
      Saves physical memory dump starting at <em class="replaceable"><code>addr</code></em>
      of size <em class="replaceable"><code>size</code></em> to file
      <em class="replaceable"><code>filename</code></em>-
     </p></dd><dt><span class="term">x /<em class="replaceable"><code>fmt</code></em><em class="replaceable"><code>addr</code></em>
    </span></dt><dd><p>
      Makes a virtual memory dump starting at address
      <em class="replaceable"><code>addr</code></em> and formatted according to the
      <em class="replaceable"><code>fmt</code></em> string. The
      <em class="replaceable"><code>fmt</code></em> string consists of three parameters
      <code class="literal"><em class="replaceable"><code>count</code></em><em class="replaceable"><code>format</code></em><em class="replaceable"><code>size</code></em></code>:
     </p><p>
      The <em class="replaceable"><code>count</code></em> parameter is the number of 
      items to be dumped.
     </p><p>
      The <em class="replaceable"><code>format</code></em> can be <code class="literal">x</code>
      (hex), <code class="literal">d</code> (signed decimal), <code class="literal">u</code>
      (unsigned decimal), <code class="literal">o</code> (octal), <code class="literal">c</code>
      (char) or <code class="literal">i</code> (assembly instruction).
     </p><p>
      The <em class="replaceable"><code>size</code></em> parameter can be
      <code class="literal">b</code> (8 bits), <code class="literal">h</code> (16 bits),
      <code class="literal">w</code> (32 bits) or <code class="literal">g</code> (64 bits). On
      x86, <code class="literal">h</code> or <code class="literal">w</code> can be specified
      with the <code class="literal">i</code> format to respectively select 16 or
      32-bit code instruction size. is the number of the items to be dumped.
      
     </p></dd><dt><span class="term">xp /<em class="replaceable"><code>fmt</code></em><em class="replaceable"><code>addr</code></em>
    </span></dt><dd><p>
      Makes a physical memory dump starting at address
      <em class="replaceable"><code>addr</code></em> and formatted according to the
      <em class="replaceable"><code>fmt</code></em> string. The
      <em class="replaceable"><code>fmt</code></em> string consists of three parameters
      <code class="literal"><em class="replaceable"><code>count</code></em><em class="replaceable"><code>format</code></em><em class="replaceable"><code>size</code></em></code>:
     </p><p>
      The <em class="replaceable"><code>count</code></em> parameter is the number of the
      items to be dumped.
     </p><p>
      The <em class="replaceable"><code>format</code></em> can be <code class="literal">x</code>
      (hex), <code class="literal">d</code> (signed decimal), <code class="literal">u</code>
      (unsigned decimal), <code class="literal">o</code> (octal), <code class="literal">c</code>
      (char) or <code class="literal">i</code> (asm instruction).
     </p><p>
      The <em class="replaceable"><code>size</code></em> parameter can be
      <code class="literal">b</code> (8 bits), <code class="literal">h</code> (16 bits),
      <code class="literal">w</code> (32 bits) or <code class="literal">g</code> (64 bits). On
      x86, <code class="literal">h</code> or <code class="literal">w</code> can be specified
      with the<code class="literal">i</code> format to respectively select 16 or
      32-bit code instruction size. is the number of the items to be dumped.
     </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730504"></a>13.8. Managing Virtual Machine Snapshots<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730504">¶</a></span></h2></div></div></div><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left"></th></tr><tr><td colspan="2" align="left" valign="top"><p>
    Managing snapshots in QEMU monitor is not officially supported by SUSE
    yet. However, the information found in this section may be helpful in
    specific cases.
   </p></td></tr></table></div><p>
   Virtual machine snapshots are snapshots of the complete virtual machine
   including the state of CPU, RAM, and the content of all writable disks.
   To use virtual machine snapshots, you must have at least one
   non-removable and writable block device using the
   <code class="literal">qcow2</code> disk image format.
  </p><p>
   Snapshots are helpful when you need to save your virtual machine in a
   particular state. For example, after you configured network services on a
   virtualized server and want to quickly start the virtual machine in the
   same state that has been saved last. You can also create a snapshot after
   the virtual machine has been powered off to create a backup state before
   you try something experimental and possibly make VM Guest unstable. This
   section introduces the former case, while the latter is described in
   <a class="xref" href="opensuse-kvm.html#cha.qemu.guest_inst.qemu-img.snapshots" title="11.2.3. Managing Snapshots of Virtual Machines with qemu-img">Section 11.2.3, “Managing Snapshots of Virtual Machines with qemu-img”</a>.
  </p><p>
   The following commands are available for managing snapshots in QEMU
   monitor:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>savevm <em class="replaceable"><code>name</code></em></strong></span>
    </span></dt><dd><p>
      Creates a new virtual machine snapshot under the tag
      <em class="replaceable"><code>name</code></em> or replaces an existing snapshot.
     </p></dd><dt><span class="term"><span class="command"><strong>loadvm <em class="replaceable"><code>name</code></em></strong></span>
    </span></dt><dd><p>
      Loads a virtual machine snapshot tagged
      <em class="replaceable"><code>name</code></em>.
     </p></dd><dt><span class="term"><span class="command"><strong>delvm</strong></span>
    </span></dt><dd><p>
      Deletes a virtual machine snapshot.
     </p></dd><dt><span class="term"><span class="command"><strong>info snapshots</strong></span>
    </span></dt><dd><p>
      Prints information about available snapshots.
     </p><pre class="screen">(qemu) info snapshots 
Snapshot list:
ID<a id="co.qemu_monitor.snapshot.l.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a>       TAG<a id="co.qemu_monitor.snapshot.l.tag"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a>               VM SIZE<a id="co.qemu_monitor.snapshot.l.size"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a>        DATE<a id="co.qemu_monitor.snapshot.l.date"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a>          VM CLOCK<a id="co.qemu_monitor.snapshot.l.clock"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a>
1         booting                4.4M 2010-11-22 10:51:10   00:00:20.476
2         booted                 184M 2010-11-22 10:53:03   00:02:05.394
3         logged_in              273M 2010-11-22 11:00:25   00:04:34.843
4         ff_and_term_running    372M 2010-11-22 11:12:27   00:08:44.965</pre><div class="calloutlist"><table border="0" summary="Callout list"><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_monitor.snapshot.l.id"><span><img src="static/images/callouts/1.png" alt="1" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Unique identification number of the snapshot. Usually
        auto-incremented.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_monitor.snapshot.l.tag"><span><img src="static/images/callouts/2.png" alt="2" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Unique description string of the snapshot. It is meant as a human
        readable version of the ID.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_monitor.snapshot.l.size"><span><img src="static/images/callouts/3.png" alt="3" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        The disk space occupied by the snapshot. Note that the more memory
        is consumed by running applications, the bigger the snapshot is.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_monitor.snapshot.l.date"><span><img src="static/images/callouts/4.png" alt="4" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        Time and date the snapshot was created.
       </p></td></tr><tr><td width="5%" valign="top" align="left"><p><a href="opensuse-kvm.html#co.qemu_monitor.snapshot.l.clock"><span><img src="static/images/callouts/5.png" alt="5" border="0" /></span></a> </p></td><td valign="top" align="left"><p>
        The current state of the virtual machine's clock.
       </p></td></tr></table></div></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730727"></a>13.9. Suspending and Resuming Virtual Machine Execution<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730727">¶</a></span></h2></div></div></div><p>
   The following commands are available for suspending and resuming virtual
   machines:
  </p><div class="variablelist"><dl class="variablelist"><dt><span class="term"><span class="command"><strong>stop</strong></span>
    </span></dt><dd><p>
      Suspends the execution of the virtual machine.
     </p></dd><dt><span class="term"><span class="command"><strong>cont</strong></span>
    </span></dt><dd><p>
      Resumes the execution of the virtual machine.
     </p></dd><dt><span class="term"><span class="command"><strong>system_powerdown</strong></span>
    </span></dt><dd><p>
      Sends an ACPI shutdown request to the machine. The effect is similar
      to the power button on a physical machine.
     </p></dd><dt><span class="term"><span class="command"><strong>q</strong></span> or <span class="command"><strong>quit</strong></span>
    </span></dt><dd><p>
      Terminates QEMU immediately.
     </p></dd></dl></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id730818"></a>13.10. Live Migration<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id730818">¶</a></span></h2></div></div></div><p>
   The live migration process allows to transmit any virtual machine from
   one host system to another host system without any interruption in
   availability. It is possible to change hosts permanently or just during a
   maintenance. It is recommended that the source and destination systems
   have the same architecture, however it is possible to migrate between
   hosts with AMD and Intel architectures.
  </p><p>
   The requirements for the live migration:
  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
     The virtual machine image must be accessible on both source and
     destination hosts. For example, it can be located on a shared NFS disk.
      
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     The image directory should be located in the same path on both hosts.
      
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     Both hosts must be located in the same subnet.  
    </p></li><li class="listitem" style="list-style-type: disc"><p>
     The guest on the source and destination hosts must be started in the
     same way.  
    </p></li></ul></div><p>
   The live migration process has the following steps:
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     The virtual machine instance is running on the source host.
    </p></li><li><p>
     The virtual machine is started on the destination host in the frozen
     listening mode. The parameters used are the same as on the source host
     plus the <code class="option">-incoming
     tcp:<em class="replaceable"><code>ip</code></em>:<em class="replaceable"><code>port</code></em></code>
     parameter, where <em class="replaceable"><code>ip</code></em> specifies the IP address
     and <em class="replaceable"><code>port</code></em> specifies the port for listening to
     the incoming migration. If 0 is set as IP address, the virtual machine
     listens on all interfaces.
    </p></li><li><p>
     On the source host, switch to the monitor console and use the
     <span class="command"><strong>migrate -d
     tcp:<em class="replaceable"><code>destination_ip</code></em>:<em class="replaceable"><code>port</code></em></strong></span>
     command to initiate the migration.
    </p></li><li><p>
     To determine the state of the migration, use the <span class="command"><strong>info
     migrate</strong></span> command in the monitor console on the source host.
    </p></li><li><p>
     To cancel the migration, use the <span class="command"><strong>migrate_cancel</strong></span>
     command in the monitor console on the source host.
    </p></li><li><p>
     To set the maximum tolerable downtime for migration in seconds, use the
     <span class="command"><strong>migrate_set_downtime
     <em class="replaceable"><code>number_of_seconds</code></em></strong></span> command.
    </p></li><li><p>
     To set the maximum speed for migration in bytes per second, use the
     <span class="command"><strong>migrate_set_speed
     <em class="replaceable"><code>bytes_per_second</code></em></strong></span> command.
    </p></li></ol></div></div></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a id="app.kvm"></a>Appendix A. Appendix<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#app.kvm.virtio_install">A.1. Installing Para-Virtualized Drivers</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#app.kvm.certificates">A.2. Generating x509 Client/Server Certificates</a></span></dt></dl></div><p></p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="app.kvm.virtio_install"></a>A.1. Installing Para-Virtualized Drivers<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm.virtio_install">¶</a></span></h2></div></div></div><p></p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="app.kvm.virtio_install.windows_
osuse"></a>A.1.1. Installing virtio Drivers for Microsoft Windows*<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm.virtio_install.windows_osuse">¶</a></span></h3></div></div></div><p>
    Providing para-virtualized drivers during a Microsoft Windows
    installation does currently not work, since the installation refuses to
    boot from a para-virtualized hard disk. Therefore, the para-virtualized
    drivers need to be installed on a running Windows installation.
   </p><p>
    The following instructions assume that the existing Windows installation
    uses a single IDE hard disk and a single network adapter. An ISO image
    containing the virtio drivers for Windows is part of the
    <code class="systemitem">kvm</code> package and is
    available on the KVM host under
    <code class="filename">/usr/share/qemu-kvm/win-virtio-drivers.iso</code>. Make
    this ISO image available as a CD-ROM on your virtual machine as
    described in <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.cdrom.media_change" title="8.4. Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager">Section 8.4, “Ejecting and Changing Floppy or CD/DVD-ROM Media with Virtual Machine Manager”</a>. In
    case your virtual machine is configured without a CD-ROM device or you
    prefer to add a second one, see
    <a class="xref" href="opensuse-kvm.html#sec.libvirt.config.cdrom" title="8.2. Adding a CD/DVD-ROM Device with Virtual Machine Manager">Section 8.2, “Adding a CD/DVD-ROM Device with Virtual Machine Manager”</a> for setup instructions.
   </p><div class="variablelist"><p class="title"><strong>Finding the virtio drivers for Windows</strong></p><dl class="variablelist"><dt><span class="term">Windows XP 32-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\XP\x86\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\XP_Win2003\x86\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\XP\x86\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows XP 64-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span>
	not available
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\XP_Win2003\amd64\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\XP\amd64\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows Server 2003 32-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Win2003\x86\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\XP_Win2003\x86\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\Win2003\x86\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows Server 2003 64-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Win2003\amd64\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\XP_Win2003\amd64\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\XP\amd64\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows Vista/Server 2008 32-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Vista_Win2008\x86\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\Vista_Win2008\x86\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\Vista_Win2008\x86\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows Vista/Server 2008 64-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Vista_Win2008\amd64\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\Vista_Win2008\amd64\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\Vista_Win2008\amd64\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows 7 32-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Win7\x86\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\Win7\x86\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\Win7\x86\viostor.inf</code>
       </td></tr></table></dd><dt><span class="term">Windows 7 64-bit</span></dt><dd><table border="0" summary="Simple list" class="simplelist"><tr><td><span class="emphasis"><em>Memory Ballooning: </em></span><code class="filename">balloon\install\Win7\amd64\balloon.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Network: </em></span><code class="filename">NetKVM\install\Win7\amd64\netkvm.inf</code>
       </td></tr><tr><td><span class="emphasis"><em>Storage: </em></span><code class="filename">viostor\install\Win7\amd64\viostor.inf</code>
       </td></tr></table></dd></dl></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="app.kvm.virtio_install.windows.7"></a>A.1.1.1. Windows 7<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm.virtio_install.windows.7">¶</a></span></h4></div></div></div><p>
     The following instructions show how to install para-virtualized storage
     an network drivers for Windows 7. Please make sure to
     <span class="emphasis"><em>exactly</em></span> follow the instructions for installing the
     storage drivers, otherwise your system will either completely refuse to
     boot or will boot into a <span class="quote">“<span class="quote">blue screen</span>”</span>!
    </p><div class="important"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Important: Technical Support"><tr class="head"><td width="32"><img alt="[Important]" src="static/images/important.png" /></td><th align="left">Technical Support</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      The following instructions require to use <span class="command"><strong>virsh
      <code class="option">edit</code></strong></span>. Using this command in principle is
      not supported by the SUSE Technical Support. However, this special
      context (Installing Para-Virtualized Storage Drivers for Windows) is
      an exception from this rule. It will be supported with reasonable
      effort.
     </p></td></tr></table></div><div class="procedure"><a id="id731468"></a><p class="title"><strong>Procedure A.1. Installing Para-Virtualized Storage Drivers for Windows 7 32-bit</strong></p><ol class="procedure" type="1"><li><p>
       Shut down the Windows 7 VM Guest and use Virtual Machine Manager to add an additional
       hard disk of type <code class="literal">virtio</code> (a para-virtualized hard
       disk). This disk is only temporarily needed and will be removed again
       from the VM Guest.
      </p></li><li><p>
       If necessary, use Virtual Machine Manager to adjust the <span class="guimenu">Boot Device
       Order</span>. It <span class="emphasis"><em>must</em></span> start with
       <span class="guimenu">Hard Disk</span>, otherwise the system will not boot once
       the system disk is para-virtualized. You need to confirm your changes
       with <span class="guimenu">Apply</span>, otherwise they will not be written to
       the configuration.
      </p></li><li><p>
       Reboot the VM Guest. Once it has booted, open the <span class="guimenu">Device
       Manager</span>, for example, by opening the main menu and entering
       <span class="command"><strong>devmgmt.msc</strong></span> followed by <span class="keycap">Enter</span>
       into the <span class="guimenu">Start programs and files</span> field.
      </p></li><li><p>
       Search for the entry <span class="guimenu">Other devices</span>+<span class="guimenu">SCSI Controller</span>. The entry is marked
       with an exclamation mark as being problematic. Right-click this entry
       and choose <span class="guimenu">Update Driver Software</span>.
      </p></li><li><p>
       Install the driver. Choose to <span class="guimenu">Browse my computer for driver
       software</span>. Use the <span class="guimenu">Browse</span> button to
       select the directory on the driver CD containing the storage drivers
       for your operating system and architecture
       (<code class="filename">viostor\install\Win7\x86\</code>). Confirm the
       security exception by clicking <span class="guimenu">Install</span>.
      </p></li><li><p>
       Once the driver installation is finished, a new <span class="guimenu">Storage
       Controller</span> named <span class="guimenu">Novell VirtIO SCSI
       Adapater</span> is listed in the <span class="guimenu">Device
       Manager</span>. Additionally, the entry <span class="guimenu">Disk
       Drives</span> now contains the temporary para-virtualized disk. It
       is listed as <span class="guimenu">Novell VirtIO SCSI Disk Device</span>.
      </p></li><li><p>
       Shut down the Windows 7 VM Guest and use Virtual Machine Manager to remove the
       temporary para-virtualized disk added earlier.
      </p></li><li><p>
       Changing the type of a virtual hard disk is currently not supported
       by Virtual Machine Manager—therefore the XML configuration needs to be changed
       directly. Open a terminal and enter the following command (replace
       <em class="replaceable"><code>NAME</code></em> with the name of you Windows 7
       VM Guest). If operating from a remote host, also specify a
       connection URl with the <code class="option">-c</code> parameter.
      </p><pre class="screen">virsh edit <em class="replaceable"><code>NAME</code></em></pre><p>
       An editor (<span class="command"><strong>vi</strong></span> by default) opens. Search for a
       block similar to the following:
      </p><pre class="screen">&lt;disk type='block' device='disk'&gt;
  &lt;driver name='qemu' type='raw'/&gt;
  &lt;source file='/var/lib/libvirt/images/win7.raw'/&gt;
  &lt;target dev='hda' bus='ide'/&gt;
  &lt;address type='drive' controller='0' bus='0' unit='0'/&gt;
&lt;/disk&gt;</pre><p>
       Remove the &lt;address&gt; tag. Change the attributes of the &lt;target&gt;
       tag to <code class="literal">dev='vda'</code> and
       <code class="literal">bus='virtio'</code>:
      </p><pre class="screen">&lt;disk type='block' device='disk'&gt;
  &lt;driver name='qemu' type='raw'/&gt;
  &lt;source dev='/dev/Virtual/win7'/&gt;
  &lt;target dev='vda' bus='virtio'/&gt;
&lt;/disk&gt;</pre><p>
       Save the file. A successful save results in <code class="literal">Domain
       <em class="replaceable"><code>NAME</code></em> XML configuration edited.</code>
       In case an error is reported (for example, when having produced
       invalid XML), the configuration has not been changed.
      </p></li><li><p>
       Restart the VM Guest. If starting it via Virtual Machine Manager, make sure the
       hardware change is visible in the <span class="guimenu">Details</span> screen
       before you start (this may take a few seconds after you have saved
       the configuration changes from <span class="command"><strong>virsh</strong></span>). Otherwise
       your changes will be overwritten with the configuration last used by
       Virtual Machine Manager.
      </p><p>
       Your Windows 7 VM Guest now uses a para-virtualized system disk.
      </p></li></ol></div><p>
     Installing para-virtualized network drivers is very similar to
     installing the storage drivers:
    </p><div class="procedure"><a id="id731734"></a><p class="title"><strong>Procedure A.2. Installing Para-Virtualized Network Drivers for Windows 7</strong></p><ol class="procedure" type="1"><li><p>
       Shut down the Windows 7 VM Guest and use Virtual Machine Manager to add an additional
       network adapter of type <code class="literal">virtio</code> (a para-virtualized
       network adapter). This ensures that you still have network
       connectivity while installing the drivers.
      </p></li><li><p>
       Reboot the VM Guest and install the driver via the <span class="guimenu">Device
       Manager</span> as described above. The new network adapter can be
       found under <span class="guimenu">Other devices</span>+<span class="guimenu">Ethernet controller</span>. After a
       successful driver installation, a <span class="guimenu">Novell VirtIO Ethernet
       Adapter</span> is listed in the <span class="guimenu">Device Manager</span>
       under <span class="guimenu">Network Adapters</span>.
      </p></li><li><p>
       Shut down the VM Guest and remove the original, non-para-virtualized
       network adapter from the guest configuration using Virtual Machine Manager. Reboot the
       guest—now it uses a para-virtualized network adapter.
      </p></li></ol></div></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="app.kvm.virtio_install.windows.xp"></a>A.1.1.2. Other Windows Versions (XP, Server 2003/2008, Vista)<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm.virtio_install.windows.xp">¶</a></span></h4></div></div></div><p>
     Installing para-virtualized drivers for other Windows versions is very
     similar to installing them on Windows 7 (see
     <a class="xref" href="opensuse-kvm.html#app.kvm.virtio_install.windows.7" title="A.1.1.1. Windows 7">Section A.1.1.1, “Windows 7”</a>). You do not
     need to manually start the <span class="guimenu">Device Manager</span>—
     Windows will rather prompt you to install the missing drivers. Make
     sure to manually choose the location of the driver during the
     installation process.
    </p><div class="warning"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Warning: Para-Virtualized Storage Drivers on Windows Vista"><tr class="head"><td width="32"><img alt="[Warning]" src="static/images/warning.png" /></td><th align="left">Para-Virtualized Storage Drivers on Windows Vista</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Currently the para-virtualized storage drivers for Windows Vista do
      not support booting from a para-virtualized disk. Using
      para-virtualized storage devices for non-bootable disks is supported.
     </p></td></tr></table></div><div class="note"><table border="0" cellpadding="3" cellspacing="0" width="100%" summary="Note: Para-Virtualized Storage Drivers on Windows XP not Recommended"><tr class="head"><td width="32"><img alt="[Note]" src="static/images/note.png" /></td><th align="left">Para-Virtualized Storage Drivers on Windows XP not Recommended</th></tr><tr><td colspan="2" align="left" valign="top"><p>
      Using the para-virtualized storage drivers on Windows XP does not
      result in any performance gain—it may even result in performance
      penalties. Therefore, it is <span class="emphasis"><em>not</em></span> recommended to
      use them. See
      <a class="ulink" href="http://www.mail-archive.com/kvm@vger.kernel.org/msg22834.html" target="_top">http://www.mail-archive.com/kvm@vger.kernel.org/msg22834.html</a>
      for technical details.
     </p><p>
      Note that this only affects para-virtualized
      <span class="emphasis"><em>storage</em></span> drivers for Windows XP! Using
      para-virtualized storage drivers on other Windows versions will result
      in better performance. Using para-virtualized network drivers on
      Windows XP is also beneficial.
     </p></td></tr></table></div></div></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="app.kvm.certificates"></a>A.2. Generating x509 Client/Server Certificates<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#app.kvm.certificates">¶</a></span></h2></div></div></div><p>
   In order to be able to create x509 client and server certificates you
   need to issue them by a Certificate Authority (CA). It is recommended to
   set up an independent CA that only issues certificates for
   <code class="systemitem">libvirt</code>.
  </p><div class="procedure"><ol class="procedure" type="1"><li><p>
     Set up a CA as described in
     Section “Creating a Root CA” (Chapter 15, <em>Managing X.509 Certification</em>, ↑Security Guide).
    </p></li><li><p>
     Create a server and a client certificate as described in
     Section “Creating or Revoking User Certificates” (Chapter 15, <em>Managing X.509 Certification</em>, ↑Security Guide). The
     Common Name (CN) for the server certificate must be the full qualified
     hostname, the Common Name for the client certificate can be freely
     chosen. For all other fields stick with the defaults suggested by
     YaST.
    </p><p>
     Export the client and server certificates to a temporary location (for
     example, <code class="filename">/tmp/x509/</code>) by performing the following
     steps:
    </p><ol type="a" class="substeps"><li><p>
       Select the certificate on the <span class="guimenu">certificates</span> tab.
      </p></li><li><p>
       Choose <span class="guimenu">Export</span>+<span class="guimenu">Export to
       File</span>+<span class="guimenu">Certificate and the Key Unencrypted in PEM
       Format</span>, provide the <span class="guimenu">Certificate
       Password</span> and the full path and the filename under
       <span class="guimenu">File Name</span>, for example,
       <code class="filename">/tmp/x509/server.pem</code> or
       <code class="filename">/tmp/x509/client.pem</code>.
      </p></li><li><p>
       Open a terminal and change to the directory where you have saved the
       certificate and issue the following commands to split it into
       certificate and key (this example splits the server key):
      </p><pre class="screen">csplit -z -f s_ server.pem '/-----BEGIN/' '{1}'
       mv s_00 servercert.pem
       mv s_01 serverkey.pem</pre></li><li><p>
       Repeat the procedure for each client and server certificate you would
       like to export.
      </p></li></ol></li><li><p>
     Finally export the CA certificate by performing the following steps:
    </p><ol type="a" class="substeps"><li><p>
       Switch to the <span class="guimenu">Description</span> tab.
      </p></li><li><p>
       Choose<span class="guimenu">Advanced</span>+<span class="guimenu">Export to
       File</span>+<span class="guimenu">Only the Certificate in PEM Format</span> and enter the full path and the filename under
       <span class="guimenu">File Name</span>, for example,
       <code class="filename">/tmp/x509/cacert.pem</code>.
      </p></li></ol></li></ol></div></div></div><div class="appendix"><div class="titlepage"><div><div><h2 class="title"><a id="id732108"></a>Appendix B. GNU Licenses<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732108">¶</a></span></h2></div></div></div><div class="toc"><p><strong>Contents</strong></p><dl><dt><span class="sect1"><a href="opensuse-kvm.html#id732130">B.1. GNU General Public License</a></span></dt><dt><span class="sect1"><a href="opensuse-kvm.html#id732722">B.2. GNU Free Documentation License</a></span></dt></dl></div><p>
  This appendix contains the GNU General Public License version 2 and the
  GNU Free Documentation License version 1.2.
 </p><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id732130"></a>B.1. GNU General Public License<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732130">¶</a></span></h2></div></div></div><p>
  Version 2, June 1991
 </p><p>
  Copyright (C) 1989, 1991 Free Software Foundation, Inc. 59 Temple Place -
  Suite 330, Boston, MA 02111-1307, USA
 </p><p>
  Everyone is permitted to copy and distribute verbatim copies of this
  license document, but changing it is not allowed.
 </p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="id732154"></a>B.1.1. Preamble<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732154">¶</a></span></h3></div></div></div><p>
   The licenses for most software are designed to take away your freedom to
   share and change it. By contrast, the GNU General Public License is
   intended to guarantee your freedom to share and change free software--to
   make sure the software is free for all its users. This General Public
   License applies to most of the Free Software Foundation’s software
   and to any other program whose authors commit to using it. (Some other
   Free Software Foundation software is covered by the GNU Library General
   Public License instead.) You can apply it to your programs, too.
  </p><p>
   When we speak of free software, we are referring to freedom, not price.
   Our General Public Licenses are designed to make sure that you have the
   freedom to distribute copies of free software (and charge for this
   service if you wish), that you receive source code or can get it if you
   want it, that you can change the software or use pieces of it in new free
   programs; and that you know you can do these things.
  </p><p>
   To protect your rights, we need to make restrictions that forbid anyone
   to deny you these rights or to ask you to surrender the rights. These
   restrictions translate to certain responsibilities for you if you
   distribute copies of the software, or if you modify it.
  </p><p>
   For example, if you distribute copies of such a program, whether gratis
   or for a fee, you must give the recipients all the rights that you have.
   You must make sure that they, too, receive or can get the source code.
   And you must show them these terms so they know their rights.
  </p><p>
   We protect your rights with two steps: (1) copyright the software, and
   (2) offer you this license which gives you legal permission to copy,
   distribute and/or modify the software.
  </p><p>
   Also, for each author’s protection and ours, we want to make
   certain that everyone understands that there is no warranty for this free
   software. If the software is modified by someone else and passed on, we
   want its recipients to know that what they have is not the original, so
   that any problems introduced by others will not reflect on the original
   authors’ reputations.
  </p><p>
   Finally, any free program is threatened constantly by software patents.
   We wish to avoid the danger that redistributors of a free program will
   individually obtain patent licenses, in effect making the program
   proprietary. To prevent this, we have made it clear that any patent must
   be licensed for everyone’s free use or not licensed at all.
  </p><p>
   The precise terms and conditions for copying, distribution and
   modification follow.
  </p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="id732214"></a>B.1.2. GNU GENERAL PUBLIC LICENSE TERMS AND CONDITIONS FOR COPYING, DISTRIBUTION AND MODIFICATION<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732214">¶</a></span></h3></div></div></div><p><strong>0. </strong>
    This License applies to any program or other work which contains a
    notice placed by the copyright holder saying it may be distributed under
    the terms of this General Public License. The <span class="quote">“<span class="quote">Program</span>”</span>,
    below, refers to any such program or work, and a <span class="quote">“<span class="quote">work based on
    the Program</span>”</span> means either the Program or any derivative work
    under copyright law: that is to say, a work containing the Program or a
    portion of it, either verbatim or with modifications and/or
    translated into another language. (Hereinafter, translation is included
    without limitation in the term <span class="quote">“<span class="quote">modification</span>”</span>.) Each
    licensee is addressed as <span class="quote">“<span class="quote">you</span>”</span>.
   </p><p>
   Activities other than copying, distribution and modification are not
   covered by this License; they are outside its scope. The act of running
   the Program is not restricted, and the output from the Program is covered
   only if its contents constitute a work based on the Program (independent
   of having been made by running the Program). Whether that is true depends
   on what the Program does.
  </p><p><strong>1. </strong>
    You may copy and distribute verbatim copies of the Program’s
    source code as you receive it, in any medium, provided that you
    conspicuously and appropriately publish on each copy an appropriate
    copyright notice and disclaimer of warranty; keep intact all the notices
    that refer to this License and to the absence of any warranty; and give
    any other recipients of the Program a copy of this License along with
    the Program.
   </p><p>
   You may charge a fee for the physical act of transferring a copy, and you
   may at your option offer warranty protection in exchange for a fee.
  </p><p><strong>2. </strong>
    You may modify your copy or copies of the Program or any portion of it,
    thus forming a work based on the Program, and copy and distribute such
    modifications or work under the terms of Section 1 above, provided that
    you also meet all of these conditions:
   </p><p><strong>a). </strong>
    You must cause the modified files to carry prominent notices stating
    that you changed the files and the date of any change.
   </p><p><strong>b). </strong>
    You must cause any work that you distribute or publish, that in whole or
    in part contains or is derived from the Program or any part thereof, to
    be licensed as a whole at no charge to all third parties under the terms
    of this License.
   </p><p><strong>c). </strong>
    If the modified program normally reads commands interactively when run,
    you must cause it, when started running for such interactive use in the
    most ordinary way, to print or display an announcement including an
    appropriate copyright notice and a notice that there is no warranty (or
    else, saying that you provide a warranty) and that users may
    redistribute the program under these conditions, and telling the user
    how to view a copy of this License. (Exception: if the Program itself is
    interactive but does not normally print such an announcement, your work
    based on the Program is not required to print an announcement.)
   </p><p>
   These requirements apply to the modified work as a whole. If identifiable
   sections of that work are not derived from the Program, and can be
   reasonably considered independent and separate works in themselves, then
   this License, and its terms, do not apply to those sections when you
   distribute them as separate works. But when you distribute the same
   sections as part of a whole which is a work based on the Program, the
   distribution of the whole must be on the terms of this License, whose
   permissions for other licensees extend to the entire whole, and thus to
   each and every part regardless of who wrote it.
  </p><p>
   Thus, it is not the intent of this section to claim rights or contest
   your rights to work written entirely by you; rather, the intent is to
   exercise the right to control the distribution of derivative or
   collective works based on the Program.
  </p><p>
   In addition, mere aggregation of another work not based on the Program
   with the Program (or with a work based on the Program) on a volume of a
   storage or distribution medium does not bring the other work under the
   scope of this License.
  </p><p><strong>3. </strong>
    You may copy and distribute the Program (or a work based on it, under
    Section 2) in object code or executable form under the terms of Sections
    1 and 2 above provided that you also do one of the following:
   </p><p><strong>a). </strong>
    Accompany it with the complete corresponding machine-readable source
    code, which must be distributed under the terms of Sections 1 and 2
    above on a medium customarily used for software interchange; or,
   </p><p><strong>b). </strong>
    Accompany it with a written offer, valid for at least three years, to
    give any third party, for a charge no more than your cost of physically
    performing source distribution, a complete machine-readable copy of the
    corresponding source code, to be distributed under the terms of Sections
    1 and 2 above on a medium customarily used for software interchange; or,
   </p><p><strong>c). </strong>
    Accompany it with the information you received as to the offer to
    distribute corresponding source code. (This alternative is allowed only
    for noncommercial distribution and only if you received the program in
    object code or executable form with such an offer, in accord with
    Subsection b above.)
   </p><p>
   The source code for a work means the preferred form of the work for
   making modifications to it. For an executable work, complete source code
   means all the source code for all modules it contains, plus any
   associated interface definition files, plus the scripts used to control
   compilation and installation of the executable. However, as a special
   exception, the source code distributed need not include anything that is
   normally distributed (in either source or binary form) with the major
   components (compiler, kernel, and so on) of the operating system on which
   the executable runs, unless that component itself accompanies the
   executable.
  </p><p>
   If distribution of executable or object code is made by offering access
   to copy from a designated place, then offering equivalent access to copy
   the source code from the same place counts as distribution of the source
   code, even though third parties are not compelled to copy the source
   along with the object code.
  </p><p><strong>4. </strong>
    You may not copy, modify, sublicense, or distribute the Program except
    as expressly provided under this License. Any attempt otherwise to copy,
    modify, sublicense or distribute the Program is void, and will
    automatically terminate your rights under this License. However, parties
    who have received copies, or rights, from you under this License will
    not have their licenses terminated so long as such parties remain in
    full compliance.
   </p><p><strong>5. </strong>
    You are not required to accept this License, since you have not signed
    it. However, nothing else grants you permission to modify or distribute
    the Program or its derivative works. These actions are prohibited by law
    if you do not accept this License. Therefore, by modifying or
    distributing the Program (or any work based on the Program), you
    indicate your acceptance of this License to do so, and all its terms and
    conditions for copying, distributing or modifying the Program or works
    based on it.
   </p><p><strong>6. </strong>
    Each time you redistribute the Program (or any work based on the
    Program), the recipient automatically receives a license from the
    original licensor to copy, distribute or modify the Program subject to
    these terms and conditions. You may not impose any further restrictions
    on the recipients’ exercise of the rights granted herein. You are
    not responsible for enforcing compliance by third parties to this
    License.
   </p><p><strong>7. </strong>
    If, as a consequence of a court judgment or allegation of patent
    infringement or for any other reason (not limited to patent issues),
    conditions are imposed on you (whether by court order, agreement or
    otherwise) that contradict the conditions of this License, they do not
    excuse you from the conditions of this License. If you cannot distribute
    so as to satisfy simultaneously your obligations under this License and
    any other pertinent obligations, then as a consequence you may not
    distribute the Program at all. For example, if a patent license would
    not permit royalty-free redistribution of the Program by all those who
    receive copies directly or indirectly through you, then the only way you
    could satisfy both it and this License would be to refrain entirely from
    distribution of the Program.
   </p><p>
   If any portion of this section is held invalid or unenforceable under any
   particular circumstance, the balance of the section is intended to apply
   and the section as a whole is intended to apply in other circumstances.
  </p><p>
   It is not the purpose of this section to induce you to infringe any
   patents or other property right claims or to contest validity of any such
   claims; this section has the sole purpose of protecting the integrity of
   the free software distribution system, which is implemented by public
   license practices. Many people have made generous contributions to the
   wide range of software distributed through that system in reliance on
   consistent application of that system; it is up to the author/donor
   to decide if he or she is willing to distribute software through any
   other system and a licensee cannot impose that choice.
  </p><p>
   This section is intended to make thoroughly clear what is believed to be
   a consequence of the rest of this License.
  </p><p><strong>8. </strong>
    If the distribution and/or use of the Program is restricted in
    certain countries either by patents or by copyrighted interfaces, the
    original copyright holder who places the Program under this License may
    add an explicit geographical distribution limitation excluding those
    countries, so that distribution is permitted only in or among countries
    not thus excluded. In such case, this License incorporates the
    limitation as if written in the body of this License.
   </p><p><strong>9. </strong>
    The Free Software Foundation may publish revised and/or new versions
    of the General Public License from time to time. Such new versions will
    be similar in spirit to the present version, but may differ in detail to
    address new problems or concerns.
   </p><p>
   Each version is given a distinguishing version number. If the Program
   specifies a version number of this License which applies to it and
   <span class="quote">“<span class="quote">any later version</span>”</span>, you have the option of following the
   terms and conditions either of that version or of any later version
   published by the Free Software Foundation. If the Program does not
   specify a version number of this License, you may choose any version ever
   published by the Free Software Foundation.
  </p><p><strong>10. </strong>
    If you wish to incorporate parts of the Program into other free programs
    whose distribution conditions are different, write to the author to ask
    for permission. For software which is copyrighted by the Free Software
    Foundation, write to the Free Software Foundation; we sometimes make
    exceptions for this. Our decision will be guided by the two goals of
    preserving the free status of all derivatives of our free software and
    of promoting the sharing and reuse of software generally.
   </p><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="id732561"></a>B.1.2.1. NO WARRANTY<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732561">¶</a></span></h4></div></div></div><p><strong>11. </strong>
     BECAUSE THE PROGRAM IS LICENSED FREE OF CHARGE, THERE IS NO WARRANTY
     FOR THE PROGRAM, TO THE EXTENT PERMITTED BY APPLICABLE LAW. EXCEPT WHEN
     OTHERWISE STATED IN WRITING THE COPYRIGHT HOLDERS AND/OR OTHER
     PARTIES PROVIDE THE PROGRAM “AS IS” WITHOUT WARRANTY OF ANY
     KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, THE
     IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
     PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND PERFORMANCE OF THE
     PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE DEFECTIVE, YOU ASSUME THE
     COST OF ALL NECESSARY SERVICING, REPAIR OR CORRECTION.
    </p><p><strong>12. </strong>
     IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
     WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MAY MODIFY AND/OR
     REDISTRIBUTE THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR
     DAMAGES, INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL
     DAMAGES ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM
     (INCLUDING BUT NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED
     INACCURATE OR LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF
     THE PROGRAM TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR
     OTHER PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.
    </p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="id732602"></a>B.1.2.2. END OF TERMS AND CONDITIONS<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732602">¶</a></span></h4></div></div></div><p></p></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="id732613"></a>B.1.3. How to Apply These Terms to Your New Programs<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732613">¶</a></span></h3></div></div></div><p>
   If you develop a new program, and you want it to be of the greatest
   possible use to the public, the best way to achieve this is to make it
   free software which everyone can redistribute and change under these
   terms.
  </p><p>
   To do so, attach the following notices to the program. It is safest to
   attach them to the start of each source file to most effectively convey
   the exclusion of warranty; and each file should have at least the
   <span class="quote">“<span class="quote">copyright</span>”</span> line and a pointer to where the full notice is
   found.
  </p><pre class="screen">
   one line to give the program’s name and an idea of what it does. 
   Copyright (C) yyyy name of author
  </pre><pre class="screen">
   This program is free software; you can redistribute it and/or
   modify it under the terms of the GNU General Public License
   as published by the Free Software Foundation; either version 2
   of the License, or (at your option) any later version.
  </pre><pre class="screen">
   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
   GNU General Public License for more details.
  </pre><pre class="screen">
   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
  </pre><p>
   Also add information on how to contact you by electronic and paper mail.
  </p><p>
   If the program is interactive, make it output a short notice like this
   when it starts in an interactive mode:
  </p><pre class="screen">
   Gnomovision version 69, Copyright (C) year name of author
   Gnomovision comes with ABSOLUTELY NO WARRANTY; for details
   type `show w’. This is free software, and you are welcome
   to redistribute it under certain conditions; type `show c’ 
   for details.
  </pre><p>
   The hypothetical commands `show w’ and `show c’ should show
   the appropriate parts of the General Public License. Of course, the
   commands you use may be called something other than `show w’ and
   `show c’; they could even be mouse-clicks or menu items--whatever
   suits your program.
  </p><p>
   You should also get your employer (if you work as a programmer) or your
   school, if any, to sign a <span class="quote">“<span class="quote">copyright disclaimer</span>”</span> for the
   program, if necessary. Here is a sample; alter the names:
  </p><pre class="screen">
   Yoyodyne, Inc., hereby disclaims all copyright
   interest in the program `Gnomovision’
   (which makes passes at compilers) written 
   by James Hacker.
  </pre><pre class="screen">
   signature of Ty Coon, 1 April 1989
   Ty Coon, President of Vice
  </pre><p>
   This General Public License does not permit incorporating your program
   into proprietary programs. If your program is a subroutine library, you
   may consider it more useful to permit linking proprietary applications
   with the library. If this is what you want to do, use the
   <a class="ulink" href="http://www.fsf.org/licenses/lgpl.html" target="_top">GNU Lesser General
   Public License</a> instead of this License.
  </p></div></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id732722"></a>B.2. GNU Free Documentation License<span class="permalink"><a title="Copy Permalink" href="opensuse-kvm.html#id732722">¶</a></span></h2></div></div></div><p>
    Copyright (C) 2000, 2001, 2002 Free Software Foundation,
    Inc. 51 Franklin St, Fifth Floor,
    Boston, MA 02110-1301 USA.  Everyone is permitted to copy and
    distribute verbatim copies of this license document, but changing it is
    not allowed.
  </p><h2><a id="id732739"></a>
    0. PREAMBLE
  </h2><p>
    The purpose of this License is to make a manual, textbook, or other
    functional and useful document "free" in the sense of freedom: to assure
    everyone the effective freedom to copy and redistribute it, with or
    without modifying it, either commercially or noncommercially.
    Secondarily, this License preserves for the author and publisher a way to
    get credit for their work, while not being considered responsible for
    modifications made by others.
  </p><p>
    This License is a kind of "copyleft", which means that derivative works of
    the document must themselves be free in the same sense.  It complements
    the GNU General Public License, which is a copyleft license designed for
    free software.
  </p><p>
    We have designed this License in order to use it for manuals for free
    software, because free software needs free documentation: a free program
    should come with manuals providing the same freedoms that the software
    does.  But this License is not limited to software manuals; it can be used
    for any textual work, regardless of subject matter or whether it is
    published as a printed book.  We recommend this License principally for
    works whose purpose is instruction or reference.</p><h2><a id="id732766"></a>
    1. APPLICABILITY AND DEFINITIONS
  </h2><p>
    This License applies to any manual or other work, in any medium, that
    contains a notice placed by the copyright holder saying it can be
    distributed under the terms of this License.  Such a notice grants a
    world-wide, royalty-free license, unlimited in duration, to use that work
    under the conditions stated herein.  The "Document", below, refers to any
    such manual or work.  Any member of the public is a licensee, and is
    addressed as "you".  You accept the license if you copy, modify or
    distribute the work in a way requiring permission under copyright
    law.
  </p><p>
    A "Modified Version" of the Document means any work containing the
    Document or a portion of it, either copied verbatim, or with modifications
    and/or translated into another language.
  </p><p>
    A "Secondary Section" is a named appendix or a front-matter section of the
    Document that deals exclusively with the relationship of the publishers or
    authors of the Document to the Document's overall subject (or to related
    matters) and contains nothing that could fall directly within that overall
    subject.  (Thus, if the Document is in part a textbook of mathematics, a
    Secondary Section may not explain any mathematics.)  The relationship
    could be a matter of historical connection with the subject or with
    related matters, or of legal, commercial, philosophical, ethical or
    political position regarding them.
  </p><p>
    The "Invariant Sections" are certain Secondary Sections whose titles are
    designated, as being those of Invariant Sections, in the notice that says
    that the Document is released under this License.  If a section does not
    fit the above definition of Secondary then it is not allowed to be
    designated as Invariant.  The Document may contain zero Invariant
    Sections.  If the Document does not identify any Invariant Sections then
    there are none.
  </p><p>
    The "Cover Texts" are certain short passages of text that are listed, as
    Front-Cover Texts or Back-Cover Texts, in the notice that says that the
    Document is released under this License.  A Front-Cover Text may be at
    most 5 words, and a Back-Cover Text may be at most 25 words.
  </p><p>
    A "Transparent" copy of the Document means a machine-readable copy,
    represented in a format whose specification is available to the general
    public, that is suitable for revising the document straightforwardly with
    generic text editors or (for images composed of pixels) generic paint
    programs or (for drawings) some widely available drawing editor, and that
    is suitable for input to text formatters or for automatic translation to a
    variety of formats suitable for input to text formatters.  A copy made in
    an otherwise Transparent file format whose markup, or absence of markup,
    has been arranged to thwart or discourage subsequent modification by
    readers is not Transparent.  An image format is not Transparent if used
    for any substantial amount of text.  A copy that is not "Transparent" is
    called "Opaque".
  </p><p>
    Examples of suitable formats for Transparent copies include plain ASCII
    without markup, Texinfo input format, LaTeX input format, SGML or XML
    using a publicly available DTD, and standard-conforming simple HTML,
    PostScript or PDF designed for human modification.  Examples of
    transparent image formats include PNG, XCF and JPG.  Opaque formats
    include proprietary formats that can be read and edited only by
    proprietary word processors, SGML or XML for which the DTD and/or
    processing tools are not generally available, and the machine-generated
    HTML, PostScript or PDF produced by some word processors for output
    purposes only.
  </p><p>
    The "Title Page" means, for a printed book, the title page itself, plus
    such following pages as are needed to hold, legibly, the material this
    License requires to appear in the title page.  For works in formats which
    do not have any title page as such, "Title Page" means the text near the
    most prominent appearance of the work's title, preceding the beginning of
    the body of the text.
  </p><p>
    A section "Entitled XYZ" means a named subunit of the Document whose title
    either is precisely XYZ or contains XYZ in parentheses following text that
    translates XYZ in another language.  (Here XYZ stands for a specific
    section name mentioned below, such as "Acknowledgements", "Dedications",
    "Endorsements", or "History".)  To "Preserve the Title" of such a section
    when you modify the Document means that it remains a section "Entitled
    XYZ" according to this definition.
  </p><p>
    The Document may include Warranty Disclaimers next to the notice which
    states that this License applies to the Document.  These Warranty
    Disclaimers are considered to be included by reference in this License,
    but only as regards disclaiming warranties: any other implication that
    these Warranty Disclaimers may have is void and has no effect on the
    meaning of this License.
  </p><h2><a id="id732850"></a>
    2. VERBATIM COPYING
  </h2><p>
    You may copy and distribute the Document in any medium, either
    commercially or noncommercially, provided that this License, the copyright
    notices, and the license notice saying this License applies to the
    Document are reproduced in all copies, and that you add no other
    conditions whatsoever to those of this License.  You may not use technical
    measures to obstruct or control the reading or further copying of the
    copies you make or distribute.  However, you may accept compensation in
    exchange for copies.  If you distribute a large enough number of copies
    you must also follow the conditions in section 3.
  </p><p>
    You may also lend copies, under the same conditions stated above, and you
    may publicly display copies.
  </p><h2><a id="id732870"></a>
    3. COPYING IN QUANTITY
  </h2><p>
    If you publish printed copies (or copies in media that commonly have
    printed covers) of the Document, numbering more than 100, and the
    Document's license notice requires Cover Texts, you must enclose the
    copies in covers that carry, clearly and legibly, all these Cover Texts:
    Front-Cover Texts on the front cover, and Back-Cover Texts on the back
    cover.  Both covers must also clearly and legibly identify you as the
    publisher of these copies.  The front cover must present the full title
    with all words of the title equally prominent and visible.  You may add
    other material on the covers in addition.  Copying with changes limited to
    the covers, as long as they preserve the title of the Document and satisfy
    these conditions, can be treated as verbatim copying in other
    respects.
  </p><p>
    If the required texts for either cover are too voluminous to fit legibly,
    you should put the first ones listed (as many as fit reasonably) on the
    actual cover, and continue the rest onto adjacent pages.
  </p><p>
    If you publish or distribute Opaque copies of the Document numbering more
    than 100, you must either include a machine-readable Transparent copy
    along with each Opaque copy, or state in or with each Opaque copy a
    computer-network location from which the general network-using public has
    access to download using public-standard network protocols a complete
    Transparent copy of the Document, free of added material.  If you use the
    latter option, you must take reasonably prudent steps, when you begin
    distribution of Opaque copies in quantity, to ensure that this Transparent
    copy will remain thus accessible at the stated location until at least one
    year after the last time you distribute an Opaque copy (directly or
    through your agents or retailers) of that edition to the public.
  </p><p>
    It is requested, but not required, that you contact the authors of the
    Document well before redistributing any large number of copies, to give
    them a chance to provide you with an updated version of the
    Document.
  </p><h2><a id="id732908"></a>
    4. MODIFICATIONS
  </h2><p>
    You may copy and distribute a Modified Version of the Document under the
    conditions of sections 2 and 3 above, provided that you release the
    Modified Version under precisely this License, with the Modified Version
    filling the role of the Document, thus licensing distribution and
    modification of the Modified Version to whoever possesses a copy of it.
    In addition, you must do these things in the Modified Version:
  </p><div class="orderedlist"><ol class="orderedlist" type="A"><li><p>
        Use in the Title Page (and on the covers, if any) a title distinct
        from that of the Document, and from those of previous versions (which
        should, if there were any, be listed in the History section of the
        Document).  You may use the same title as a previous version if the
        original publisher of that version gives permission.
        </p></li><li><p>
        List on the Title Page, as authors, one or more persons or entities
        responsible for authorship of the modifications in the Modified
        Version, together with at least five of the principal authors of the
        Document (all of its principal authors, if it has fewer than five),
        unless they release you from this requirement.
      </p></li><li><p>
        State on the Title page the name of the publisher of the Modified
        Version, as the publisher.
      </p></li><li><p>
        Preserve all the copyright notices of the Document.
      </p></li><li><p>
        Add an appropriate copyright notice for your modifications adjacent to
        the other copyright notices.
      </p></li><li><p>
        Include, immediately after the copyright notices, a license notice
        giving the public permission to use the Modified Version under the
        terms of this License, in the form shown in the Addendum below.
      </p></li><li><p>
        Preserve in that license notice the full lists of Invariant Sections
        and required Cover Texts given in the Document's license notice.
      </p></li><li><p>
        Include an unaltered copy of this License.
      </p></li><li><p>
        Preserve the section Entitled "History", Preserve its Title, and add
        to it an item stating at least the title, year, new authors, and
        publisher of the Modified Version as given on the Title Page.  If
        there is no section Entitled "History" in the Document, create one
        stating the title, year, authors, and publisher of the Document as
        given on its Title Page, then add an item describing the Modified
        Version as stated in the previous sentence.
      </p></li><li><p>
        Preserve the network location, if any, given in the Document for
        public access to a Transparent copy of the Document, and likewise the
        network locations given in the Document for previous versions it was
        based on.  These may be placed in the "History" section.  You may omit
        a network location for a work that was published at least four years
        before the Document itself, or if the original publisher of the
        version it refers to gives permission.
      </p></li><li><p>
        For any section Entitled "Acknowledgements" or "Dedications", Preserve
        the Title of the section, and preserve in the section all the
        substance and tone of each of the contributor acknowledgements and/or
        dedications given therein.
      </p></li><li><p>
        Preserve all the Invariant Sections of the Document, unaltered in
        their text and in their titles.  Section numbers or the equivalent are
        not considered part of the section titles.
      </p></li><li><p>
        Delete any section Entitled "Endorsements".  Such a section may not be
        included in the Modified Version.
      </p></li><li><p>
        Do not retitle any existing section to be Entitled "Endorsements" or
        to conflict in title with any Invariant Section.
      </p></li><li><p>
        Preserve any Warranty Disclaimers.
      </p></li></ol></div><p>
    If the Modified Version includes new front-matter sections or appendices
    that qualify as Secondary Sections and contain no material copied from the
    Document, you may at your option designate some or all of these sections
    as invariant.  To do this, add their titles to the list of Invariant
    Sections in the Modified Version's license notice.  These titles must be
    distinct from any other section titles.
  </p><p>
    You may add a section Entitled "Endorsements", provided it contains
    nothing but endorsements of your Modified Version by various parties--for
    example, statements of peer review or that the text has been approved by
    an organization as the authoritative definition of a standard.
  </p><p>
    You may add a passage of up to five words as a Front-Cover Text, and a
    passage of up to 25 words as a Back-Cover Text, to the end of the list of
    Cover Texts in the Modified Version.  Only one passage of Front-Cover Text
    and one of Back-Cover Text may be added by (or through arrangements made
    by) any one entity.  If the Document already includes a cover text for the
    same cover, previously added by you or by arrangement made by the same
    entity you are acting on behalf of, you may not add another; but you may
    replace the old one, on explicit permission from the previous publisher
    that added the old one.
  </p><p>
    The author(s) and publisher(s) of the Document do not by this License give
    permission to use their names for publicity for or to assert or imply
    endorsement of any Modified Version.
  </p><h2><a id="id733095"></a>
    5. COMBINING DOCUMENTS
  </h2><p>
    You may combine the Document with other documents released under this
    License, under the terms defined in section 4 above for modified versions,
    provided that you include in the combination all of the Invariant Sections
    of all of the original documents, unmodified, and list them all as
    Invariant Sections of your combined work in its license notice, and that
    you preserve all their Warranty Disclaimers.
  </p><p>
    The combined work need only contain one copy of this License, and multiple
    identical Invariant Sections may be replaced with a single copy.  If there
    are multiple Invariant Sections with the same name but different contents,
    make the title of each such section unique by adding at the end of it, in
    parentheses, the name of the original author or publisher of that section
    if known, or else a unique number.  Make the same adjustment to the
    section titles in the list of Invariant Sections in the license notice of
    the combined work.
  </p><p>
    In the combination, you must combine any sections Entitled "History" in
    the various original documents, forming one section Entitled "History";
    likewise combine any sections Entitled "Acknowledgements", and any
    sections Entitled "Dedications".  You must delete all sections Entitled
    "Endorsements".
  </p><h2><a id="id733123"></a>
    6. COLLECTIONS OF DOCUMENTS
  </h2><p>
    You may make a collection consisting of the Document and other documents
    released under this License, and replace the individual copies of this
    License in the various documents with a single copy that is included in
    the collection, provided that you follow the rules of this License for
    verbatim copying of each of the documents in all other respects.
  </p><p>
    You may extract a single document from such a collection, and distribute
    it individually under this License, provided you insert a copy of this
    License into the extracted document, and follow this License in all other
    respects regarding verbatim copying of that document.
  </p><h2><a id="id733142"></a>
    7. AGGREGATION WITH INDEPENDENT WORKS
  </h2><p>
    A compilation of the Document or its derivatives with other separate and
    independent documents or works, in or on a volume of a storage or
    distribution medium, is called an "aggregate" if the copyright resulting
    from the compilation is not used to limit the legal rights of the
    compilation's users beyond what the individual works permit.  When the
    Document is included in an aggregate, this License does not apply to the
    other works in the aggregate which are not themselves derivative works of
    the Document.
  </p><p>
    If the Cover Text requirement of section 3 is applicable to these copies
    of the Document, then if the Document is less than one half of the entire
    aggregate, the Document's Cover Texts may be placed on covers that bracket
    the Document within the aggregate, or the electronic equivalent of covers
    if the Document is in electronic form.  Otherwise they must appear on
    printed covers that bracket the whole aggregate.
  </p><h2><a id="id733164"></a>
    8. TRANSLATION
  </h2><p>
    Translation is considered a kind of modification, so you may distribute
    translations of the Document under the terms of section 4.  Replacing
    Invariant Sections with translations requires special permission from
    their copyright holders, but you may include translations of some or all
    Invariant Sections in addition to the original versions of these Invariant
    Sections.  You may include a translation of this License, and all the
    license notices in the Document, and any Warranty Disclaimers, provided
    that you also include the original English version of this License and the
    original versions of those notices and disclaimers.  In case of a
    disagreement between the translation and the original version of this
    License or a notice or disclaimer, the original version will prevail.
  </p><p>
    If a section in the Document is Entitled "Acknowledgements",
    "Dedications", or "History", the requirement (section 4) to Preserve its
    Title (section 1) will typically require changing the actual title.
  </p><h2><a id="id733186"></a>
    9. TERMINATION
  </h2><p>
    You may not copy, modify, sublicense, or distribute the Document except as
    expressly provided for under this License.  Any other attempt to copy,
    modify, sublicense or distribute the Document is void, and will
    automatically terminate your rights under this License.  However, parties
    who have received copies, or rights, from you under this License will not
    have their licenses terminated so long as such parties remain in full
    compliance.
  </p><h2><a id="id733199"></a>
    10. FUTURE REVISIONS OF THIS LICENSE
  </h2><p>
    The Free Software Foundation may publish new, revised versions of the GNU
    Free Documentation License from time to time.  Such new versions will be
    similar in spirit to the present version, but may differ in detail to
    address new problems or concerns.  See <a class="ulink" href="http://www.gnu.org/copyleft/" target="_top">http://www.gnu.org/copyleft/</a>.
  </p><p>
    Each version of the License is given a distinguishing version number.  If
    the Document specifies that a particular numbered version of this License
    "or any later version" applies to it, you have the option of following the
    terms and conditions either of that specified version or of any later
    version that has been published (not as a draft) by the Free Software
    Foundation.  If the Document does not specify a version number of this
    License, you may choose any version ever published (not as a draft) by the
    Free Software Foundation.
  </p><h2><a id="id733226"></a>
    ADDENDUM: How to use this License for your documents
  </h2><pre class="screen">
   Copyright (c) YEAR YOUR NAME.
   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.2
   or any later version published by the Free Software Foundation;
   with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
   A copy of the license is included in the section entitled “GNU
   Free Documentation License”.
  </pre><p>
   If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
   replace the “with...Texts.” line with this:
  </p><pre class="screen">
   with the Invariant Sections being LIST THEIR TITLES, with the
   Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.
  </pre><p>
   If you have Invariant Sections without Cover Texts, or some other
   combination of the three, merge those two alternatives to suit the
   situation.
  </p><p>
   If your document contains nontrivial examples of program code, we
   recommend releasing these examples in parallel under your choice of free
   software license, such as the GNU General Public License, to permit their
   use in free software.
  </p></div></div></div><div class="userfootercontent"><!--htdig_noindex--><hr /><center>openSUSE Virtualization with KVM 12.3</center><!--/htdig_noindex--></div></body></html>
